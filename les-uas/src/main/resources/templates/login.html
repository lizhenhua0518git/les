﻿<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
 
<link rel="stylesheet" href="/auth/css/login.css" type="text/css" />
<title>LES物流执行系统</title>
</head>
<style>

</style>
	<body>
		<div class="login_header">
	        <div>
	            <img src="/auth/css/img/logo_login.png" alt="">
	        </div>
	        <div class="z_line"></div>
	        <div>
	            	LES物流执行管理系统
	        </div>
    	</div>
    	<form action="/auth/login" method="POST">
		<div class="loginWraper">
        	<div id="loginform" class="loginBox">
			 <h1>用户登录</h1>
        			<div class="layui-form-item">
        				<div class="layui-inline">
						      <div class="layui-input-inline">
						        <input type="tel" id="username"  name="username" placeholder="请输入手机号码"  class="layui-input input-text">
						        <!--  <i class="layui-icon login_icon">&#xe66f;</i>-->
						      </div>
    					</div>
    				</div>
    				<div class="layui-form-item">
        				<div class="layui-inline">
						      <div class="layui-input-inline">
						        <input type="password"  id="password" name="password" placeholder="请输入密码"  class="layui-input input-text">
						        <p style="color:red;font-size:14px;" id="errorTips"></p>
                        		<!-- <i class="layui-icon login_icon">&#xe673;</i>-->
						      </div>
						     <!--  <a id="changePassWordNew" href="#" style="float: right;">修改密码</a> -->
    					</div>
    				</div>
    				<div class="layui-form-item">
					    <div class="layui-input-block">
					      <button id="btn-login" type="submit" class="layui-btn layui-btn-danger layui-btn-lg login_btn">登&nbsp;&nbsp;录</button> 

					    </div>
				  	</div>
    	    </div>
        </div>
        </form>
        <div class="login_footer">Copyright&nbsp;&copy;&nbsp;中科富创（北京）科技有限公司</div>
        <script src="/auth/css/js/md5.js" charset="UTF-8"  type="text/javascript"></script>
        <script src="/auth/css/layui/layui.js" charset="UTF-8"  type="text/javascript"></script>
        <script src="/auth/css/js/jquery-1.10.2.js"></script>
        <script type="text/javascript">
   
        
        
        	layui.use(['layer','jquery_cookie'],function(){
        		var $ = layui.$;
       			$ = layui.jquery_cookie($);
       			
        		/* $("#btn-login").on("click",function(){
        			loginMethod();
        		}); */
        		$(document).keyup(function(event){
        			if(event.keyCode==13){
        				loginMethod();
        			}
        		})
        		function loginMethod(){
            		var userName = $("#loginName").val().trim();
            		var password = $("#password").val();
            		var error;
    		        if (userName == null || userName == "") {
    		        	error = "用户名不能为空";
    					$("#errorTips").text(error);
    					$("#loginName").focus();
    		            return;
    		        }
    		        if (password == null || password == "") {
    		            error = '密码不能为空！';
    					$('#errorTips').text(error);
    					$("#password").focus();
    		            return;
    		        }else{
    		        	if(!regular(password)){
    		        		layer.alert("密码不符合规则,请修改后登录",{
    		        			yes:function(index, layero){
    		        				layer.open({
    	    		                    type: 2,    //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
    	    		                    title:"修改密码",
    	    		                    offset:'auto',//具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
    	    		                    id: 'changePass', //防止重复弹出
    	    		                    area: ['650px', '400px'],
    	    		                    content: 'iles/pages/user/changePassWordNew.html',
    	    		                    shade: 0,//不显示遮罩
    	    		                    yes: function(){
    	    		                        layer.closeAll();
    	    		                    }
    	    		                });
    		        			}
    		        		});
    		        		
    		        		return;
    		        	}
    		        }
    		        password = hex_md5(password);
    		        var data = {"phone":userName,"userPassword":password};
    		        $.ajax({
    		        	type:"post",
    		        	url:"/iles/login",
    		        	async:false,
    		        	data: JSON.stringify(data),
    		        	contentType:'application/json',
    	    			success:function(backData){
    	    				if(backData.code != 0){
    		    				$("#errorTips").text(backData.msg);
    							$("#loginName").focus();
    		    			}else{	
    		    				$.cookie('token', backData.data, {path: '/' });
    	    					var url = "/iles/homePage";
    	    					window.location.href=url;
    	    					window.event.returnValue=false; 
    		    			}
    	    			}
    		        });
            	}
        		function regular(password){
        			var pattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).{8,16}$/;
        			return pattern.test(password);
        		}
        	});
        	
            $("#changePassWordNew").click(function(){
                layer.open({
                    type: 2,    //0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                    title:"修改密码",
                    offset:'auto',//具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    id: 'changePass', //防止重复弹出
                    area: ['650px', '400px'],
                    content: 'iles/pages/user/changePassWordNew.html',
                    shade: 0,//不显示遮罩
                    yes: function(){
                        layer.closeAll();
                    }
                });
            });
        	
        </script>
	</body>
</html>
