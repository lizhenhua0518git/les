<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zkzn.les.uas.dao.LoginDao">

<resultMap type="com.zkzn.les.uas.pojo.Login" id="BaseResultMap">
	<result column="USER_ID" property="userId"/>
	<result column="LOG_TIME" property="logTime"/>
	<result column="TYPE" property="type"/>
	<result column="USER_NAME" property="userName"/>
</resultMap>

<!-- 插入登录信息 -->
<insert id="insertLogin"  parameterType="com.zkzn.les.uas.pojo.Login"  >
	<selectKey keyProperty="id" resultType="java.lang.String" order="BEFORE">
		select  replace(uuid(),'-','') from dual
	</selectKey>
	insert into t_login 
	<trim prefix="(" suffix=")" suffixOverrides=",">
			id,
		<if test="userId !=null and  ''!= userId">
			user_id,
		</if>
		<if test="logTime != null ">
			log_time,
		</if>
		<if test="type != null ">
			type,
		</if>
	</trim>
	<trim prefix="values (" suffix=")" suffixOverrides=",">
		#{id, jdbcType=VARCHAR},
		<if test="userId !=null and  ''!= userId">
			#{userId},
		</if>
		<if test="logTime != null ">
			#{logTime,  jdbcType=DATE},
		</if>
		<if test="type != null">
			#{type},
		</if>
	</trim>
</insert>

<select id="queryLoginMessage" resultMap="BaseResultMap" parameterType="com.zkzn.les.uas.pojo.Login">
	select l.USER_ID,u.user_name,l.LOG_TIME,l.TYPE
	from T_LOGIN l left join t_user u
	on l.user_id = u.id
	where 1 = 1
	<if test="null != userName and '' != userName">
		AND u.user_name like CONCAT(CONCAT('%',#{userName}),'%')
	</if>
	<if test="null != startTime and '' != startTime">
		AND l.login_time <![CDATA[>=]]> str_to_date(#{startTime}, '%Y-%m-%d')
	</if>
	<if test="null != endTime and '' != endTime">
		AND l.login_time <![CDATA[<=]]> str_to_date(#{endTime}, '%Y-%m-%d')
	</if>
	<if test="(null != type and '' != type) or type==0">
		AND l.type = #{type}
	</if>
	order by l.LOG_TIME desc
</select>

</mapper>