<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="charset=UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/layui.css"
          type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/css/layui_extend.css"
          type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css"/>
    <title>采购入库订单</title>
</head>
<script type="text/html" id="toolbar">
    <a class="layui-btn layui-btn-xs" lay-event="showDetail">查看</a>
</script>
<body id="bodyDiv">
<script type="text/html" id="bodyTpl">
    <div class="layui-fluid">
        <div class="layui-row layui-form">
            <div class="layui-col-md2">
                <label class="layui-form-label">订单号</label>
                <div class="layui-input-inline">
                    <input type="text" id="orderCode_search" class="layui-input" placeholder="请输入订单号">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">供应商</label>
                <div class="layui-input-inline">
                    <input type="text" id="supplierName_search" class="layui-input" placeholder="请输入供应商">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">单据类型</label>
                <div class="layui-input-inline">
                    <select id="orderType_search" xm-select="orderTypeSelect" xm-select-show-count="1">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">创建日期</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="requiredTime_search" placeholder="请选择创建日期">
                </div>
            </div>
            <div class="layui-btn-container nav-" style="text-align: right;">
                {{# if(d.search==null || d.search=="true"){ }}
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="search" id="search" type="button"><i
                        class="layui-icon layui-icon-search"></i>查询
                </button>
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="reset" id="reset" type="button"><i
                        class="layui-icon  layui-icon-reset"></i>重置
                </button>
                {{# } }}
            </div>
         </div>
    </div>
    <div class="layui-fluid-table">
        <table class="layui-hide" id="purchaseBillTab" lay-filter="purchaseBillTabF"></table>
    </div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script type="text/javascript">
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var laydate = layui.laydate;
    var oldData;
    var contextPath = config.omsConfig.contextPath;
    var active = {

        search: function (othis) {

            var orderCode = $('#orderCode_search').val();
            var supplierName = $('#supplierName_search').val();
            var orderType = layui.formSelects.value('orderTypeSelect', 'valueStr');
            var requiredTime = $('#requiredTime_search').val();

            var params = {};
            params.orderCode = orderCode;
            params.supplierName = supplierName;
            params.orderType = orderType;
            params.requiredTimeStr = requiredTime;
            //执行重载
            table.reload('purchaseBillTabId', {
                where: params,
            });
        },
        reset: function (othis) {
            $('#orderCode_search').val("");
            $('#supplierName_search').val("");
            layui.formSelects.value('orderTypeSelect', []);
            $('#requiredTime_search').val("");
            form.render("select");
        }
    };

    function loadding() {
        table.render({
            elem: '#purchaseBillTab',
            id: 'purchaseBillTabId',
            url: contextPath + 'purchaseBill/listPurchaseBill',
            cols: [[ {
                type: 'numbers',
                title: '序号'
            }, {
                field: 'orderCode',
                title: '订单号'
            }, {
                field: 'supplierCode',
                title: '供应商编码'
            }, {
                field: 'supplierName',
                title: '供应商名称'
            }, {
                field: 'orderType',
                title: '单据类型编码'
            }, {
                field: 'orderTypeName',
                title: '单据类型名称',templet(d){
                    if(d.orderType=='NB'){
                        return '标准采购订单';
                    }else if(d.orderType=='TETH'){
                        return '退货采购订单';
                    }else{
                        return '-';
                    }
                }
            }, {
                field: 'createTime',
                title: '创建日期',templet(d){
                   if(d.createTime){
                      return d.createTime.substring(0,10);
                   }else{
                       return '-';
                   }
                }
            },{
                align: 'center',
                title: '操作',
                toolbar: "#toolbar"
            }]],
            page: {
                theme: '#008155'
            },
            even: true,
            done: function (res, page, count) {//列表数据回调函数
            }
        });


        $('.layui-btn-container button').on('click', function () {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });
        //时间选择器
        laydate.render({
            elem: '#requiredTime_search',
            type: 'date',
            range: true
        });
        initOrderType();//单据类型

        table.on('tool(purchaseBillTabF)', function(obj){
            var eventName = obj.event;
            oldData =  obj.data;
            if(eventName == "showDetail"){
                layer.open({
                    type : 2,
                    title : '采购入库订单明细',
                    maxmin : false,
                    area : [ '100%', '100%' ],
                    id : 'purchaseBillDetail' //防止重复弹出
                    ,
                    content : 'purchaseBillDetail.html',
                    shade : 0 //不显示遮罩
                    ,
                    yes : function() {
                        layer.closeAll();
                    }
                });
            }
        });
    }

    //初始化单据类型下拉框
    function initOrderType() {
        var optoinArray = [{name: '标准采购订单', value: 'NB'}, {name: '退货采购订单', value: 'TETH'}];
        layui.formSelects.data("orderTypeSelect", 'local', {
            arr: optoinArray
        });
    }
</script>
</body>
</html>
