<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"
	type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"
	type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<title>出库任务派发</title>
</head>
<body id="bodyDiv">
	<script type="text/html" id="bodyTpl">
    <div class="layui-fluid" >
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
                <label class="layui-form-label">订单号</label>
                <div class="layui-input-inline">
                    <input type="text" id="orderCode_search" class="layui-input" placeholder="请输入订单号">
                </div>
            </div>

            <div class="layui-col-md2">
                <label class="layui-form-label">预留行项目</label>
                <div class="layui-input-inline">
                    <input type="text" id="reserveRow_search" class="layui-input" placeholder="请输入预留行项目">
                </div>
            </div>
 			<div class="layui-col-md2">
                <label class="layui-form-label">组件行项号</label>
                <div class="layui-input-inline">
                    <input type="text" id="materialCode_search" class="layui-input" placeholder="请输入组件行项目">
                </div>
            </div>
			<div class="layui-col-md2">
                <label class="layui-form-label">组件物料号</label>
                <div class="layui-input-inline">
                    <input type="text" id="materialRow_search" class="layui-input" placeholder="请输入组件物料号">
                </div>
            </div>
			 <div class="layui-btn-container nav-" style="text-align: right;">
					{{# if(d.search==null || d.search=="true"){ }}
             	 		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              			<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon  layui-icon-reset"></i>重置</button>
              		{{# } }}
			</div>
		</div>
        <div class="layui-row layui-form">

			<div class="layui-col-md2">
                <label class="layui-form-label">预留号</label>
                <div class="layui-input-inline">
                    <input type="text" id="reserveCode_search" class="layui-input" placeholder="请输入预留号">
                </div>
            </div>
			<div class="layui-col-md2">
			 	<label class="layui-form-label">仓库</label>
				<div class="layui-input-inline">
			        <select  id="storageLocation_search" lay-filter="storageLocationFilter" xm-select="storageLocationSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
			</div>

        </div>

    </div>
    <div class="layui-fluid-table">

        <table class="layui-hide" id="stationOrderTab" lay-filter="stationOrderTabF"></table>
    </div>
</script>
	<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
	<script type="text/javascript">
		var element = layui.element;
		var layer = layui.layer;
		var table = layui.table;
		var form = layui.form;
		var laydate = layui.laydate;
		var processOrderDetailData =parent.processOrderDetailData;
		var contextPath = config.omsConfig.contextPath;
		var active = {

			distributing : function(othis) {
                var cacheTable = table.cache.stationOrderTabId;
                if(cacheTable==null || cacheTable.length==0){
                    layer.msg("无数据");
                    return ;
                }
                var type = othis.data('type');
                layer.open({
                    type : 2,
                    title : '任务派发',
                    maxmin : false,
                    area : [ '100%', '100%' ],
                    offset : type,
                    id : 'stationOrderTask' + type //防止重复弹出
                    ,
                    content : 'stationOrderTask.html',
                    shade : 0 //不显示遮罩
                    ,
                    yes : function() {
                        layer.closeAll();
                    }
                });
			},
			search : function(othis) {

				var orderCode = $('#orderCode_search').val();
				var reserveRow = $('#reserveRow_search').val();
				var materialRow = $('#materialRow_search').val();
				var materialCode = $('#materialCode_search').val();
				var workshopCode = layui.formSelects.value(
						'workshopCode_search', 'valueStr');
				var reserveCode = $('#reserveCode_search').val();
				var storageLocation = layui.formSelects.value('storageLocationSelect', 'valueStr');
				var stationCode = layui.formSelects.value('stationCodeSelect', 'valueStr');
				var positionCode = $('#positionCode_search').val();
				var lineCode = layui.formSelects.value('lineCode_search',
						'valueStr');
				var requiredTime = $('#requiredTime_search').val();

				var params = {};
				params.orderCode = orderCode;
				params.reserveRow = reserveRow;
				params.materialRow = materialRow;
				params.materialCode = materialCode;
				params.workshopCode = workshopCode;
				params.reserveCode = reserveCode;
				params.storageLocation = storageLocation;
				params.stationCode = stationCode;
				params.positionCode = positionCode;
				params.lineCode = lineCode;
				params.requiredTimeStr = requiredTime;
				params.processDetailId =processOrderDetailData.id;
				//执行重载
				table.reload('stationOrderTabId', {
					where : params,
				});
			},
			reset : function(othis) {
				$('#requiredTime_search').val("");
				$('#orderCode_search').val("");
				$('#reserveRow_search').val("");
				$('#materialRow_search').val("");
				$('#materialCode_search').val("");
				layui.formSelects.value('workshopCode_search', []);
				$('#reserveCode_search').val("");
				layui.formSelects.value('storageLocationSelect', []);
				layui.formSelects.value('stationCodeSelect', []);
				$('#positionCode_search').val("");
				layui.formSelects.value('lineCode_search', []);
				$('#requiredTime_search').val("");

				form.render("select");
			}
		};

		function loadding() {
			table.render({
				elem : '#stationOrderTab',
				id : 'stationOrderTabId',
                url : contextPath + 'stationOrder/listStationOrder',
				cols : [ [ {
					type : 'checkbox'
				}, {
					type : 'numbers',
					title : '序号'
				}, {
					field : 'orderCode',
					title : '生产订单号'
				},{
					field : 'reserveCode',
					title : '预留号'
				}, {
					field : 'reserveRow',
					title : '预留行项目'
				}, {
					field : 'materialCode',
					title : '组件行项目'
				}, {
					field : 'materialRow',
					title : '组件物料号'
				}, {
					field : 'positionCode',
					title : '库位'
				}, {
					field : 'pickNum',
					title : '下架数量'
				}, {
					field : 'specialName',
					title : '特殊库存标识'
				} ] ],
				page : {
					theme : '#008155'
				},
				even : true,
				where : {
					processDetailId : processOrderDetailData.id
				},
				done : function(res, page, count) {//列表数据回调函数
					initWarehouseSignSelect("warehouse_search", 1);
					form.render(null, "storageLocationSearchForm");
				}
			});
			$('.layui-btn-container button').on('click', function() {
				var othis = $(this), method = othis.data('method');
				active[method] ? active[method].call(this, othis) : '';
			});
			//时间选择器
			laydate.render({
				elem : '#requiredTime_search',
				type : 'date',
				 trigger: 'click',
				range : true
			});
			inintPlantMultiSelect("workshopCode_search", [], 2);
			inintPlantMultiSelect("lineCode_search", [], 3);
			initWarehouseMultiSelect("storageLocation_search","storageLocationSelect",0,'');
			inintPlantMultiSelect("stationCodeSelect", [], 4);//工位
		}
		//监听启用操作
		form.on('switch(statusValue)', function(obj) {
			var status = '0';
			if (obj.elem.checked) {
				status == '1';
			}
			updateStatus(this.value, status);
		});

		 function initStationCode(){//工位
		    	$.ajax({
		    		url:config.basicInfoConfig.contextPath+"stationManager/getAllStationCode",
		    		type:"GET",
		    		success:function(result){
		    			$('#stationCode_search').html("");
		    			$('#stationCode_search').append('<option value="">请选择</option>');
		          	  	var order = result.data;
		    			if(order && order.length>0){
		    			var optionItem;
		    			var optoinArray = new Array();
		    				for(var i=0;i<order.length;i++){
		    				optionItem = {"name":""+order[i].stationCode, "value":""+order[i].stationCode};
		    				optoinArray.push(optionItem);
		    				}
		    				layui.formSelects.data('stationCodeSelect','local',{
		    					arr:optoinArray
		    				});
		    			}
		    		}
		    	});
		    }
	</script>
</body>
</html>
