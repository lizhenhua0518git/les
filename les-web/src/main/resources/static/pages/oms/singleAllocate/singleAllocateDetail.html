<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>调拨订单管理</title>
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" type="text/css" href="/iles/pages/css/layui_extend.css"/>
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
</head>
<body id="bodyDiv">
<script type="text/html" id="bodyTpl">
<div class="layui-fluid">
	<div class="layui-row layui-form">
		<div class="layui-col-md2">
			 	<label class="layui-form-label">订单号</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="allocationOrder_search" class="layui-input">
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调出仓库</label>
				<div class="layui-input-block">
			        <select  id="outWarehouseCode_search" lay-filter="outWarehouseCodeFilter" xm-select="outWarehouseCodeSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调出仓库库存地</label>
			 	 <div class="layui-input-block">
			        <select  id="outStorageLocation_search" xm-select="outStorageLocationSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			    <label class="layui-form-label">调出工厂</label>
			 	 <div class="layui-input-block">
			        <select  id="outFactory_search" xm-select="outFactorySelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
		        <label class="layui-form-label">调出工厂库存地</label>
			 	 <div class="layui-input-block">
			        <select  id="sapOutStorageLocation_search" xm-select="sapOutStorageLocationSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			<div class="layui-btn-container" style="text-align: left;">
				{{# if(d.search==null || d.search=="true"){ }}
             	 	<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
              	{{# } }}
			</div>
		</div>
	</div>
	<div class="layui-row layui-form">
		<div class="layui-col-md2">
			 	<label class="layui-form-label">创建时间</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="createTime_search" class="layui-input">
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调入仓库</label>
			 	<div class="layui-input-block">
			        <select  id="inWarehouseCode_search" xm-select="inWarehouseCodeSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调入仓库库存地</label>
			 	<div class="layui-input-block">
			        <select  id="inStorageLocation_search"  xm-select="inStorageLocationSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调入工厂</label>
			 	<div class="layui-input-block">
			        <select  id="inFactory_search" xm-select="inFactorySelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调入工厂库存地</label>
			 	 <div class="layui-input-block">
			        <select  id="sapInStorageLocation_search" xm-select="sapInStorageLocationSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
	</div>
	<div class="layui-row layui-form">
		<div class="layui-col-md2">
			 	<label class="layui-form-label">SAP订单号</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="sapAllocationOrder_search" class="layui-input">
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">订单状态</label>
				<div class="layui-input-block">
			        <select  id="status_search" xm-select="statusSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">单据类型</label>
				<div class="layui-input-block">
			        <select  id="billType_search" xm-select="billTypeSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">库存审核状态</label>
				<div class="layui-input-block">
			        <select  id="stockCheckStatus_search" xm-select="stockCheckStatusSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">物料号</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="materialCode_search" class="layui-input">
			    </div>
		</div>
	</div>
</div>
<div class="layui-fluid-table">
<table class="layui-hide" id="singleAllocateDetailTab" lay-filter="singleAllocateDetailTabF"></table>
</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/urlParam.js" charset="UTF-8"></script>
<script type="text/javascript">
var table = layui.table;
var element = layui.element;
var laydate = layui.laydate;
var form = layui.form;
var contextPath = config.omsConfig.contextPath;
var paramsMap = UrlParam.paramMap();
var orderCode = '';
if(paramsMap && paramsMap.orderCode && paramsMap.orderCode.length>0){
	orderCode = paramsMap.orderCode[0];
}
var active = {
		search:function(othis){
			var materialCode = $("#materialCode_search").val();
			var allocationOrder = $('#allocationOrder_search').val();
			var outWarehouseCode = layui.formSelects.value('outWarehouseCodeSelect', 'valueStr');
			var outStorageLocation = layui.formSelects.value('outStorageLocationSelect', 'valueStr');
			var outFactory = layui.formSelects.value('outFactorySelect', 'valueStr');
			var sapOutStorageLocation = layui.formSelects.value('sapOutStorageLocationSelect', 'valueStr');
			var createTime = $('#createTime_search').val();
			var inWarehouseCode =layui.formSelects.value('inWarehouseCodeSelect', 'valueStr');
			var inStorageLocation = layui.formSelects.value('inStorageLocationSelect', 'valueStr');
			var inFactory = layui.formSelects.value('inFactorySelect', 'valueStr');
			var sapInStorageLocation =layui.formSelects.value('sapInStorageLocationSelect', 'valueStr');
			var sapAllocationOrder = $('#sapAllocationOrder_search').val();
			var status = layui.formSelects.value('statusSelect', 'valueStr');
			var billType = layui.formSelects.value('billTypeSelect', 'valueStr');
			var stockCheckStatus = layui.formSelects.value('stockCheckStatusSelect', 'valueStr');
			if(sapOutStorageLocation && sapOutStorageLocation.length>0){
				if(outFactory==''){
					layer.alert("请选择调出工厂");
					return;
				}
			}
			if(sapInStorageLocation && sapInStorageLocation.length>0){
				if(inFactory==''){
					layer.alert("请选择调入工厂");
					return;
				}
			}
			var startTimeStr = null;
			var endTimeStr = null;
			if(createTime && createTime.length>0){
				startTimeStr = createTime.substring(0,10);
				endTimeStr = createTime.substring(13);
			}
		      //执行重载
		      table.reload('singleAllocateDetailTabId', {
		        where:{
		        	allocationOrder: allocationOrder
		           ,outWarehouseCode:outWarehouseCode
		           ,outStorageLocation:outStorageLocation
		           ,outFactory:outFactory
		           ,sapOutStorageLocation:sapOutStorageLocation
		           ,inWarehouseCode:inWarehouseCode
		           ,inStorageLocation:inStorageLocation
		           ,inFactory:inFactory
		           ,sapInStorageLocation:sapInStorageLocation
		           ,sapAllocationOrder:sapAllocationOrder
		           ,statusStr:status
		           ,billType:billType
		           ,stockCheckStatusStr:stockCheckStatus
		           ,startTimeStr:startTimeStr
		           ,endTimeStr:endTimeStr
		           ,materialCode:materialCode
		        }
		        ,page:{"curr":1}
		      });
		},reset:function(othis){
			$('#allocationOrder_search').val("");
			$('#createTime_search').val("");
			$('#sapAllocationOrder_search').val("");
			layui.formSelects.value('outWarehouseCodeSelect', []);
    		layui.formSelects.value('outStorageLocationSelect', []);
    		layui.formSelects.value('outFactorySelect', []);
    		layui.formSelects.value('sapOutStorageLocationSelect', []);
    		layui.formSelects.value('inWarehouseCodeSelect', []);
    		layui.formSelects.value('inStorageLocationSelect', []);
    		layui.formSelects.value('inFactorySelect', []);
    		layui.formSelects.value('sapInStorageLocationSelect', []);
    		layui.formSelects.value('statusSelect', []);
    		layui.formSelects.value('billTypeSelect', []);
    		layui.formSelects.value('stockCheckStatusSelect', []);
			$('#materialCode_search').val("");
			form.render("select");
		}
}
function loadding(){
	$("#allocationOrder_search").val(orderCode);
	table.render({
		elem:'#singleAllocateDetailTab',
		id:'singleAllocateDetailTabId',
		url: contextPath +'singleAllocateDetail/listSingleAllocateDetail',
		cols:[[
		{type:'checkbox'},
		{type:'numbers',title:'序号',width: 60},
		{field:'allocationOrder',title:'订单号',width: 105},
		{field:'lesItemNo',title:'行项目号',width: 100},
		{field:'materialCode',title:'物料编码',width: 100},
		{field:'materialName', title: '物料名称',width: 100},
		{field:'materialNum',title: '订单数量',width: 100},
		{field:'materialUnit', title: '单位',width: 100},
		{field:'sendNum', title: '发货数量',width: 100},
		{field:'receivedNum', title: '收货数量',width: 100},
		{field:'outWarehouseCode', title: '调出仓库编码',width: 100},
		{field:'outWarehouseName', title: '调出仓库名称',width: 100},
		{field:'outStorageLocation', title: '调出仓库库存地',width: 100},
		{field:'inWarehouseCode', title: '调入仓库编码',width: 100},
		{field:'inWarehouseName', title: '调入仓库名称',width: 100},
		{field:'inStorageLocation', title: '调入仓库库存地',width: 100},
		{field:'outFactory', title: '调出工厂编码',width: 100},
		{field:'outFactoryName', title: '调出工厂名称',width: 100},
		{field:'sapOutStorageLocation', title: '调出工厂库存地',width: 100},
		{field:'inFactory', title: '调入工厂编码',width: 100},
		{field:'inFactoryName', title: '调入工厂名称',width: 100},
		{field:'sapInStorageLocation', title: '调入工厂库存地',width: 100},
		{field:'statusStr', title: '订单状态',width: 100},
		{field:'billType', title: '单据类型编码',width: 100},
		{field:'billName', title: '单据类型名称',width: 100},
		{field:'stockStatusStr', title: '库存状态',width: 100},
		{field:'stockTypeStr', title: '库存类型',width: 100},
		{field:'suppllierCode', title: '供应商编码',width: 100},
		{field:'supplierName', title: '供应商名称',width: 100},
		{field:'sellOrder', title: '销售订单号',width: 100},
		{field:'sellItem', title: '销售订单行项目号',width: 100},
		{field:'customer', title: '客户编码',width: 100},
		{field:'customerName', title: '客户名称',width: 100},
		{field:'sapAllocationOrder', title: '原订单号',width: 100},
		{field:'itemNo', title: '原订单行项目号',width: 100},
		{field:'createrName', title: '创建人',width: 100},
		{field:'createTime', title: '创建时间',width: 100},
		{field:'modifierName', title: '修改人',width: 100},
		{field:'modifiedTime', title: '修改时间',width: 100}
		]],
		page: {theme: '#008155'},
		where:{
			allocationOrder:orderCode
		},
   		even:true
	});
	$('.layui-btn-container button').on('click', function(){
	    var othis = $(this), method = othis.data('method');
	    active[method] ? active[method].call(this, othis) : '';
  	});
	//创建时间区间
 	laydate.render({
	    elem: '#createTime_search',
	    range: true
	});

 	//加载字典开始
	var dictTypes = ["allocate_status","allocate_check_status"]
	var selectItems = ["statusSelect","stockCheckStatusSelect"]
	var defaultValues = [[],[]]
	initDictItemMultiSelect(dictTypes,selectItems,defaultValues);
	//加载字典结束

	//加载调出仓库、库存地开始
	initWarehouseMultiSelect("outWarehouseCode_search","outWarehouseCodeSelect",0,'');
	var selectIds = ["outStorageLocationSelect","sapOutStorageLocationSelect"];
	var cols = ["storagelocation","sapStoragelocation"];
	var defualtValues = [[],[]];
	linkageSelect("outWarehouseCodeSelect",selectIds,cols,defualtValues);
	//加载调出仓库、库存地结束


	//加载调入仓库、库存地开始
	initWarehouseMultiSelect("inWarehouseCode_search","inWarehouseCodeSelect",0,'');
	var selectIds = ["inStorageLocationSelect","sapInStorageLocationSelect"];
	var cols = ["storagelocation","sapStoragelocation"];
	var defualtValues = [[],[]];
	linkageSelect("inWarehouseCodeSelect",selectIds,cols,defualtValues);
	//加载调入仓库、库存地结束

	inintBillTypeMultiSelect('billTypeSelect',[]);
	inintFactoryMultiSelect('inFactorySelect',[]);
}
/**
 * 初始化工厂信息
 */
function inintFactoryMultiSelect(xmselectId,defualtValue){
	var contextPath = config.basicInfoConfig.contextPath
	var option = {
		url:contextPath + 'plmPlantStructure/listFactoryByType?modelType=1',
		type:"get",
		success:function(result){
			if(result.code==0){
				var factoryCodes=result.data;
				if (factoryCodes.length>0){
					 var optoinArray = new Array();
					 for(var i=0;i<factoryCodes.length;i++){
						  itemOption = {"name":""+factoryCodes[i].modelName, "value":""+factoryCodes[i].modelCode};
						  optoinArray.push(itemOption);
					 }
					 layui.formSelects.data(xmselectId,'local',{
							arr:optoinArray
					 });
			      	 layui.formSelects.value(xmselectId, defualtValue,true);

			      	 layui.formSelects.data("outFactorySelect",'local',{
						arr:optoinArray
					 });
			      	 layui.formSelects.value("outFactorySelect", defualtValue,true);
					 layui.form.render("select");

					}
				}
			}
	}
	$.ajax(option);
}
</script>
</body>

</html>
