<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="charset=UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/layui.css"
          type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/css/layui_extend.css"
          type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css"/>
    <title>PC端点收进度统计报表</title>
</head>

<body id="bodyDiv">
<script type="text/html" id="bodyTpl">
    <div class="layui-fluid">

        <div class="layui-row layui-form">
            <!--<div class="layui-col-md2">
                <label class="layui-form-label">仓库名称</label>
                <div class="layui-input-inline">
                    <select id="warehouseCode" name="storageLocation" xm-select="warehouseCodeSelect"
                            xm-select-show-count="1"
                            xm-select-radio="">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>-->

            <div class="layui-col-md2">
                <label class="layui-form-label">送货单号</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="billCode" placeholder="请填写送货单号">
                </div>
            </div>

            <div class="layui-col-md2">
                <label class="layui-form-label">任务号</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="receivedTaskCode" placeholder="请填写点收任务号">
                </div>
            </div>

            <div class="layui-col-md2">
                <label class="layui-form-label">点收人</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="pointerName" placeholder="请填写点收人名称">
                </div>
            </div>

            <div class="layui-col-md2">
                <label class="layui-form-label">到货日期</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="createTime" placeholder="请选择到货日期">
                </div>
            </div>


            <div class="layui-col-md2">
                <label class="layui-form-label">开始时间</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="pointStart" placeholder="点击选择点收开始时间">
                </div>
            </div>


            <div class="layui-col-md2">
                <label class="layui-form-label">结束时间</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" id="pointEnd" placeholder="点击选择点收结束时间">
                </div>
            </div>




            <div class="layui-btn-container nav-" style="text-align: right;">
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="search" id="search" type="button"><i
                        class="layui-icon layui-icon-search"></i>查询
                </button>
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="reset" id="reset" type="button"><i
                        class="layui-icon  layui-icon-reset"></i>重置
                </button>

                <!--<button class="layui-btn layui-btn-normal layui-btn-sm" data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button>-->
            </div>
        </div>
        <div class="layui-fluid-table">
            <div class="layui-row layui-form">
                <div class="layui-btn-container" style="text-align: left;">
                    <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button>
                </div>
            </div>
            <table class="layui-hide" id="tab" lay-filter="tabF"></table>
        </div>
    </div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>

<script type="text/javascript">
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var laydate = layui.laydate;
    var oldData;
    var contextPath = config.mfcConfig.contextPath;
    var active = {
        search: function (othis) {

            let uploadFinishDates = $('#uploadFinishDates').val();

            let params = {
                "billCode":$('#billCode').val(),
                "receivedTaskCode":$('#receivedTaskCode').val(),
                "pointerName":$('#pointerName').val(),
                "createTime":$('#createTime').val(),
                "pointStart":$('#pointStart').val(),
                "pointEnd":$('#pointEnd').val(),
            };

            //执行重载
            table.reload('tabId', {
                where: params,
            });
        },
        reset: function (othis) {

            $('.layui-fluid input').each(function (one) {
                $(this).val("");
            })
            form.render();
        },export: function(othis) {
            let data = table.cache['tabId'];
            if (data.length > 0) {
                let billCode = $('#billCode').val();
                let receivedTaskCode = $('#receivedTaskCode').val();
                let pointerName = $('#pointerName').val();
                let createTime = $('#createTime').val();
                let pointStart = $('#pointStart').val();
                let pointEnd = $('#pointEnd').val();
                let token = window.localStorage.token;
                let params = "";
                params +=
                    "billCode=" + billCode
                    + "&receivedTaskCode=" + receivedTaskCode
                    + "&pointerName=" + pointerName
                    + "&createTime=" + createTime
                    + "&pointStart=" + pointStart
                    + "&pointEnd=" + pointEnd
                    + "&token=" + token
                window.open(contextPath + 'pointProgressRateReport/downLoad?' + params);
            } else {
                layer.alert('导出失败！无数据', {
                    icon: 2
                });
            }
        }
    };

    function loadding() {
        table.render({
            elem: '#tab',
            id: 'tabId',
            url: contextPath + 'pointProgressRateReport/page',
            cols: [[
                {
                    type: 'numbers',
                    title: '序号'
                }, {
                    field: 'billCode',
                    title: '送货单号'
                }, {
                    field: 'receivedTaskCode',
                    title: '点收任务code码'
                }, {
                    field: 'createTime',
                    title: '到货日期'
                }, {
                    field: 'supplierName',
                    title: '供应商'
                }, {
                    field: 'pointerName',
                    title: '点收人'
                }, {
                    field: 'pointStart',
                    title: '点收开始时间'
                }, {
                    field: 'pointEnd',
                    title: '点收结束时间'
                }, {
                    field: 'pointTracks',
                    title: '点收时长'
                }, {
                    field: 'rate',
                    title: '完成率(进度)'
                },
            ]],
            page: {
                theme: '#008155'
            },
            even: true,
            done: function (res, page, count) {//列表数据回调函数

            }
        });
        $('.layui-btn-container button').on('click', function () {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });
        //时间选择器
        laydate.render({
            elem: '#createTime',
            type: 'date',
            range: true,
            trigger: 'click'
        });

        var start,end;
        //月份修正
        function doneTime(date){
            return {
                year: date.year,
                month: date.month - 1,
                date: date.date
            }
        };
        //时间选择器
        start = laydate.render({
            elem: '#pointStart'
            , type: 'date'
            , trigger: 'click'
            , done:function (value,date) {
                // 将选中的时间绑定到vo上
                // $scope.vo.startDate = new Date(value);
                //将结束日的初始值设定为开始日
                end.config.min = doneTime(date);
                end.config.value = doneTime(date);
            }
        });

        end = laydate.render({
            elem: '#pointEnd'
            , type: 'date'
            , trigger: 'click'
            ,done:function (value,date) {
                // 将选中的时间绑定到vo上
                // $scope.vo.endDate = new Date(value);
                //结束日选好后，重置开始日的最大日期
                start.config.max = doneTime(date);
            }
        });

        form.render();

    }
</script>
<script type="text/html" id="toolbar">
    <a class="layui-btn layui-btn-xs" lay-event="showDetail">查看</a>
</script>
</body>
</html>
