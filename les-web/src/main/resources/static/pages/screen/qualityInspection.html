<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<title>质检区实时信息</title>
	<link rel="stylesheet" type="text/css" href="../layui/css/layui.css"/>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>

<body>
<div class="wrap qualityInspection">
	<div class="header">
		<h1 class="textTitle">质检区实时信息</h1>
		<p class="subTitle">
			<span class="textSub textTime" id="date">0000-00-00 00:00:00</span>
			<span class="textSub subCenter">
				<span class="red">不合格</span>
				<span class="green">合格</span>
				<span class="yellow">部分合格</span>
			</span>
			<span class="textSub textTask" id="task">今日任务树：<span>0/0</span></span>
		</p>
	</div>
	<div class="main">
		<div class="layui-carousel carousel" id="area">
			<div carousel-item>
<!--				<div>条目1</div>-->
<!--				<div>条目2</div>-->
<!--				<div>条目3</div>-->
<!--				<div>条目4</div>-->
<!--				<div>条目5</div>-->
			</div>
		</div>
	</div>
</div>
<script src="../layui/layui.all.js" charset="UTF-8"></script>
<script src="../js/serverPathConfig.js" charset="UTF-8"></script>
<!--<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>-->
<script type="text/javascript">
	;!function () {
		var $ = layui.jquery
				,util = layui.util
				, carousel = layui.carousel;

		var contextPath = config.wmsConfig.contextPath;
		var ins = carousel.render({
			elem: '#area'
			// ,autoplay: false
			, width: '100%' //设置容器宽度
			, height: '385px'
			, arrow: 'hover' //始终显示箭头
			//,anim: 'updown' //切换动画方式
		});

		initialData();
		//get data
		function initialData() {
			$.ajax({
				url: contextPath+'receiveRecord/listQualityRecordCollectionScreen'
				,success: function (result) {
					console.log(result);
					if(result.code === 0){
						//update task
						var data = result.data ? result.data : {};
						var task = data.task ? data.task : null;
						var finished = data.finishedCount ? data.finishedCount : 0;
						var total = data.totalCount ? data.totalCount : 0;
						$('#task').find('span').html(finished+'/'+total);

						// generate carousel-item
						if(task&&task.length!==0){
							carouselItem(task);
							//重置轮播
							ins.reload();
						}else {
							ins.reload({
								elem: '#area'
								, height: 'auto'
							});
							$('.main').append('<p style="color: white;text-align: center">暂无数据</p>')
						}


					}
				}
			});
		}

		//generate carousel-item
		function carouselItem(data){
			var number = 6;
			var count = Math.ceil(data.length/number);
			for (var i=0;i<count;i++){
				const areaData = data.slice(i*number,(i+1)*number);
				var ele = areaItem(areaData);
				var wrap = $('<div class="layui-fluid wrap-area"></div>').append(ele);
				$('#area>div').append(wrap)
			}
		}

		//generate area item
		function areaItem(data){
			var wrap = $('<div class="layui-row layui-col-space10"></div>');
			data.forEach(function (item) {
				var eleList = $('<ul class="list"></ul>');
				var list = item.inspectResult ? item.inspectResult : [];
				list.forEach(function (item,index) {
					var color;
					switch (index) {
						case 0:
							color = 'red';
							break;
						case 1:
							color = 'green';
							break;
						case 2:
							color = 'yellow';
							break;
						default:
							color = 'yellow';
							break;
					}
					var eleInfo = $(`
							<li class="item-list ${color}">
								<span class="textLabel" title="${item.materialDesc}">${item.materialDesc}</span>
								<span class="textStatus">${item.qualifiedCount}/${item.totalCount}</span>
							</li>
					`);
					eleList.append(eleInfo);
				});
				var eleArea = $(`
					<div class="layui-col-xs4 item-wrap">
						<div class="item-area">
							<h3 class="textTitle">${item.area}</h3>
						</div>
					</div>
				`);
				eleArea.find('.item-area').append(eleList);
				wrap.append(eleArea)
			});
			return wrap
		}

		timer && clearInterval(timer);
		var timer = setInterval(function () {
			// update head time
			var dateTime = util.toDateString(new Date(),' %Y-%m-%d %H:%i:%s');
			$('#date').html(dateTime);
		}, 1000)
	}();
</script>
</body>

</html>
