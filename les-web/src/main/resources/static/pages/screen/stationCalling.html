<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
	<title>工位叫料实时信息</title>
	<link rel="stylesheet" type="text/css" href="../layui/css/layui.css"/>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>

<body>
<div class="wrap stationCalling">
	<div class="header">
		<h1 class="textTitle">工位叫料实时信息</h1>
	</div>
	<div class="main">
		<div id="pipe"></div>
	</div>
</div>
<script src="../layui/layui.all.js" charset="UTF-8"></script>
<!--<script src="../js/serverPathConfig.js" charset="UTF-8"></script>-->
<!--<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>-->
<script type="text/javascript">
	;!function () {
		var $ = layui.jquery;

		initialData();
		//get data
		function initialData() {
			$.ajax({
				url: "less4.json"
				,success: function (result) {
					console.log(result);
					if(result.code === 0){
						//update task
						var data = result.data ? result.data : [];

						// generate pipe
						if(data&&data.length!==0){
							generatePipe(data);
						}else {
							$('.main').append('<p style="color: white;text-align: center">暂无数据</p>')
						}
					}
				}
			});
		}

		//generate pipe
		var number = 13;
		function generatePipe(data){

			for(var j = 0;j<data.length;j++){
				var info = data[j].info ? data[j].info : [];
				if(info && info.length !==0){
					var wrap = $('<div class="wrapPipe"></div>');
					var infoLen = info.length;
					var line = Math.ceil(infoLen/number);
					for(var i=0;i<line;i++){
						var isFirst = i === 0;
						var isEven = i%2!==0;
						var lineData = info.slice(i*number,(i+1)*number);
						var lineWrap =  generateLine(lineData,isEven,isFirst);
						wrap.append(lineWrap);
					}
					$('#pipe').append(wrap);
				}
			}
		}

		//generate line
		function generateLine(data,isEven,isFirst) {
			console.log(data,isEven,isFirst);
			var type = isFirst ? 'first' : (isEven ? 'even' : '');
			var wrap = $(`<div class="wrapLine ${type}"></div>`);
			for(var i=0;i<data.length;i++){
				const emergency = data[i].emergency ? data[i].emergency : [];
				var isAction = emergency.length !==0;
				var ele = $(`
					<div class="itemInfo ${isAction ? 'action' : ''} ${i===0 ? 'first' : ''} ${i===number-1 ? 'last' : ''}">
						<div class="infoCount">
							<span class="textCount" title="${data[i].count}">${data[i].count}</span>
						</div>
						<div class="infoStation">
							<span class="textStation" title="${data[i].stationCode}">${data[i].stationCode}</span>
						</div>
					</div>
				`);
				isAction && ele.append(generateEmergency(emergency));
				wrap.append(ele);
			}
			return wrap;
		}

		//generate emergency
		function generateEmergency(data) {
			var wrap = $('<div class="wrapTip"></div>');
			for(var i=0;i<data.length;i++){
				var ele = $(`
					<div class="itemTip">
						<span class="textTipLabel" title="${data[i].materialDesc}">${data[i].materialDesc}</span>
						<span class="textTipCount" title="${data[i].count}">${data[i].count}${data[i].materialUnit}</span>
					</div>
				`);
				wrap.append(ele)
			}
			return wrap
		}

	}();
</script>
</body>

</html>
