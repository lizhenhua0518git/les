<#assign  title="库存类型配置" />
<#include '/header.html' /> 
<meta charset="UTF-8">
<#if athemTag.loginFlag=="true" && athemTag.menuFlag=="true">
	<div class="layui-fluid">
		<div class="layui-row layui-form">
			 
		 
			<div class="layui-col-md3">
			 	<label class="layui-form-label">库存类型:</label>
			 	 <div class="layui-input-block">
			       <select name="stockType" id="stockType" class="layui-select">
						<option value="">请选择</option>
						<option value="1">流动库存</option>
	                    <option value="2">积压库存</option>
	                    <option value="3">呆滞库存</option>
	                    <option value="4">低效库存</option>
					</select>
			    </div>
			</div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">
					<#include '/bottonContainer.html' /> 
				</div>
			</div>
		</div>
	</div>
	<table class="layui-hide" id="stockTypeDeployInfoTab" lay-filter="stockTypeDeployInfoTabF"></table>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script type="text/html" id="xh">
    {{d.LAY_TABLE_INDEX+1}}
</script>
    <script type="text/javascript">
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
   // var treeGrid = layui.treeGrid;
    var form = layui.form;
   // var upload = layui.upload;
    var oldData;
  //  var dictItems = null;//数据字典
    table.render({
        elem:'#stockTypeDeployInfoTab',
        id:'stockTypeDeployInfoTabId',
        url:'${ctx}/stockTypeDeploy/query',
        cols:[[
         {field:'序号', width:'10%', title: '序号',fixed: 'left',templet:'#xh'},
        {field:'stockType',width:'20%',title:'库存类型',sort:true},
        {field:'rule', width:'50%', title: '规则'},
        {fixed:'right',align:'center',title:'操作', toolbar:'#toolBar'}
        
       
        ]],
        page: false,
        height: 'full-95',
        even:true,
        done:function(res,page,count){//列表数据回调函数
            initTableDate(res.data);
          
        }
    });
     
    
    var active = {
            add:function(othis){
            	var type = othis.data('type');
                layer.open({
                 type: 2
                ,title:'新增库存类型配置信息'
                ,maxmin:true
                ,area: ['800px', '400px']
                ,offset: type 
                ,id: 'add'+type //防止重复弹出
                ,content: '${ctx}/pages/basicInfo/stockTypeDeploy/add.html'
                ,shade: 0 //不显示遮罩
                ,yes: function(){
                  layer.closeAll();
                }
              });
            },
            search:function(othis){
                var stockType=$('#stockType').val();
              
               
                var params={};
                params.stockType=stockType;
              
            
                  //执行重载
                  table.reload('stockTypeDeployInfoTabId', {
                    where:params
                   
                  });
            },reset:function(othis){
                $('#stockType').val("");
                form.render("select");
            }
            
    };
    
    table.on('tool(stockTypeDeployInfoTabF)', function(obj){
        var eventName = obj.event;          //事件名称
            //当前对象tr
        var clickObj = $(obj.tr[0]);  
        oldData =obj.data;
        if(eventName=="edit"){    //编辑
        	 
        	 $("#id").val(obj.data.id);
        	  layer.open({
                  type: 2
                 ,title:'库存类型配置编辑'
                 ,maxmin:true
                 ,area: ['800px', '500px']
                 ,offset: 33 
                 ,id: 'detailList' //防止重复弹出
                 ,content: '${ctx}/pages/basicInfo/stockTypeDeploy/edit.html'
                 ,shade: 0 //不显示遮罩
                 ,yes: function(){
                   layer.closeAll();
                 }
               });
        }
	  });
    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });
    table.on('sort(stockTypeDeployInfoTabF)', function (obj) {
        var sortColums;
        if(obj.field=="stockType"){
            sortColums = "stock_type "+obj.type;
        } 
        var stockType=$('#stockType').val();
        
          //执行重载
          table.reload('stockTypeDeployInfoTabId', {
            where:{
            	stockType:stockType,
                sortColums:sortColums
                
            }
          });
    });
    //表格数据初始化
    function initTableDate(data){
        
        $("[data-field='stockType']").children().each(function(){
            if($(this).text()=='1'){
                $(this).text('流动库存');
            }else if($(this).text()=='2'){
                $(this).text('积压库存');
            }else if($(this).text()=='3'){
                $(this).text('呆滞库存');
            }else if($(this).text()=='4'){
                $(this).text('低效库存');
            }
        });
    }
   
    
     
     
</script>
<script type="text/html" id="toolBar">
<button type="button" class="layui-btn layui-btn-normal" id="edit" lay-event="edit">编辑</button>
   
 </script>
<#else>
    <#include '/noAuthority.html' /> 
</#if> 
<#include '/footer.html' /> 