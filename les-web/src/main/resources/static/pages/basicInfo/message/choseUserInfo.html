<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<title>选择用户</title>
</head>
<body>
	<div class="layui-fluid">
		<div class="layui-row layui-form">
				 <div class="layui-col-md3">
				 	<label class="layui-form-label">用户姓名:</label>
				 	 <div class="layui-input-block">
				      <input type="text" id="userName_search" class="layui-input">
				    </div>
				 </div>
				 <div class="layui-col-md3">
				 	<label class="layui-form-label">用户组织:</label>
				 	 <div class="layui-input-block">
				      <input type="text" id="orgId_search" class="layui-input">
				    </div>
				 </div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search"><i class="layui-icon">&#xe615;</i>查询</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset"><i class="mine-icon">&#xe640;</i>重置</button>
				</div>
			</div>
		</div>
	</div>
	<table class="layui-hide" id="userTab" lay-filter="userTabF"></table>
	 <script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
	<script src="/iles/pages/layui/lay/modules/tableFilter.js" charset="UTF-8"></script>
	<script src="/iles/pages/assets/js/jquery-1.10.2.js"></script>
	<script src="/iles/pages/js/loginInspect.js"></script>


	<script type="text/html" id="bodyTpl"></script>
	<script type="text/javascript">
	 var contextPath = config.basicInfoConfig.contextPath;
	 function loadding(){

	 }
		var $ = layui.$;
		var element = layui.element;
		var layer = layui.layer;
		var table = layui.table;
		var oldData;
		table.render({
			elem:'#userTab',
			id:'userTabId',
			url:contextPath+'user/',
			cols:[[
			{type:'checkbox'},
			//{field:'id', width:80, title: 'ID', sort: true},
			{field:'userName',title:'用户姓名',sort:true},
			{field:'orgId', title: '用户组织', sort: true}
			]],
			page: {theme: '#008155'},
    		even:true,
    		request: {
    			  pageName: 'pageNumber' //页码的参数名称，默认：page
    			  ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
    			},
    		done:function(res,page,count){//列表数据回调函数
    			//状态数据处理
	    		$("[data-field='status']").children().each(function(){
	    			if($(this).text()=='0'){
	    				$(this).text("禁用");
	    			}else if($(this).text()=='1'){
	    				$(this).text("启用");
	    			}
	    		});
    		}
		});
		var active = {
				search:function(othis){
					var userName = $('#userName_search');
					var orgId = $('#orgId_search');
					var status = $('#status_search');
				      //执行重载
				      table.reload('userTabId', {
				        where:{
				           userName: userName.val()
				           ,orgId:orgId.val()
				           ,status:status.val()
				           ,page:1
				        }
				      });
				},reset:function(othis){
					$('#userName_search').val("");
					$('#orgId_search').val("");
					$('#status_search').val("");
					$("#status_search option[value='']").attr("selected", "selected");
					$("#status_search").attr("text", "请选择");
				}
		};
		$('.layui-btn-container button').on('click', function(){
		    var othis = $(this), method = othis.data('method');
		    active[method] ? active[method].call(this, othis) : '';
	  	});
		//隐藏全选的复选框
		$("input[lay-filter=layTableAllChoose]").parent().hide();
		table.on('sort(userTabF)', function (obj) {
			var sortColums;
			if(obj.field=="userName"){
				sortColums = "user_name "+obj.type;
			}else if(obj.field=="orgId"){
				sortColums = "org_id "+obj.type;
			}else if(obj.field=="status"){
				sortColums = "status "+obj.type;
			}
			var userName = $('#userName_search');
			var orgId = $('#orgId_search');
			var status = $('#status_search');
		      //执行重载
		      table.reload('userTabId', {
		        where:{
		           userName: userName.val()
		           ,orgId:orgId.val()
		           ,status:status.val()
		           ,sortColums:sortColums
		        }
		      });
		});
		table.on('checkbox(userTabF)',function(res){
        	if(res.checked){
        		parent.$("#userId").val(res.data.id);
        		parent.$("#userName").val(res.data.userName);
        		parent.layer.closeAll();
        	}
	    });
	</script>
</body>
</html>
