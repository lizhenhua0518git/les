<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
	<link rel="stylesheet" href="/iles/pages/css/layui_extend.css" type="text/css" />

<title>策略管理</title>

 </head>

 <body id="bodyDiv">

 <script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
 <script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
 <script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
 <script src="/iles/pages/js/common/dictTableSelect.js" charset="UTF-8"></script>
 <script type="text/html" id="bodyTpl">
<div class="layui-fluid">
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">策略名称</label>
				<div class="layui-input-inline">
					<select name="dictTypeId" id="dictTypeId">
						<option value="-1">请选择</option>
					</select>
				</div>
			</div>



	<div class="layui-btn-container" style="text-align: right;">
		{{# if(d.search==null || d.search=="true"){ }}
		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
		{{# } }}
	</div>
</div>




</div>

	<table class="layui-hide" id="strategyInfoTab" lay-filter="strategyInfoTabF"></table>
   </script>

    <script type="text/javascript">
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;

    var form = layui.form;

    var oldData;
    var contextPath = config.basicInfoConfig.contextPath;

	function loadding() {
		queryDictList('dictTypeId', '','_strategy');
		form.render("select");
		table.render({
			elem: '#strategyInfoTab',
			id: 'strategyInfoTabId',
			data: []   ,
			cols: [[
				{type: 'radio'},
				{type: 'numbers', title: '序号', width: 60},
				{field: 'itemName', width: '20%', title: '策略名称',},
				{field: 'itemValue', width: '20%', title: '策略编码'},
				{field: 'flagName', width: '20%', title: '是否启用'}

			]],
			page: {theme: '#008155'},
			height: 'full-95',
			even: true,
			done: function (res, page, count) {//列表数据回调函数

                for(var i=0;i<res.data.length;i++){
					//可以自行添加判断的条件是否选中
					//这句才是真正选中，通过设置关键字LAY_CHECKED为true选中，这里只对第一行选中
					if(res.data[i].flag!= '-1'){
						//下面三句是通过更改css来实现选中的效果
						var index = res.data[i]['LAY_TABLE_INDEX'];
						$('tr[data-index=' + index + '] input[type="radio"]').prop('checked', true);
						$('tr[data-index=' + index + '] input[type="radio"]').next().addClass('layui-form-checked');
						$('tr[data-index=' + index + ']').addClass('layui-anim-scaleSpring');
						break;
					}


				}
				form.render('radio');

			}


		});

		//监听行单击事件
		table.on('radio(strategyInfoTabF)', function(obj){

			var data = obj.data;
			layer.confirm('确定修改为当前记录?', {icon: 3, title:'提示'}, function(index){
			updateInfo(data);
				layer.close(index);
			});

		});


		var active = {


			search: function (othis) {
				var dictTypeId = $('#dictTypeId').val();
				if(null==dictTypeId || ''===dictTypeId){
					layer.alert("请先选择策略");
					return;
				}
				var params = {};
				params.dictTypeId = dictTypeId;

				//执行重载
				table.reload('strategyInfoTabId', {
					where: params,
					url: contextPath + 'strategy/list/',
					page: {"curr": 1}
				});
			}, reset: function (othis) {

				$('#dictTypeId').val("");

				form.render("select");
			}

		};
		$('.layui-btn-container button').on('click', function () {
			var othis = $(this), method = othis.data('method');
			active[method] ? active[method].call(this, othis) : '';
		});


		function updateInfo(data) {
            var dictId = $('#dictTypeId').val();
			var option = {
				url: contextPath + 'strategy/save',
				data: {"dictItemId": data.id,"dictType":data.itemValue,"dictId":dictId},
				type: 'POST',
				success: function (data) {
                 //执行重载
					var dictTypeId = $('#dictTypeId').val();
					var params = {};
					params.dictTypeId = dictTypeId;
					table.reload('strategyInfoTabId', {
						where: params,
						url: contextPath + 'strategy/list/',
						page: {"curr": 1}
					});
				}, error: function (data) {
					layer.alert(data.msg)
				}
			}
			$.ajax(option);
		}

	}

</script>
</body>
</html>
