<#assign  title="项目余料配置配置" />
<#include '/header.html' />
<meta charset="UTF-8">
<#if athemTag.loginFlag=="true" && athemTag.menuFlag=="true">
	<div class="layui-fluid">
		<div class="layui-row layui-form">


		<div class="layui-col-md3">
			 	<label class="layui-form-label">项目号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="projectCode" class="layui-input">
			    </div>
			</div>
			<div class="layui-col-md3">
			 	<label class="layui-form-label">BOM头编号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="bomHeadCode" class="layui-input">
			    </div>
			</div>

		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">
					<#include '/bottonContainer.html' />
				</div>
			</div>
		</div>
	</div>
	<table class="layui-hide" id="projectDeployInfoTab" lay-filter="projectDeployInfoTabF"></table>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script type="text/html" id="xh">
    {{d.LAY_TABLE_INDEX+1}}
</script>
    <script type="text/javascript">
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var oldData;

    table.render({
        elem:'#projectDeployInfoTab',
        id:'projectDeployInfoTabId',
        url:'${ctx}/projectDeploy/query',
        cols:[[
         {type:'checkbox'},
         {field:'序号', width:'10%', title: '序号',fixed: 'left',templet:'#xh'},
         {field:'projectCode',width:'20%',title:'项目号'},
        {field:'bomHeadCode',width:'30%',title:'BOM头编号'},

        {field:'endTime', width:'20%', title: '结束时间'},
        {fixed:'right',align:'center',title:'操作', toolbar:'#toolBar'}


        ]],
        page: {theme: '#008155'},
        height: 'full-95',
        even:true,
        done:function(res,page,count){//列表数据回调函数

        	//initTableDate(res.data)
        }
    });


    var active = {
            add:function(othis){
            	var type = othis.data('type');
                layer.open({
                 type: 2
                ,title:'新增项目余料配置信息'
                ,maxmin:true
                ,area: ['600px', '540px']
                ,offset: type
                ,id: 'add'+type //防止重复弹出
                ,content: '${ctx}/pages/basicInfo/projectDeploy/add.html'
                ,shade: 0 //不显示遮罩
                ,yes: function(){
                  layer.closeAll();
                }
              });
            },
            del:function(othis){
                var checkStatus = table.checkStatus('projectDeployInfoTabId');
                oldData = checkStatus.data;
                if(oldData.length<=0){
                    layer.alert('请选择要删除的行！',{icon: 2});
                    return ;
                }
                var idarrys = new Array();
                for(var i=0;i<oldData.length;i++){
                    idarrys.push(oldData[i].id);
                }
                layer.confirm('确定删除选中的信息吗?', {icon: 3, title:'提示'}, function(index){
                      //do something
                      var option ={
                            url:'${ctx}/projectDeploy/del',
                            type:'POST',
                            contentType: "application/json",
                            dataType:'json',
                            data:JSON.stringify(idarrys),
                            success:function(data){
                                if(data.code==0){
                                	table.reload('projectDeployInfoTabId');//刷新列表
                                }
                            },error:function(data){
                                layer.alert(data.msg);
                            }
                        }
                        $.ajax(option);
                      layer.close(index);
                    });
            },
            search:function(othis){
                var projectCode=$('#projectCode').val();
                var bomHeadCode=$('#bomHeadCode').val();

                var params={};
                params.projectCode=projectCode;
                params.bomHeadCode=bomHeadCode;

                  //执行重载
                  table.reload('projectDeployInfoTabId', {
                    where:params

                  });
            },reset:function(othis){
                $('#bomHeadCode').val("");
                $('#projectCode').val("");
            }

    };

    table.on('tool(projectDeployInfoTabF)', function(obj){
        var eventName = obj.event;          //事件名称
            //当前对象tr
        var clickObj = $(obj.tr[0]);
        oldData =obj.data;
        if(eventName=="edit"){    //编辑

        	 $("#id").val(obj.data.id);
        	  layer.open({
                  type: 2
                 ,title:'项目余料配置配置编辑'
                 ,maxmin:true
                 ,area: ['600px', '540px']
                 ,offset: 33
                 ,id: 'detailList' //防止重复弹出
                 ,content: '${ctx}/pages/basicInfo/projectDeploy/edit.html'
                 ,shade: 0 //不显示遮罩
                 ,yes: function(){
                   layer.closeAll();
                 }
               });
        }else if(eventName=="editTime"){    //编辑

       	 $("#id").val(obj.data.id);
       	  layer.open({
                 type: 2
                ,title:'项目余料配置统计时间'
                ,maxmin:true
                ,area: ['600px', '540px']
                ,offset: 33
                ,id: 'detailList' //防止重复弹出
                ,content: '${ctx}/pages/basicInfo/projectDeploy/editTime.html'
                ,shade: 0 //不显示遮罩
                ,yes: function(){
                  layer.closeAll();
                }
              });
       }
	  });
    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });
    table.on('sort(projectDeployInfoTabF)', function (obj) {
        var sortColums;
        if(obj.field=="waringType"){
            sortColums = "waring_type "+obj.type;
        }
        var waringType=$('#waringType').val();

          //执行重载
          table.reload('projectDeployInfoTabId', {
            where:{
            	waringType:waringType,
                sortColums:sortColums

            }
          });
    });



</script>
<script type="text/html" id="toolBar">
<button type="button" class="layui-btn layui-btn-normal" id="edit" lay-event="edit">编辑</button>
<button type="button" class="layui-btn layui-btn-normal" id="editTime" lay-event="editTime">修改统计时间</button>


 </script>
<#else>
    <#include '/noAuthority.html' />
</#if>
<#include '/footer.html' />
