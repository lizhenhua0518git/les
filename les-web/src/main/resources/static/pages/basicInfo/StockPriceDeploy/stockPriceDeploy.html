<#assign  title="库存资金指标配置" />
<#include '/header.html' />
<meta charset="UTF-8">
<#if athemTag.loginFlag=="true" && athemTag.menuFlag=="true">
	<div class="layui-fluid">
		<div class="layui-row layui-form">


			<div class="layui-col-md3">
			 	<label class="layui-form-label">产品线:</label>
			 	 <div class="layui-input-block">
			       <select name="produceLineCode" id="produceLineCode" class="layui-select">
						<option value="">请选择</option>

					</select>
			    </div>
			</div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">
					<#include '/bottonContainer.html' />
				</div>
			</div>
		</div>
	</div>
	<table class="layui-hide" id="stockPriceDeployInfoTab" lay-filter="stockPriceDeployInfoTabF"></table>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script type="text/html" id="xh">
    {{d.LAY_TABLE_INDEX+1}}
</script>
    <script type="text/javascript">
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var oldData;
    //获取产品线列表
    getProductLine();
    table.render({
        elem:'#stockPriceDeployInfoTab',
        id:'stockPriceDeployInfoTabId',
        url:'${ctx}/stockPriceDeploy/query',
        cols:[[
         {field:'序号', width:'10%', title: '序号',fixed: 'left',templet:'#xh'},
         {field:'produceLineName',width:'20%',title:'产品线'},
        {field:'productPrice',width:'20%',title:'库存资金指标'},
        {field:'userName', width:'20%', title: '修改人'},
        {field:'updateDate', width:'20%', title: '修改时间'},
        {fixed:'right',align:'center',title:'操作', toolbar:'#toolBar'}


        ]],
        page: {theme: '#008155'},
        height: 'full-95',
        even:true,
        done:function(res,page,count){//列表数据回调函数


        }
    });


    var active = {
            add:function(othis){
            	var type = othis.data('type');
                layer.open({
                 type: 2
                ,title:'新增库存资金指标配置信息'
                ,maxmin:true
                ,area: ['600px', '400px']
                ,offset: type
                ,id: 'add'+type //防止重复弹出
                ,content: '${ctx}/pages/basicInfo/stockPriceDeploy/add.html'
                ,shade: 0 //不显示遮罩
                ,yes: function(){
                  layer.closeAll();
                }
              });
            },
            search:function(othis){
                var produceLineCode=$('#produceLineCode').val();


                var params={};
                params.produceLineCode=produceLineCode;


                  //执行重载
                  table.reload('stockPriceDeployInfoTabId', {
                    where:params

                  });
            },reset:function(othis){
                $('#produceLineCode').val("");
                form.render("select");
            }

    };

    table.on('tool(stockPriceDeployInfoTabF)', function(obj){
        var eventName = obj.event;          //事件名称
            //当前对象tr
        var clickObj = $(obj.tr[0]);
        oldData =obj.data;
        if(eventName=="edit"){    //编辑

        	 $("#id").val(obj.data.id);
        	  layer.open({
                  type: 2
                 ,title:'库存资金指标配置编辑'
                 ,maxmin:true
                 ,area: ['800px', '500px']
                 ,offset: 33
                 ,id: 'detailList' //防止重复弹出
                 ,content: '${ctx}/pages/basicInfo/stockPriceDeploy/edit.html'
                 ,shade: 0 //不显示遮罩
                 ,yes: function(){
                   layer.closeAll();
                 }
               });
        }
	  });
    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });
    table.on('sort(stockPriceDeployInfoTabF)', function (obj) {
        var sortColums;
        if(obj.field=="produceLineCode"){
            sortColums = "product_name "+obj.type;
        }
        var produceLineCode=$('#produceLineCode').val();

          //执行重载
          table.reload('stockPriceDeployInfoTabId', {
            where:{
            	produceLineCode:produceLineCode,
                sortColums:sortColums

            }
          });
    });


    function getProductLine(){

    	 var option ={
    	           url:'${ctx}/produceLine/queryProduceLinelist',
    	           type:'POST',
    	           dataType:'json',
    	           async:false,
    	           success:function(data){
    	               if(data.code==0){
    	               	var list =data.data;
    	               	var html = '<option value="">请选择</option>';

    	               for(var i =0;i<list.length;i++){
    	            	   html=html+ '<option value="'+list[i].produceLineCode+'">'+list[i].produceLineName+'</option>';
    	               }
    	              $("#produceLineCode").html(html)
    	              form.render("select");
    	             }

    	           },error:function(data){
    	               layer.alert(data.msg);
    	           }
    	       }
    	       $.ajax(option);
    }


</script>
<script type="text/html" id="toolBar">
<button type="button" class="layui-btn layui-btn-normal" id="edit" lay-event="edit">编辑</button>

 </script>
<#else>
    <#include '/noAuthority.html' />
</#if>
<#include '/footer.html' />
