<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<title>设置人员</title>
</head>
<body>
 <div id="bodyDiv">

</div>
	<div style="padding: 20px; background-color: #F2F2F2;">
  		<div class="layui-row layui-col-space15" style="position:relative;float:left;width:42%;height:100%;margin-top:24px">
		    <div>
		      <div class="layui-card">
		        <div class="layui-card-header">当前对应用户</div>
		        <div class="layui-card-body">
		        	<div class="layui-collapse">
					  	<div class="layui-colla-item">
						    <h2 class="layui-colla-title">检索信息</h2>
						    <div class="layui-colla-content">
						      	<div class="layui-fluid">
									<div class="layui-row layui-form">
										 <div class="layui-col-md6">
										 	<label class="layui-form-label">用户姓名:</label>
										 	 <div class="layui-input-block">
										      <input type="text" id="userName_search" class="layui-input">
										    </div>
										 </div>
										 <div class="layui-col-md6">
										 	<label class="layui-form-label">用户组织:</label>
										 	 <div class="layui-input-block">
										      <input type="text" id="orgId_search" class="layui-input">
										    </div>
										 </div>
									</div>
									<div class="layui-row layui-form" style="margin-bottom: 0">
										<div class="layui-col-md6">&nbsp;</div>
										<div class="layui-col-md6">
											<div class="layui-btn-container" style="text-align: right;">
											  <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search"><i class="layui-icon">&#xe615;</i>查询</button>
											  <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset"><i class="mine-icon">&#xe640;</i>重置</button>
											</div>
										</div>
									</div>
								</div>
						    </div>
					  	</div>
					  </div>
				     <table class="layui-hide" id="currUserTab" lay-filter="currUserTabF"></table>
		        </div>
		      </div>
		    </div>
		 </div>
		 <div class="layui-row layui-form" style="margin-bottom: 0;position:relative;margin-top:111px;float:left;width:10%;">
				<div class="layui-col-md5">&nbsp;</div>
				<div class="layui-col-md5">
					<div class="layui-btn-container" style="text-align: left;margin-top:15px;">
					  <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="up" data-type="auto"><!-- <i class="layui-icon">&#xe61f;</i> -->左移</button>
					  <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="down" style="margin-top:30px;"><!-- <i class="layui-icon">&#xe642;</i> -->右移</button>
					</div>
				</div>
			</div>
		 <div class="layui-row layui-col-space15" style="position:relative;float:right;width:42%;height:100%;margin-top:24px">
		    <div>
		      <div class="layui-card">
		        <div class="layui-card-header">未设置用户</div>
		        <div class="layui-card-body">
		        	<div class="layui-collapse">
					  	<div class="layui-colla-item">
						    <h2 class="layui-colla-title">检索信息</h2>
						    <div class="layui-colla-content">
						      	<div class="layui-fluid">
									<div class="layui-row layui-form">
										 <div class="layui-col-md6">
										 	<label class="layui-form-label">用户姓名:</label>
										 	 <div class="layui-input-block">
										      <input type="text" id="userName_search_n" class="layui-input">
										    </div>
										 </div>
										 <div class="layui-col-md6">
										 	<label class="layui-form-label">用户组织:</label>
										 	 <div class="layui-input-block">
										      <input type="text" id="orgId_search_n" class="layui-input">
										    </div>
										 </div>
									</div>
									<div class="layui-row layui-form" style="margin-bottom: 0">
										<div class="layui-col-md6">&nbsp;</div>
										<div class="layui-col-md6">
											<div class="layui-btn-container" style="text-align: right;">
											  <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="searchN"><i class="layui-icon">&#xe615;</i>查询</button>
											  <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="resetN"><i class="mine-icon">&#xe640;</i>重置</button>
											</div>
										</div>
									</div>
								</div>
						    </div>
					  	</div>
					  </div>
				    <table class="layui-hide" id="userTab" lay-filter="userTabF"></table>
		        </div>
		      </div>
		    </div>
		 </div>
	</div>
	<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
	<script src="/iles/pages/layui/lay/modules/tableFilter.js" charset="UTF-8"></script>
	<script src="/iles/pages/assets/js/jquery-1.10.2.js"></script>
	<script src="/iles/pages/js/loginInspect.js"></script>
		<script type="text/html" id="bodyTpl"></script>
	<script type="text/javascript">
	var contextPath = config.basicInfoConfig.contextPath;
	function loadding(){}
	var $ = layui.$;
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var roleId = parent.roleId;
	//未设置用户
	table.render({
		elem:'#userTab',
		id:'userTabId',
		url:contextPath+'user/queryNoRoleUser',
		cols:[[
		{type:'checkbox'},
		//{field:'id', width:80, title: 'ID', sort: true},
		{field:'userName',width:'40%',title:'用户姓名'},
		//{field:'phone', width:'20%', title: '用户手机'},
		{field:'orgId', width:'40%', title: '用户组织'},
		//{field:'avatar', width:'20%',title: '用户头像'},
		//{field:'status', width:'8%', title: '状态'}

		]],
		page: {theme: '#008155'},
		where:{"roleId":roleId},
		//height: 'full-95',
		even:true,
		request: {
			  pageName: 'pageNumber' //页码的参数名称，默认：page
			  ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
			},
		done:function(res,page,count){//列表数据回调函数
			//状态数据处理
    		$("[data-field='status']").children().each(function(){
    			if($(this).text()=='0'){
    				$(this).text("禁用");
    			}else if($(this).text()=='1'){
    				$(this).text("启用");
    			}
    		});
		}
	});
	//当前对应用户
	table.render({
		elem:'#currUserTab',
		id:'currUserTabId',
		url:contextPath+'user/listHasRoleUser',
		cols:[[
		{type:'checkbox'},
		//{field:'id', width:80, title: 'ID', sort: true},
		{field:'userName',width:'40%',title:'用户姓名'},
		//{field:'phone', width:'20%', title: '用户手机'},
		{field:'orgId', width:'40%', title: '用户组织'},
		//{field:'avatar', width:'25%',title: '用户头像'},
		//{field:'status', width:'8%', title: '状态'}

		]],
		page: {theme: '#008155'},
		where:{"roleId":roleId},
		//height: 'full-95',
		even:true,
		request: {
			  pageName: 'pageNumber' //页码的参数名称，默认：page
			  ,limitName: 'pageSize' //每页数据量的参数名，默认：limit
			},
		done:function(res,page,count){//列表数据回调函数
			//状态数据处理
    		$("[data-field='status']").children().each(function(){
    			if($(this).text()=='0'){
    				$(this).text("禁用");
    			}else if($(this).text()=='1'){
    				$(this).text("启用");
    			}
    		});
		}
	});
	var active = {
			up:function(othis){
				var checkStatus = table.checkStatus('userTabId');
  				var userData = checkStatus.data;
				if(userData.length<=0){
					layer.alert('请选择要左移的行！',{icon: 2});
  					return ;
				}
				var tempData = "";
				for(var i=0;i<userData.length;i++){
					tempData = tempData + "{'userId':"+"'"+userData[i].id+"'"+",'roleId':'"+roleId+"'},";
				}
				tempData = "["+tempData.substring(0,tempData.length-1)+"]";
				var option = {
						url:contextPath+'userRole/saveUserRole',
						type:'POST',
						data: JSON.stringify(eval('('+tempData+')')),
			        	contentType:'application/json',
						success:function(res){
							if(res.code==0){//成功后刷新列表
								table.reload('currUserTabId');
								table.reload('userTabId');
							}
						}
				};
				$.ajax(option);
			}
			,down:function(othis){
				var checkStatus = table.checkStatus('currUserTabId');
  				var userData = checkStatus.data;
				if(userData.length<=0){
					layer.alert('请选择要右移的行！',{icon: 2});
  					return ;
				}
				var tempData = "";
				for(var i=0;i<userData.length;i++){
					tempData = tempData + "{'userId':"+"'"+userData[i].id+"'"+",'roleId':'"+roleId+"'},";
				}
				tempData = "["+tempData.substring(0,tempData.length-1)+"]";
				var option = {
						url:contextPath+'userRole/deleteUserRole',
						type:'POST',
						data: JSON.stringify(eval('('+tempData+')')),
			        	contentType:'application/json',
						success:function(res){
							if(res.code==0){//成功后刷新列表
								table.reload('currUserTabId');
								table.reload('userTabId');
							}
						}
				};
				$.ajax(option);
			},search:function(othis){
				var userName = $('#userName_search');
				var orgId = $('#orgId_search');
			      //执行重载
			      table.reload('currUserTabId', {
			        where:{
			           userName: userName.val()
			           ,orgId:orgId.val()
			        }
			        ,page:{"curr":1}
			      });
			},reset:function(othis){
				$('#userName_search').val("");
				$('#orgId_search').val("");
			},searchN:function(othis){
				var userName = $('#userName_search_n');
				var orgId = $('#orgId_search_n');
			      //执行重载
			      table.reload('userTabId', {
			        where:{
			           userName: userName.val()
			           ,orgId:orgId.val()
			        }
			        ,page:{"curr":1}
			      });
			},resetN:function(othis){
				$('#userName_search_n').val("");
				$('#orgId_search_n').val("");

			}
	};
	$('.layui-btn-container button').on('click', function(){
	    var othis = $(this), method = othis.data('method');
	    active[method] ? active[method].call(this, othis) : '';
  	});
	</script>
</body>
</html>
