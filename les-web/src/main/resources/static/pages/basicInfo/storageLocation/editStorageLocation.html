<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<title>编辑供应商信息</title>
</head>
<body>
<div id="bodyDiv">

</div>
<div class="layui-container">
    <form class="layui-form" lay-filter="storageLocationForm">
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">仓库</label>
                <div class="layui-input-block">
                    <select name="warehouseCode" id="warehouseCode" lay-verify="warehouseCode">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">仓库库存地</label>
                <div class="layui-input-block">
                    <input type="text" name="storageLocation" id="storageLocation" lay-verify="storageLocation" autocomplete="off" placeholder="请输入库存地点" class="layui-input" >
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">工厂</label>
                <div class="layui-input-block">
                    <select name="factoryCode" id="factoryCode" lay-verify="factoryCode">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label" >状态</label>
                <div class="layui-input-block">
                    <select name="status" id="status" lay-verify="status">
                        <option value="1">启用</option>
                        <option value="0">禁用</option>
                    </select>
                </div>
            </div>
<!--            <div class="layui-inline">-->
<!--                <label class="layui-form-label" >工厂库存地</label>-->
<!--                <div class="layui-input-block">-->
<!--                    <input type="text" name="sapStorageLocation" id="sapStorageLocation" lay-verify="sapStorageLocation" autocomplete="off" placeholder="请输入工厂库存地" class="layui-input" >-->
<!--                </div>-->
<!--            </div>-->
        </div>
<!--        <div class="layui-form-item">-->
<!--            -->
<!--        </div>-->
        <div class="layui-form-item">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-normal layui-btn-sm" lay-submit="" lay-filter="storageLocationSubit"><i class="layui-icon layui-icon-set-sm"></i>保存</button>
                <button class="layui-btn layui-btn-normal layui-btn-sm"  lay-submit=""  lay-filter="reset"><i class="layui-icon-reset"></i>重置</button>
            </div>
        </div>
    </form>
</div>
<script type="text/html" id="bodyTpl"></script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script type="text/javascript">
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form
    var dictItems = null;//数据字典
    var oldData = parent.oldData;
    var contextPath = config.basicInfoConfig.contextPath;
    function loadding(){
        console.log(oldData);
        initWarehouseSignSelect("warehouseCode",2,oldData[0].warehouseCode);
        inintFactorySelect("factoryCode",oldData[0].factoryCode);
        initData();
    };
    layui.use(['form', 'layedit'], function(){
        form.verify({
            warehouseCode:function(value){
                if(value.length < 1){
                    return '请选择仓库';
                }
            }
            ,storageLocation:function(value){
                if(value==''){
                    return '请输入仓库库存地';
                }
            },factoryCode:function(value){
                if(value.length < 1){
                    return '请选择工厂';
                }
            }
            // ,sapStorageLocation:function(value){
            //     if(value==''){
            //         return '请输入工厂库存地';
            //     }
            // }
        });
        //监听提交
        form.on('submit(storageLocationSubit)', function(data){
            data.field.id = oldData[0].id;//防止重置后id丢失
            let sourceEntrepot = $('#warehouseCode').find("option:selected").text();
            data.field.warehouseName=sourceEntrepot
            console.log(data.field);
            editDict(data.field);
            return false;
        });
    });
    function editDict(data){
        var option = {
            url:contextPath + 'storageLocation/updateStorageLocation',
            data:JSON.stringify(data),
            contentType: "application/json",
            type:'POST',
            success:function(data){
                if(data.code==0){
                    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);  // 关闭layer
                    parent.table.reload('storageLocationTabId');
                }else{
                    layer.alert(data.data);
                }
            },error:function(data){
                layer.alert(data.msg)
            }
        }
        $.ajax(option);
    }

    //初始化表单数据
    function initData(){
        if(oldData && oldData.length>0){
            var formData =  eval('('+JSON.stringify(oldData[0])+')');
            form.val('storageLocationForm',formData);
            form.render('select');
        }
    }
	</script>
</body>
</html>