<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<title>编辑作业区域信息</title>
</head>
<body id="bodyDiv">
<script type="text/html" id="bodyTpl">
	<div class="layui-container">
		<form class="layui-form" action="" lay-filter="workAreaForm">
			<div class="layui-form-item">
				<div class="layui-inline">
					<label class="layui-form-label">仓库：</label>
					<div class="layui-input-block">
						<select  name="warehouseCode" id="warehouseCode" class="layui-select">
							<option value="">请选择</option>
						</select>
					</div>
				</div>
				<div class="layui-inline">
					<label class="layui-form-label">作业区域名称</label>
					<div class="layui-input-block">
						<input type="text" name="workAreaName" id="workAreaName" lay-verify="workAreaName" autocomplete="off" placeholder="请输入作业区域名称，中英文字符" class="layui-input">
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-btn-container" style="text-align: center;">
					<button class="layui-btn layui-btn-normal layui-btn-sm" lay-submit="" lay-filter="workAreaSubit"><i class="layui-icon layui-icon-set-sm"></i>保存</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm"  lay-submit=""  lay-filter="reset"><i class="layui-icon-reset"></i>重置</button>
				</div>
			</div>
			<input type="text" hidden="true" name="id">
		</form>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script type="text/javascript">
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
	var contextPath = config.basicInfoConfig.contextPath;
	function loadding(){
		initData();
	};
	layui.use(['form', 'layedit'], function(){
		form.verify({
			workAreaName:function(value){
				if(value.length < 1){
					return '作业区域名称不能为空';
				}
				if(value.length>50){
					return '作业区域名称超长，不能超过50个字符';
				}
			},warehouseCode:function(value){
				if(value==''){
				  	return '请选择仓库';
				}
			}
		});
		//监听提交
		form.on('submit(workAreaSubit)', function(data){
			saveDict(data);
			return false;
		});
	});
	function saveDict(data){
		var warehouseName =$("#warehouseCode").find("option:selected").text();
		data.field.warehouseName=warehouseName;
		var workAreaName = $("#workAreaName").val();
		data.field.workAreaName = workAreaName;
		console.log(data.field);
		var option = {
			url:contextPath+'workArea/updateWorkArea',
			data:JSON.stringify(data.field),
			type:'POST',
			contentType:'application/json',
			success:function(data){
				if(data.code==0){
					var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
					parent.layer.close(index);  // 关闭layer
					parent.table.reload('workAreaTabId');
				}else{
					layer.alert(data.data);
				}
			},error:function(data){
				layer.alert(data.msg)
			}
		}
		$.ajax(option);
	}

	//初始化表单数据
	function initData(){
		var oldData = parent.oldData;
		console.log(oldData);
		if(oldData && oldData.length>0){
			var formData =  eval('('+JSON.stringify(oldData[0])+')');
			var warehouseCode = oldData[0].warehouseCode;
			form.val('workAreaForm',formData);
			initWarehouseSignSelect("warehouseCode",1,warehouseCode);
			form.render('select');
		}
	}
</script>
</body>
</html>