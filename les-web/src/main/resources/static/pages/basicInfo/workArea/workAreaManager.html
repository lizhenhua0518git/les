<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<title>作业区域信息管理</title>
</head>
<body>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		<div class="layui-row layui-form" lay-filter="component-form-element">
			<div class="layui-col-md2">
				<label class="layui-form-label">仓库编号</label>
				<div class="layui-input-inline">
					<select id="warehouseCode" xm-select="warehouseCodeSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">区域编码:</label>
				<div class="layui-input-inline">
					<input type="text" id="workAreaCode" placeholder="请输入编码" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">区域名称:</label>
				<div class="layui-input-inline">
					<input type="text" id="workAreaName" placeholder="请输入名称"  class="layui-input">
				</div>
			</div>
			<div class="layui-col-md2">
				<div class="layui-btn-container nav-" style="text-align: right;">
					{{# if(d.search==null || d.search=="true"){ }}
             	 		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              			<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
              		{{# } }}
				</div>
			</div>
		</div>
	</div>
	<div class="layui-fluid-table">
		<div class="layui-row layui-form">
			<div class="layui-btn-container">
				{{# if(d.add==null || d.add=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="add" data-type="auto" type="button"><i class="layui-icon  layui-icon-add-circle"></i>新增</button>
				{{# } }}
				{{# if(d.edit==null || d.edit=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="edit" type="button"><i class="layui-icon layui-icon-edit"></i>修改</button>
				{{# } }}
				{{# if(d.del==null || d.del=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="del" type="button"><i class="layui-icon layui-icon-delete"></i>删除</button>
				{{# } }}
				{{# if(d.import==null || d.import=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="import" id="import" type="button"><i class="layui-icon layui-icon-import"></i>导入</button>
				{{# } }}
			</div>
		</div>
		<table id="workAreaTab" lay-filter="workAreaTabF"></table>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script type="text/javascript">
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
	var oldData;//编辑时使用的
	var contextPath = config.basicInfoConfig.contextPath;
	var active = {
		add:function(othis){
			var checkStatus = table.checkStatus('workAreaTabId');
			oldData = checkStatus.data;
			var type = othis.data('type');
			layer.open({
				type: 2
				,title:'新增作业区域信息'
				,maxmin:false
				,area: ['450px', '350px']
				,offset: type
				,id: 'workAreaAdd'+type //防止重复弹出
				,content: '/iles/pages/basicInfo/workArea/add.html'
				,shade: [0.8, '#393D49']
			});
		},edit:function(othis){
			var checkStatus = table.checkStatus('workAreaTabId');
			oldData = checkStatus.data;
			if(oldData.length<=0){
				layer.alert('请选择要编辑的行！',{icon: 2});
				return ;
			}else if(oldData.length >1){
				layer.alert('编辑不能超过多行！',{icon: 2});
				return ;
			}
			var type = othis.data('type');
			layer.open({
				type: 2
				,title:'编辑作业区域信息'
				,maxmin:false
				,area: ['450px', '350px']
				,offset: type
				,id: 'areaEdit'+type //防止重复弹出
				,content: '/iles/pages/basicInfo/workArea/edit.html'
				,shade: [0.8, '#393D49']
				,yes: function(){
					layer.closeAll();
				}
			});
		},del:function(othis){
			var checkStatus = table.checkStatus('workAreaTabId');
			oldData = checkStatus.data;
			if(oldData.length<=0){
				layer.alert('请选择要删除的行！',{icon: 2});
				return ;
			}
			var idarrys = new Array();
			for(var i=0;i<oldData.length;i++){
				idarrys.push(oldData[i].id);
			}
			layer.confirm('确定删除该条作业区域信息?', {icon: 3, title:'提示'}, function(index){
				//do something
				var option ={
					url:contextPath +'workArea/deleteWorkArea',
					type:'POST',
					contentType: "application/json",
					dataType:'json',
					data:JSON.stringify(idarrys),
					success:function(data){
						if(data.code==0){
							table.reload('workAreaTabId');//刷新列表
						}
					},error:function(data){
						layer.alert(data.msg);
					}
				}
				$.ajax(option);
				layer.close(index);
			});
		},search:function(othis){
			var warehouseCode = layui.formSelects.value('warehouseCodeSelect', 'valueStr');//仓库编号
			var workAreaCode = $('#workAreaCode').val();
			var workAreaName = $('#workAreaName').val();
			//执行重载
			table.reload('workAreaTabId', {
				where:{
					workAreaCode: workAreaCode,
					workAreaName: workAreaName,
					warehouseCode: warehouseCode
				}
			});
		},reset:function(othis){
			$('#workAreaCode').val("");
			$('#workAreaName').val("");
			layui.formSelects.value('warehouseCodeSelect', []);
			form.render("select");
		},import:function(othis){
			layer.open({
				type: 2
				,title:'导入作业区域信息'
				,maxmin:false
				,area: ['800px', '350px']
				,id: 'importAreaE' //防止重复弹出
				,content: '/iles/pages/basicInfo/workArea/importWorkArea.html'
				,shade: 0 //不显示遮罩
				,yes: function(){
					layer.closeAll();
				}
			});
		}
	};
	function loadding(){
		table.render({
			elem:'#workAreaTab',
			id:'workAreaTabId',
			url: contextPath +'workArea/listWorkArea',
			cols:[[
			{type:'checkbox'}
			,{type:'numbers',title:'序号',width: 80}
			,{field:'warehouseCode',title:'仓库编码',}
			,{field:'warehouseName',title:'所属仓库'}
			,{field:'workAreaCode',title:'作业区域编码'}
			,{field:'workAreaName',title:'作业区域名称'}
			,{field:'createrName',title:'创建人'}
			,{field:'createTime',title:'创建时间'}
			]],
			 height: 'full-80'
			,even:true
			,page: {theme: '#008155'}
			,done:function(res,page,count){//列表数据回调函数

			}
		});
		 $('.layui-btn-container button').on('click', function(){
			var othis = $(this), method = othis.data('method');
			active[method] ? active[method].call(this, othis) : '';
		});
		initWarehouseMultiSelect("warehouseCode","warehouseCodeSelect","0",'');
		form.render();
	}
</script>
</body>
</html>
