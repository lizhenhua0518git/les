<#assign  title="呆滞低效预警配置" />
<#include '/header.html' />
<meta charset="UTF-8">
<#if athemTag.loginFlag=="true" && athemTag.menuFlag=="true">
	<div class="layui-fluid">
		<div class="layui-row layui-form">


			<div class="layui-col-md3">
			 	<label class="layui-form-label">预警类型:</label>
			 	 <div class="layui-input-block">
			       <select name="waringType" id="waringType" class="layui-select">
						<option value="">请选择</option>
						<option value="1">呆滞库存预警</option>
						<option value="2">低效库存预警</option>

					</select>
			    </div>
			</div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">
					<#include '/bottonContainer.html' />
				</div>
			</div>
		</div>
	</div>
	<table class="layui-hide" id="inertLowDeployInfoTab" lay-filter="inertLowDeployInfoTabF"></table>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script type="text/html" id="xh">
    {{d.LAY_TABLE_INDEX+1}}
</script>
    <script type="text/javascript">
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var oldData;

    table.render({
        elem:'#inertLowDeployInfoTab',
        id:'inertLowDeployInfoTabId',
        url:'${ctx}/inertLowDeploy/query',
        cols:[[
         {field:'序号', width:'10%', title: '序号',fixed: 'left',templet:'#xh'},
         {field:'waringType',width:'20%',title:'预警类型'},
        {field:'waringRule',width:'20%',title:'预警规则'},
        {field:'userName', width:'20%', title: '修改人'},
        {field:'updateDate', width:'20%', title: '修改时间'},
        {fixed:'right',align:'center',title:'操作', toolbar:'#toolBar'}


        ]],
        page: {theme: '#008155'},
        height: 'full-95',
        even:true,
        done:function(res,page,count){//列表数据回调函数

        	initTableDate(res.data)
        }
    });


    var active = {
            add:function(othis){
            	var type = othis.data('type');
                layer.open({
                 type: 2
                ,title:'新增呆滞低效预警配置信息'
                ,maxmin:true
                ,area: ['600px', '400px']
                ,offset: type
                ,id: 'add'+type //防止重复弹出
                ,content: '${ctx}/pages/basicInfo/inertLowDeploy/add.html'
                ,shade: 0 //不显示遮罩
                ,yes: function(){
                  layer.closeAll();
                }
              });
            },
            search:function(othis){
                var waringType=$('#waringType').val();


                var params={};
                params.waringType=waringType;


                  //执行重载
                  table.reload('inertLowDeployInfoTabId', {
                    where:params

                  });
            },reset:function(othis){
                $('#waringType').val("");
                form.render("select");
            }

    };

    table.on('tool(inertLowDeployInfoTabF)', function(obj){
        var eventName = obj.event;          //事件名称
            //当前对象tr
        var clickObj = $(obj.tr[0]);
        oldData =obj.data;
        if(eventName=="edit"){    //编辑

        	 $("#id").val(obj.data.id);
        	  layer.open({
                  type: 2
                 ,title:'呆滞低效预警配置编辑'
                 ,maxmin:true
                 ,area: ['800px', '500px']
                 ,offset: 33
                 ,id: 'detailList' //防止重复弹出
                 ,content: '${ctx}/pages/basicInfo/inertLowDeploy/edit.html'
                 ,shade: 0 //不显示遮罩
                 ,yes: function(){
                   layer.closeAll();
                 }
               });
        }
	  });
    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });
    table.on('sort(inertLowDeployInfoTabF)', function (obj) {
        var sortColums;
        if(obj.field=="waringType"){
            sortColums = "waring_type "+obj.type;
        }
        var waringType=$('#waringType').val();

          //执行重载
          table.reload('inertLowDeployInfoTabId', {
            where:{
            	waringType:waringType,
                sortColums:sortColums

            }
          });
    });


    //表格数据初始化
    function initTableDate(data){

        $("[data-field='waringType']").children().each(function(){
            if($(this).text()=='1'){
                $(this).text('呆滞库存预警');
            }else if($(this).text()=='2'){
                $(this).text('低效库存预警');
            }
        });
    }

</script>
<script type="text/html" id="toolBar">
<button type="button" class="layui-btn layui-btn-normal" id="edit" lay-event="edit">编辑</button>

 </script>
<#else>
    <#include '/noAuthority.html' />
</#if>
<#include '/footer.html' />
