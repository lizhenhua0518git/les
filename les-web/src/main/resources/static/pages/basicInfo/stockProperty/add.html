<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>新增盘点配置</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
</head>
<body>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
<div class="layui-container" style="padding-top: 20px;">
		<form class="layui-form" action="">
			 
			<div class="layui-form-item">
                 
                <div class="layui-inline">
                   	<label class="layui-form-label" >仓库:</label>
                    <div class="layui-input-block">
                     <select name="warehouseCode" id="warehouseCode" lay-verify=warehouseCode class="layui-select">
						<option value="">请选择</option>
					 
					</select>
                    </div>
                </div>
                
                 <div class="layui-inline">
                   	<label class="layui-form-label" >产品线:</label>
                    <div class="layui-input-block" style="padding-left:30px;">
                     <select name="productLine" id="productLine" lay-verify=productLine class="layui-select">
						<option value="">请选择</option>
					 
					</select>
                    </div>
                </div>
            </div>
			<div class="layui-form-item">
                 
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">班组长：</label>
                    <div class="layui-input-block" style="padding-left:40px;">
                      <input type="text" name="teamLeader" id="teamLeader" lay-verify="teamLeader" onclick="chooseUser('1')" autocomplete="off"   class="layui-input" readonly="readonly">
                    </div>
                </div>
                
                  <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">业务组：</label>
                    <div class="layui-input-block" style="padding-left:40px;">
                      <input type="text" name="businessLeader" id="businessLeader" lay-verify="businessLeader" onclick="chooseUser('2')" readonly="readonly" autocomplete="off" placeholder="" class="layui-input" >
                    </div>
                </div>
            </div>
            
            <div class="layui-form-item">
                 
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">业务经理：</label>
                    <div class="layui-input-block" style="padding-left:40px;">
                      <input type="text" name="businessManager" id="businessManager" lay-verify="businessManager" onclick="chooseUser('5')" autocomplete="off"   class="layui-input" readonly="readonly">
                    </div>
                </div>
                
                  <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">物控组：</label>
                    <div class="layui-input-block" style="padding-left:40px;">
                      <input type="text" name="materialControl" id="materialControl" lay-verify="materialControl" onclick="chooseUser('6')" readonly="readonly" autocomplete="off" placeholder="" class="layui-input" >
                    </div>
                </div>
            </div>
			
			
			<div class="layui-form-item">
                 
                <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">sap管理工：</label>
                    <div class="layui-input-block" style="padding-left:40px;">
                      <input type="text" name="sapManager" id="sapManager" lay-verify="sapManager" onclick="chooseUser('3')" readonly="readonly" autocomplete="off" placeholder="" class="layui-input" >
                    </div>
                </div>
                
                  <div class="layui-inline">
                    <label class="layui-form-label" style="width: 120px">分管副部长：</label>
                    <div class="layui-input-block" style="padding-left:40px;">
                      <input type="text" name="minister" id="minister" lay-verify="minister" onclick="chooseUser('4')" readonly="readonly" autocomplete="off" placeholder="" class="layui-input" >
                    </div>
                </div>
            </div>
			 <div class="layui-form-item">
			    <div class="layui-input-block">
			      <button class="layui-btn" lay-submit="" lay-filter="stockPropertySubit">立即提交</button>
			      <button type="reset" class="layui-btn layui-btn-primary">重置</button>
			        <input type="text"  id="businessLeaderId" name="businessLeaderId" hidden="true" />
				    <input type="text"  id="teamLeaderId" name="teamLeaderId"  hidden="true"/>
				    <input type="text"  id="sapManagerId" name="sapManagerId" hidden="true"/>
				    <input type="text"  id="ministerId" name="ministerId" hidden="true"/>
				    <input type="text"  id="orgId" name="orgId" hidden="true"/>
				    <input type="text"  id="businessManagerId" name="businessManagerId" hidden="true"/>
				      <input type="text"  id="materialControlId" name="materialControlId" hidden="true"/>
			      
			    </div>
			  </div>
			
		</form>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script type="text/javascript">
		var contextPath = config.basicInfoConfig.contextPath;
		var element = layui.element;
		var layer = layui.layer;
		var table = layui.table;
		var form = layui.form
		var dictItems = null;//数据字典
		function loadding(){
			getWarehouseList();
			getProductLine();
		}
		layui.use(['form', 'layedit'], function(){
			form.verify({
				 
				warehouseCode:function(value){
					 if(value.length < 1){
					        return '请选择仓库';
					 }
					 
				},
				productLine:function(value){
					 if(value.length < 1){
					        return '请选择产品线';
					 }
					 
				},
				teamLeader:function(value){
					 if(value.length < 1){
					        return '请填写班组长';
					 }
					 
				},
				businessManager:function(value){
					 if(value.length < 1){
					        return '请填写业务经理';
					 }
					 
				},
				materialControl:function(value){
					 if(value.length < 1){
					        return '请填写物控组';
					 }
					 
				},
				businessLeader:function(value){
					 if(value.length < 1){
					        return '请填写运营组';
					 }
					 
				},
				sapManager:function(value){
					 if(value.length < 1){
					        return '请填写sap管理工';
					 }
					 
				},
				minister:function(value){
					 if(value.length < 1){
					        return '请填分管副部长';
					 }
					 
				}
	  
		 
				
			  });
			  //监听提交
			  form.on('submit(stockPropertySubit)', function(data){
				saveDict(data);
				return false;
			 });
		});
		
		function isNumber(value) {         //验证是否为数字
			    var patrn = /^(-)?\d+(\.\d+)?$/;
			      if (patrn.exec(value) == null || value == "") {
			          return false
			      } else {
			         return true
			     }
			  }
		function saveDict(data){
			data.field.businessLeaderId=$("#businessLeaderId").val();
			data.field.teamLeaderId=$("#teamLeaderId").val();
			data.field.sapManagerId=$("#sapManagerId").val();
			data.field.ministerId=$("#ministerId").val();
			data.field.businessManagerId=$("#businessManagerId").val();
			data.field.materialControlId=$("#materialControlId").val();
			data.field.warehouseName= $("#warehouseCode option:selected").text();
			data.field.warehouseCode = $("#warehouseCode option:selected").val();
			data.field.storageLocation = $("#warehouseCode option:selected").attr("storageLocation");
			data.field.productLineName=$("#productLine option:selected").text();
			data.field.mainMinister = "曹部长"
			data.field.mainMinisterId = "1103"
			var option = {
		    	url:contextPath+'stockProperty/add',
		    	data:JSON.stringify(data.field),
		    	type:'POST',
		    	contentType:'application/json',
		    	success:function(data){
		    		if(data.code==0){
		    			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
		    			parent.layer.close(index);  // 关闭layer
		    			parent.table.reload('stockPropertyTabId');
		    		}else{
		    			layer.alert(data.data);
		    		}
		    	},error:function(data){
		    		layer.alert(data.msg)
		    	}
		    }
		    $.ajax(option); 
		}
	
		 function getProductLine(){
		    	
	    	 var option ={
	    	           url:contextPath+'produceLine/queryProduceLinelist',
	    	           type:'POST',
	    	           dataType:'json',
	    	           async:false,
	    	           success:function(data){
	    	               if(data.code==0){
	    	               	var list =data.data;
	    	               	var html = '<option value="">请选择</option>';
	    	               	
	    	               for(var i =0;i<list.length;i++){
	    	            	   html=html+ '<option value="'+list[i].produceLineCode+'">'+list[i].produceLineName+'</option>';
	    	               }
	    	              $("#productLine").html(html)
	    	              form.render("select");	
	    	             }
	    	              
	    	           },error:function(data){
	    	               layer.alert(data.msg);
	    	           }
	    	       }
	    	       $.ajax(option);
	    }
		 
		 function  getWarehouseList(){
			 var option ={
		  		type: 'GET',
		  		async: false,
	  		  	//url: config.basicInfoConfig.contextPath+"orgnization/queryOrgnizaByType?orgType=4",
	  		  	url : config.basicInfoConfig.contextPath+"orgnization/listWarehouse",
	  		  	dataType: "json",
	  		  	contentType : 'application/json',
	  		  	success: function(data){
	  		  	 if(data.code==0){
	  		  	    var list =data.data.wareHoseList;
                  	var html = '<option value="">请选择</option>';
               	
	               for(var i =0;i<list.length;i++){
	            	   if(list[i].orgCode.indexOf("006") < 0 ) {
	            		   html=html+ '<option value="'+list[i].orgCode+'" orgName="'+list[i].orgName+'" storageLocation="'+list[i].storageLocation+'">'+list[i].orgName+'</option>';
	            		   } 
	            	   
	            	  
	               }
	              $("#warehouseCode").html(html)
	              form.render("select");	
	             }
	              
	           },error:function(data){
	               layer.alert(data.msg);
	           }
		    } 
			 $.ajax(option);
		}
		 
		 function chooseUser(userType){
			 
			 layer.open({
			        type: 2
			        ,title:'用户设置'
			        ,maxmin:true
			        ,area: ['80%', '80%']
			        ,id: 'userRoleS' //防止重复弹出
			        ,content: 'chooseUser.html?userType='+userType
			        ,shade: 0 //不显示遮罩
			        ,yes: function(){
			          layer.closeAll();
			        }
	  			});
		 }
	     
	</script>
</body>
</html>