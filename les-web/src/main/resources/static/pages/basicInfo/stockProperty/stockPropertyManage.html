<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>盘点配置</title>
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
	<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
</head>
<body>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
<div class="layui-fluid">
	<div class="layui-container" style="padding-top: 20px;">
	 <input type="text"  id="transferBinId" hidden="true" />

		<div class="layui-row layui-form">

            <div class="layui-col-md2">
			 	<label class="layui-form-label">仓库:</label>
			 	 <div class="layui-input-block">
			       <select name="warehouseCode" id="warehouseCode" class="layui-select">
						<option value="">请选择</option>

					</select>
			    </div>
			</div>
             <div class="layui-col-md2">
                <label class="layui-form-label"> 班组长:</label>
                <div class="layui-input-block">
                    <input type="text" name="teamLeader" id="teamLeader" class="layui-input" placeholder="">
                </div>
            </div>

             <div class="layui-col-md2">
                <label class="layui-form-label"> sap管理工:</label>
                <div class="layui-input-block">
                    <input type="text" name="sapManager" id="sapManager" class="layui-input" placeholder="">
                </div>
            </div>

             <!--<div class="layui-col-md2">-->
				<div class="layui-btn-container nav-" style="text-align: right;">
					{{# if(d.search==null || d.search=="true"){ }}
             	 		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              			<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon  layui-icon-reset"></i>重置</button>
              		{{# } }}
				</div>
			<!--</div>-->
		 	</div>
		</div>
		<!-- 按钮区域 -->
		<div class="layui-row layui-form" style="margin-bottom: 0">
				<div class="layui-btn-container">
					{{# if(d.add==null || d.add=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="add" data-type="auto" type="button"><i class="layui-icon  layui-icon-add-circle"></i>增加</button>
					{{# } }}
					{{# if(d.edit==null || d.edit=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="edit" type="button"><i class="layui-icon layui-icon-edit"></i>编辑</button>
					{{# } }}
					{{# if(d.del==null || d.del=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="del" type="button"><i class="layui-icon layui-icon-delete"></i>删除</button>
					{{# } }}

				</div>
	</div>
	<table id="stockProperty" lay-filter="stockPropertyTabF"></table>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script type="text/html" id="indexTpl">
     {{d.LAY_TABLE_INDEX+1}}
   </script>
<script type="text/javascript">
		var contextPath = config.basicInfoConfig.contextPath;
		var element = layui.element;
		var layer = layui.layer;
		var table = layui.table;
		var form = layui.form;
		var laydate = layui.laydate;
		var oldData;




		var active = {
				search:function(othis){
					var params={};
					var teamLeader =$("#teamLeader").val();
					var sapManager =$("#sapManager").val();
					var warehouseCode =$("#warehouseCode").val();
	                params.teamLeader=teamLeader;
	                params.sapManager=sapManager;
	                params.warehouseCode=warehouseCode;
					//执行重载
				table.reload('stockPropertyTabId', {
					 where:params,
	                    page:{"curr":1}
				});
			},
			reset:function(othis){
				 $('#warehouseCode').val('');
                 $('#sapManager').val('');
                 $('#teamLeader').val('');

				form.render("select");
			},
			 add:function(othis){
                 var type = othis.data('type');
                 layer.open({
                     type: 2
                     ,title:'新增盘点配置'
                     ,offset:'auto'
                     ,maxmin:true
                     ,area: ['100%', '100%']
                     ,id: 'addStockProperty'+type //防止重复弹出
                     ,content: 'add.html'
                     ,shade: 0 //不显示遮罩
                     ,yes: function(){
                           layer.closeAll();
                     }
                 });
             },
			edit:function(othis){
                var checkStatus = table.checkStatus('stockPropertyTabId');
                oldData = checkStatus.data;
                if(oldData.length<=0){
                    layer.alert('请选择要编辑的行！',{icon: 2});
                    return ;
                }
                if(oldData.length >1){
                    layer.alert('不能选择多行编辑！',{icon: 2});
                    return ;
                }

                	  var stockTakeReportId =oldData[0].id;
                      $("#stockTakeReportId").val(stockTakeReportId);   //方便子页面取点收记录的Id
                      layer.open({
                          type: 2,
                          title:'编辑',
                          offset:'auto',
                          maxmin:true,
                          area: ['100%', '100%'],
                          id: 'edit', //防止重复弹出
                          content: 'edit.html',
                          shade: 0, //不显示遮罩
                          yes: function(){
                            layer.closeAll();
                          }
                      });

            },
            del:function(othis){
                var checkStatus = table.checkStatus('stockPropertyTabId');
                oldData = checkStatus.data;
                if(oldData.length<=0){
                    layer.alert('请选择要删除的行！',{icon: 2});
                    return ;
                }
                var idarrys = new Array();
                for(var i=0;i<oldData.length;i++){
                    idarrys.push(oldData[i].id);
                }
                layer.confirm('确定删除盘点配置信息？', {icon: 3, title:'提示'}, function(index){
                    var option ={
                        url:contextPath+'stockProperty/del',
                        type:'POST',
                        contentType: "application/json",
                        dataType:'json',
                        data:JSON.stringify(idarrys),
                        success:function(data){
                            if(data.code==0){
                                layer.msg("删除成功");
                                table.reload('stockPropertyTabId');//刷新列表
                            }
                        },error:function(data){
                            layer.alert(data.msg);
                        }
                    }
                    $.ajax(option);
                    layer.close(index);
                });
            }

		};

		function loadding(){
			//获取仓库列表
			getWarehouseList();
			table.render({
				elem:'#stockProperty',
				id:'stockPropertyTabId',
		    	url:contextPath+'stockProperty/query',
		    	where:{status:-1},
			    cols: [[
					{type:'checkbox'},
					{title: '序号',templet: '#indexTpl',width: '5%'},
				    {field:'warehouseName',title: '仓库名称', width: '10%'},
				    {field:'productLineName',title: '产品线',width: '10%',  },
				    {field:'teamLeader', title: '班组长', width: '10%'},
				    {field:'sapManager',title: 'sap管理工', width: '12%' },
				    {field:'businessLeader',title: '业务组', width: '12%' },
				    {field:'businessManager', title: '业务经理', width: '10%'},
				    {field:'materialControl', title: '物控组', width: '10%'},
				    {field:'minister', title: '分管副部长', width: '10%'},
				    {field:'mainMinister', title: '部长', width: '8%'}




			    	]],
				page: {theme: '#008155'},
				height: 'full-95',
	    		even:true,
	    		done:function(res,page,count){//列表数据回调函数
	    			initTableDate(res.data) ;
	    		}
			});
			$('.layui-btn-container button').on('click', function(){
			    var othis = $(this), method = othis.data('method');
			    active[method] ? active[method].call(this, othis) : '';
		  	});
		}


		//表格数据初始化
	    function initTableDate(data){
	    	var reg = new RegExp(";","g");//g,表示全部替换。

	        $("[data-field='sapManager']").children().each(function(){
	            var text = $(this).text().replace(reg,"/");;
	                $(this).text(text);

	        });

	        $("[data-field='businessLeader']").children().each(function(){
	            var text = $(this).text().replace(reg,"/");;
	                $(this).text(text);

	        });

	        $("[data-field='materialControl']").children().each(function(){
	            var text = $(this).text().replace(reg,"/");;
	                $(this).text(text);

	        });



	    }

		function  getWarehouseList(){
			 var option ={
		  		type: 'POST',
		  		async: false,
	  		  	url: config.basicInfoConfig.contextPath+"orgnization/listOrgnizaByType?orgType=4",
	  		  	dataType: "json",
	  		  	contentType : 'application/json',
	  		  	success: function(data){
	  		  	 if(data.code==0){
	  		  	    var list =data.data;
                  	var html = '<option value="">请选择</option>';

	               for(var i =0;i<list.length;i++){
	            	   if(list[i].orgCode.indexOf("006") < 0 ) {
	            		   html=html+ '<option value="'+list[i].orgCode+'">'+list[i].orgName+'</option>';
	            		   }
	               }
	              $("#warehouseCode").html(html)
	              form.render("select");
	             }

	           },error:function(data){
	               layer.alert(data.msg);
	           }
		    }
			 $.ajax(option);
		}

	</script>
</body>
</html>
