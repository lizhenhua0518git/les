<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<link rel="stylesheet" href="/iles/pages/css/style.min.css">
<title>编辑期量规则</title>
</head>
<body>
<div class="layui-container" style="padding-top: 20px;">
<form class="layui-form" action="" lay-filter="ruleForm">
		<div class="layui-form-item">
		<input type="hidden" id="id" name="id"/>
			<div class="layui-inline">
			    <label class="layui-form-label">分类级别</label>
			    <div class="layui-input-block">
<!-- 			      <select  id="typeLevel" name="typeLevel" lay-filter="typeLevel" lay-verify="required" lay-search required> -->
<!-- 			        <option value="">请选择</option> -->
<!-- 			        <option value="quantity_type_grade_a">一级分类</option> -->
<!-- 			        <option value="quantity_type_grade_b">二级分类</option> -->
<!-- 			        <option value="quantity_type_grade_c">三级分类</option> -->
<!-- 			      </select> -->
					<input type="text" id="typeLevel" name="typeLevel" class="layui-input" style="border:none;" disabled="disabled"/>
			    </div>
		 	</div>
		 </div>
		 <div class="layui-form-item">
		 	<div class="layui-inline">
			    <label class="layui-form-label">物料分类</label>
			    <div class="layui-input-block">
<!-- 			      <select  id="materialType" name="materialType" lay-verify="required" lay-search required  style="border:none;"> -->
<!-- 			      </select> -->
			      
			      <input type="text" id="materialType" name="materialType" class="layui-input" style="border:none;" disabled="disabled"/>
			    </div>
			 </div>
		 </div>
		 <div class="layui-form-item">
		 	
			 <div class="layui-inline">
			    <label class="layui-form-label">期量规则</label>
			    <div class="layui-input-block">
			      <input type="radio" id="quanitityRule" name="quanitityRule"  checked value="生产计划" title="生产计划">
			    </div>
			 </div>
		</div>
		 <div class="layui-form-item">  
			  <div class="layui-inline">
			    <label class="layui-form-label">需求天数</label>
			    <div class="layui-input-inline" style="width: 60px;">
		      		 <input type="text" id="quanitityDate" name="quanitityDate"  class="layui-input"   lay-verify="quanitityDate">
		         </div>
		         <div class="layui-form-mid layui-word-aux">天 </div>
			 </div>
		 </div>
		 
		  <div class="layui-form-item">
			  <div class="layui-inline">
			    <label class="layui-form-label">低库存规则</label>
			    <div class="layui-form-mid">期量的</div>
			    <div class="layui-input-inline" style="width: 60px;">
			      	<input type="text" id="lowerQuanitityRule" name="lowerQuanitityRule" class="layui-input"      lay-verify="lowerQuanitityRule">
			    </div>
			    <div class="layui-form-mid">%</div>
			 </div>
		 </div>
		 <div class="layui-form-item">
		    <div class="layui-input-block">
		      <button class="layui-btn" lay-submit="" lay-filter="ruleSubit">提交</button>
		      <button type="reset" class="layui-btn layui-btn-primary">取消</button>
		    </div>
		  </div>
	</form>
	</div>
	<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/jquery-3.3.1.min.js"></script>
	<script src="/iles/pages/js/jstree.min.js"></script>
	<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/loginInspect.js"></script>
	<script type="text/javascript">
	var contextPath = config.basicInfoConfig.contextPath;
	    var form = layui.form;
		var id = parent.$("#id").val();
		
		layui.use(['layer','form'], function(){
	    	 form.verify({
		    	 quanitityDate:[
					/^1[0-9]|[2-2]\d|30$/
	    	        ,'请输入10~30的整数'
	    	     ]
		     	,lowerQuanitityRule:[
	    	        /^([1-9]\d?|100)$/
	    	        ,'百分比值，请输入1~100的整数'
	    	   	]
		 
	    	  });
		});
		
		//编辑赋初始值
		if(id && id.length>0){
			 var option = {
				 url:contextPath+'quanityRule/queryRuleById?id='+id,
				 type:'GET',
				 success:function(res){
					 if(res.code==0 && res.data!=null){
						$("#id").val(res.data.id); 
						$("#typeLevel").val(res.data.dictName);
						$("#materialType").val(res.data.itemName);
						var dictType = new Array();
						dictType.push(res.data.typeLevel);
						initLevleTwo(dictType,res.data.materialType);
						
						$("#quanitityDate").val(res.data.quanitityDate);
						$("#lowerQuanitityRule").val(res.data.lowerQuanitityRule); 
						form.render('select');
					 }
				 }
			 };
			 $.ajax(option);
		}	 
		 
		
	  //监听提交
	  form.on('submit(ruleSubit)', function(data){
		  var option = {
	    	url:contextPath+'quanityRule/updateQuanityRule',
	    	data:JSON.stringify(data.field),
	    	type:'POST',
	    	contentType:'application/json',
	    	success:function(data){
	    		if(data.code==0){
	    			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
	    			parent.layer.close(index);  // 关闭layer
	    			parent.$(".layui-laypage-btn")[0].click();
	    		}
	    	},error:function(data){
	    		layer.alert(data.msg);
	    	}
	    }
	    $.ajax(option);  
		return false;
	  });
	
	  
	  layui.use('form', function(){
	        var form = layui.form;
	        form.on('select(typeLevel)', function(data){
	            var gradeId=data.elem.value;
	            var dictType = new Array();
				dictType.push(gradeId);
				initLevleTwo(dictType,null);
	        });
	    });
	    function initLevleTwo(dictType,defualtVaule){
	    	 $.ajax({
	            	url:contextPath+'dictItems/queryDictItemByTypes',
					type:'POST',
					dataType:'json',
					contentType: "application/json",
					data:JSON.stringify(dictType),
					success:function(res){
					 $("#materialType").empty();
					 form.render('select');
					 for(var i=0;i<res.data.length;i++){
						  if(defualtVaule==res.data[i].itemValue){
							  $("#materialType").append("<option selected value="+res.data[i].itemValue+">"+res.data[i].itemName+"</option>");
						  }else{
							  $("#materialType").append("<option value="+res.data[i].itemValue+">"+res.data[i].itemName+"</option>");
						  }
					  }
					  form.render('select');
	                }
	            });
	    }
	</script>
</body>
</html>