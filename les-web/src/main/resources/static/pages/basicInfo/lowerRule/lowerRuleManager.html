<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta http-equiv="Access-Control-Allow-Origin" content="*" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<link rel="stylesheet" href="/iles/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<link rel="stylesheet" href="/iles/pages/layui/css/tableFilter.css"  type="text/css" />
<title>下架规则</title>
</head>
<body>
<div id="bodyDiv">

</div>

<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/layui/lay/modules/tableFilter.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		 <div class="layui-row layui-form">
			<div class="layui-col-md3">
                <label class="layui-form-label">仓库:</label>
                 <div class="layui-input-block">
					<select id="warehouseCode" xm-select="select1" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
                </div>
     		</div>
     		 <div class="layui-col-md2">&nbsp;</div>
			<!--<div class="layui-col-md2">-->
				<div class="layui-btn-container nav-" style="text-align: right;">
					{{# if(d.search==null || d.search=="true"){ }}
             	 		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              			<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
              		{{# } }}
				</div>
        </div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-btn-container">
					<!--{{# if(d.search==null || d.search=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
					{{# } }}	-->
					{{# if(d.add==null || d.add=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="add" data-type="auto" type="button"><i class="layui-icon  layui-icon-add-circle"></i>增加</button>
					{{# } }}
					{{# if(d.edit==null || d.edit=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="edit" type="button"><i class="layui-icon layui-icon-edit"></i>编辑</button>
					{{# } }}
					{{# if(d.del==null || d.del=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="del" type="button"><i class="layui-icon layui-icon-delete"></i>删除</button>
					{{# } }}
			</div>
		</div>
	</div>  
<table   id="lowerRuleTab" lay-filter="lowerRuleTabF"></table>
</script>
<script type="text/javascript">
	var layer = layui.layer;
	var table = layui.table;
	var contextPath = config.basicInfoConfig.contextPath;
	var form = layui.form;
	var oldData;
	var active = {
			 search:function(othis){
				 var warehouseCodes = layui.formSelects.value('select1', 'value');
				 var warehouseCode =  "";
				 if(warehouseCodes && warehouseCodes.length>0){
					 for(var i=0;i<warehouseCodes.length;i++){
						 warehouseCode = warehouseCode+warehouseCodes[i]+";";
					 }
				 }
				 table.reload('lowerRuleTabId', {
	                    where:{warehouseCode:warehouseCode},
	                    page:{"curr":1}
	                  });
			 },reset:function(othis){
				 layui.formSelects.value('select1', []); 
				 form.render("select");
			 },add:function(othis){
				 var type = othis.data('type');
                 layer.open({
	                   type: 2
	                  ,title:'新增下架规则'
	                  ,maxmin:false
	                  ,area: ['500px', '500px']
	                  ,offset: type 
	                  ,id: 'add'+type //防止重复弹出
	                  ,content: '/iles/pages/basicInfo/lowerRule/addLowerRule.html'
	                  ,yes: function(){
	                    layer.closeAll();
	                  }
	                });
			 },edit:function(othis){
				 var checkStatus = table.checkStatus('lowerRuleTabId');
                 oldData = checkStatus.data;
	             if(oldData.length<=0){
	                 layer.alert('请选择要编辑的行！',{icon: 2});
	                     return ;
	             }else if(oldData.length >1){
	                     layer.alert('编辑不能超过多行！',{icon: 2});
	                     return ;
	                 }
	             var type = othis.data('type');
	             layer.open({
	                 type: 2
	                 ,title:'编辑物料分类'
	                 ,maxmin:false
	                 ,area: ['600px', '500px']
	                 ,offset: type 
	                 ,id: 'edit'+type //防止重复弹出
	                 ,content: '/iles/pages/basicInfo/lowerRule/editLowerRule.html'
	                 ,shade: [0.8, '#393D49']
	                 ,yes: function(){
	                   layer.closeAll();
	                 }
	              });
			 },del:function(othis){
				 var checkStatus = table.checkStatus('lowerRuleTabId');
                 oldData = checkStatus.data;
                 if(oldData.length<=0){
                     layer.alert('请选择要删除的行！',{icon: 2});
                     return ;
                 }
                 var idarrys = new Array();
                 for(var i=0;i<oldData.length;i++){
                     idarrys.push(oldData[i].id);
                 }
                 layer.confirm('确定删除选中的信息吗?', {icon: 3, title:'提示'}, function(index){
                       //do something
                       var option ={
                             url:contextPath+'lowerRule/removeLowerRule',
                             type:'POST',
                             contentType: "application/json",
                             dataType:'json',
                             data:JSON.stringify(idarrys),
                             success:function(data){
                                 if(data.code==0){
                                 	table.reload('lowerRuleTabId');//刷新列表
                                 }
                             },error:function(data){
                                 layer.alert(data.msg);
                             }
                         }
                         $.ajax(option);
                       layer.close(index);
                     });
			 }
	};
	function loadding(){
	  table.render({
			 elem:'#lowerRuleTab',
	         id:'lowerRuleTabId',
	         url:contextPath+'lowerRule/listLowerRule',
	         cols:[[
	                {type:'checkbox'},
	                {type:'numbers',title:'序号'},
	                {field:'warehouseCode', title: '仓库编码'},
	                {field:'warehouseName', title: '仓库名称'},
	                {field:'lowerRule', title: '下架规则'},
	                {field:'status', title: '状态'}
		 		]],
		   	done:function(res,page,count){//列表数据回调函数
		   		$("[data-field='lowerRule']").children().each(function(){
						if("0"==$(this).text().trim()){
							$(this).text("任务数优先");
						}else if("1"==$(this).text().trim()){
							$(this).text("仓位库存优先");
						}
				});
		   		$("[data-field='status']").children().each(function(){
		   			if("0"==$(this).text().trim()){
						$(this).text("禁用");
					}else if("1"==$(this).text().trim()){
						$(this).text("启用");
					}
				});
		   	}
	         
		 });
		 
	  initWarehouseMultiSelect("warehouseCode","select1","0",null);
	  $('.layui-btn-container button').on('click', function(){
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });
	}
</script>
</body>
</html>