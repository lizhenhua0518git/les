<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>Insert title here</title>
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
</head>

<body id="bodyDiv">




<script type="text/html" id="bodyTpl">
<div class="layui-fluid">
	<div class="layui-row layui-form">
		<div class="layui-col-md2">
			 	<label class="layui-form-label">请求地址</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="requestUrl_search" class="layui-input">
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">调用时间</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="createTime_search" class="layui-input">
			    </div>
		</div>
		<div class="layui-col-md2">
			 	<label class="layui-form-label">来源系统</label>
			 	 <div class="layui-input-block">
			        <select  id="souceOfSystem_search">
			        	<option value="">请选择</option>
						<option value="sap系统">SAP系统</option>
						<option value="srm系统">SRM系统</option>
						<option value="mes系统">MES系统</option>
						<option value="型材立库系统">型材立库系统</option>
						<option value="板材立库系统">板材立库系统</option>
						<option value="管理视窗系统">管理视窗系统</option>
						<option value="plm系统">PLM系统</option>
			      	</select>
			    </div>
		</div>
		<div class="layui-col-md2">&nbsp;</div>
		<div class="layui-col-md2">&nbsp;</div>
		<div class="layui-col-md2">
			<div class="layui-btn-container" style="text-align: left;">
				{{# if(d.search==null || d.search=="true"){ }}
             	 	<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
              	{{# } }}
			</div>
		</div>
	</div>
</div>
<div class="layui-fluid-table">
<div class="layui-row layui-form" style="margin-bottom: 0">
		<div class="layui-btn-container" style="text-align: left;">
              {{# if(d.export==null || d.export=="true"){ }}
              <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button>
         	  {{# } }}
         </div>
</div>
<table class="layui-hide" id="outsideApiLogTab" lay-filter="outsideApiLogTabF"></table>
</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script type="text/javascript">
var table = layui.table;
var contextPath = config.basicInfoConfig.contextPath;
var form = layui.form;
var storage = window.localStorage;
var token = storage.token;
var laydate = layui.laydate;
var active = {
		search:function(othis){
			var requestUrl = $('#requestUrl_search').val();
			var createTime = $('#createTime_search').val();
			var createTimeStart = null;
			var createTimeEnd = null;
			if(createTime!=null && createTime.length>0){
				createTimeStart = createTime.substring(0,20);
				createTimeEnd = createTime.substring(22);
			}
			var souceOfSystem = $('#souceOfSystem_search').val();
		      //执行重载
		      table.reload('outsideApiLogTabId', {
		        where:{
		        	requestUrl: requestUrl
		           ,createTimeStart:createTimeStart
		           ,createTimeEnd:createTimeEnd
		           ,souceOfSystem:souceOfSystem
		        }
		        ,page:{"curr":1}
		      });
		},reset:function(othis){
			$('#requestUrl_search').val("");
			$('#createTime_search').val("");
			$('#souceOfSystem_search').val("");
			form.render("select");
		},export:function(othis){
			var requestUrl = $('#requestUrl_search').val();
			var createTime = $('#createTime_search').val();
			var createTimeStart = null;
			var createTimeEnd = null;
			if(createTime!=null && createTime.length>0){
				createTimeStart = createTime.substring(0,20);
				createTimeEnd = createTime.substring(22);
			}
			var souceOfSystem = $('#souceOfSystem_search').val();
			var params = "requestUrl="+requestUrl+"&createTimeStart="+createTimeStart
						 +"&createTimeEnd="+createTimeEnd+"&souceOfSystem="+souceOfSystem+"&token="+token;
			window.open(contextPath+"outsideApi/exportOutsideApiLog?"+params);
		}
}
function loadding(){
	//日期范围
   	laydate.render({
   	    elem: '#createTime_search',
   	    range: true,
   	    type:'datetime'
   	});
	table.render({
		elem:'#outsideApiLogTab',
		id:'outsideApiLogTabId',
		url: contextPath +'outsideApi/listOutsideApiLog',
		cols:[[
		{type:'checkbox'},
		{type:'numbers',title:'序号',width: 60},
		{field:'requestUrl',title:'请求路径'},
		{field:'requestParam',title:'请求参数'},
		{field:'takeTime', title: '接口耗时ms'},
		{field:'souceOfSystem', title: '调用系统'},
		{field:'resultInfo', title: '返回信息'},
		{field:'createTime', title: '调用时间'}
		]],
		page: {theme: '#008155'},
   		even:true
	});
	$('.layui-btn-container button').on('click', function(){
	    var othis = $(this), method = othis.data('method');
	    active[method] ? active[method].call(this, othis) : '';
  	});
	form.render("select");
}
</script>
</body>

</html>
