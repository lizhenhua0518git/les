<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
    content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />

<title>客户管理</title>
</head>
<body id="bodyDiv">

    <script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
    <script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
    <script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
    <script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
    <script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
	<div class="layui-row layui-form">
			<div class="layui-col-md2">
                <label class="layui-form-label">客户编码:</label>
                 <div class="layui-input-inline">
                  <input type="text" id="customerCode"    class="layui-input">
                </div>
            </div>
			<div class="layui-col-md2">
			 	<label class="layui-form-label">客户名称:</label>
			 	 <div class="layui-input-inline">
			      <input type="text" id="customerName"    class="layui-input">
			    </div>
			</div>
			<div class="layui-col-md2">
			 	<label class="layui-form-label">是否启用:</label>
			 	 <div class="layui-input-inline">
			       <select name="isDel" id="isDel" lay-verify="required">
						<option value="">请选择</option>

					</select>
			    </div>
			</div>
    <div class="layui-col-md2">&nbsp;</div>
      <div class="layui-col-md2">&nbsp;</div>
		<div class="layui-col-md2">
			<div class="layui-btn-container" style="text-align: right;">
				{{# if(d.search==null || d.search=="true"){ }}
             	 	<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
              	{{# } }}
			</div>
		</div>
	</div>
</div>
		<div class="layui-fluid-table">
		<div class="layui-row layui-form" style="margin-bottom: 0">

			 <div class="layui-btn-container" style="text-align: left;">


                  {{# if(d.syn==null || d.syn=="true"){ }}
                <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="syn" type="button"><i class="layui-icon layui-icon-search"></i>同步</button>
                 {{# } }}

		</div>
	</div>
	<table id="customerInfoTab" lay-filter="customerInfoTabF"></table>
</div>
</script>

    <script type="text/javascript">

    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var contextPath = config.basicInfoConfig.contextPath;
    var oldData;

    function loadding(){
    table.render({
        elem:'#customerInfoTab',
        id:'customerInfoTabId',
        url: contextPath + 'customer/listCustomer',
        cols:[[

        {type:'numbers',title:'序号',width: 80},
        {field:'customerName',title:'客户名称',sort:true},
        {field:'customerCode', title: '客户编码',sort:true},
        {field:'customerAddress', title: '客户联系地址'},
        {field:'contacts', title: '联系人'},
        {field:'phone', title: '联系方式'},

        {field:'province', title: '省份编码'},
        {field:'city', title: '城市名称'},
        {field:'statusName', title: '是否启用',sort:true},
        {field:'createTime', title: '创建时间'}
        ]],
        page: {theme: '#008155'},

        even:true,
        done:function(res,page,count){//列表数据回调函数

        }
    });

    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });

    queryDictItem('enable','isDel','');
	form.render("select");
   }


    var active = {
            syn:function(othis){
            	var option ={
						url:contextPath+'customer/getCustomer',
						type:'POST',
						contentType: "application/json",
						dataType:'json',
						data:{},
						success:function(data){
							if(data.code==0){
								layer.alert("同步成功");
								table.reload('customerInfoTabId');
							}
						},error:function(data){
							layer.alert(data.msg);
						}
					}
					$.ajax(option);
            },
            search:function(othis){
                var customerName=$('#customerName').val();
                var customerCode=$('#customerCode').val();
                var isDel=$('#isDel').val();

                var params={};
                params.customerName=customerName;
                params.customerCode=customerCode;
                if(null !=isDel && isDel !=""){
              	  params.isDel=isDel;
              }

                  //执行重载
                  table.reload('customerInfoTabId', {
                    where:params,
                    page:{"curr":1}
                  });
            },reset:function(othis){
                $('#customerName').val("");
                $('#customerCode').val("");
                $('#isDel').val("");
                form.render("select");
            }

    };

    table.on('sort(customerInfoTabF)', function (obj) {
        var sortColums;
        if(obj.field=="customerName"){
            sortColums = "customer_name "+obj.type;
        }else if(obj.field=="customerCode"){
            sortColums = "customer_code "+obj.type;
        }else if(obj.field=="customerAddress"){
            sortColums = "customer_address "+obj.type;
        }else if(obj.field=="createTime"){
            sortColums = "create_time "+obj.type;
        }else if(obj.field=="isDel"){
            sortColums = "is_del "+obj.type;
        }
        var customerName=$('#customerName').val();
        var customerCode=$('#customerCode').val();
        var status=$('#isDel').val();
          //执行重载
          table.reload('customerInfoTabId', {
            where:{
            	customerName:customerName,
            	customerCode:customerCode,
            	isDel:isDel,
                sortColums:sortColums,
                page:1
            }
          });
    });





</script>
</body>
</html>
