<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="charset=UTF-8">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
    <link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
    <link rel="stylesheet" href="/iles/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
    <link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
    <link rel="stylesheet" href="/iles/pages/layui/css/tableFilter.css"  type="text/css" />
    <title>调拨单详情</title>
</head>
<body >
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
    <div class="layui-fluid" >
        <div class="layui-fluid-table">
            <div class="layui-row layui-form">
                <div class="layui-btn-container">
                    <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="distributing" type="button"><i class="layui-icon layui-icon-edit"></i>创建</button>
                    {{# if(d.del==null || d.del=="true"){ }}
                    <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="editdistribute" type="button"><i class="layui-icon layui-icon-edit"></i>编辑</button>
                    <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="del" type="button"><i class="layui-icon layui-icon-delete"></i>删除</button>
                    {{# } }}
                </div>
            </div>
        </div>
    </div>
    <table class="layui-hide" id="transferSlipInfo" lay-filter="transferSlipInfoF"></table>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script type="text/html" id="toolbar">
    <a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
</script>
<script type="text/javascript">
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var laydate = layui.laydate;
    var beforeData = parent.oldData;
    var oldData;
    var index_open_add;
    var contextPath = config.wmsConfig.contextPath;
    var active = {
        // 创建调拨单详情
        distributing : function(othis) {
            oldData = beforeData;
            if (beforeData.status!="0"){
                layer.alert('已下发的调拨单不可创建！',{icon: 2});
                return ;
            }
            var type = othis.data('type');
            index_open_add = layer.open({
                type : 2,
                title : '创建调拨任务详情',
                maxmin : false,
                area : [ '100%', '100%' ],
                offset : type,
                id : 'transferSlipInfoAdd' + type //防止重复弹出
                ,
                content : 'transferSlipInfoAdd.html',
                shade : 0 //不显示遮罩
                ,
                yes : function() {
                    layer.closeAll();
                }
            });
            console.log(">>>index_open_add",index_open_add);
        },
        //编辑调拨单详情
        editdistribute : function(othis) {
            var checkStatus = table.checkStatus('transferSlipInfoId');
            oldData = checkStatus.data;
            if (beforeData.status!="0"){
                layer.alert('已下发的调拨单不可编辑！',{icon: 2});
                return ;
            }
            if(oldData.length<=0){
                layer.alert('请选择要编辑的行！',{icon: 2});
                return ;
            }else if(oldData.length >1){
                layer.alert('编辑不能超过多行！',{icon: 2});
                return ;
            }
            var type = othis.data('type');
            layer.open({
                type : 2,
                title : '编辑调拨单',
                maxmin : false,
                area : [ '100%', '100%'],
                offset : type,
                id : 'transferSlipInfoEdit' + type //防止重复弹出
                ,
                content : 'transferSlipInfoEdit.html',
                shade : 0 //不显示遮罩
                ,
                yes : function() {
                    layer.closeAll();
                }
            });
        },
        search : function(othis) {
            //执行重载
            table.reload('transferSlipInfoId', {
                where :{

                }
                ,page:{"curr":1}
            });
        },
        reset : function(othis) {

            form.render("select");
        }
        ,del:function(othis) {
            var checkStatus = table.checkStatus('transferSlipInfoId');
            oldData = checkStatus.data;
            if (beforeData.status!="0"){
                layer.alert('已下发的调拨单不可删除！',{icon: 2});
                return ;
            }
            if (oldData.length <= 0) {
                layer.alert('请选择要删除的行！', {icon: 2});
                return;
            }
            var idarrys = new Array();
            for (var i = 0; i < oldData.length; i++) {
                idarrys.push(oldData[i].id);
            }
            layer.confirm('确定删除该条调拨单详情记录信息?', {icon: 3, title: '提示'}, function (index) {
                //do something
                var option = {
                    url: contextPath + 'transferSlipInfo/delStationOrderInfo',
                    type: 'POST',
                    contentType: "application/json",
                    dataType: 'json',
                    data: JSON.stringify(idarrys),
                    success: function (data) {
                        if (data.code == 0) {
                            layer.alert("删除成功");
                            table.reload('transferSlipInfoId');
                        }
                    }, error: function (data) {
                        layer.alert(data.msg);
                    }
                }
                $.ajax(option);
                layer.close(index);
            });
        }
    };

    function loadding() {
        var tasksId = beforeData.tasksId;
        table.render({
            elem : '#transferSlipInfo',
            id : 'transferSlipInfoId',
            url : contextPath + 'transferSlipInfo/findTransferSlipInfoList',
            cols : [ [ {
                type : 'checkbox'
            }, {
                type : 'numbers',
                title : '序号'
            },{
                field : 'taskId',
                title : '调拨任务编号'
            }, {
                field : 'getPeople',
                title : '领取人'
            }, {
                field : 'getTime',
                title : '领取时间'
            }, {
                field : 'materialCode',
                title : '物料号'
            }, {
                field : 'materialDesc',
                title : '物料描述'
            }, {
                field : 'storageName',
                title : '仓位名称'
            }, {
                field : 'outNumber',
                title : '下架数量'
            }, {
                field : 'materialUnit',
                title : '单位'
            }, {
                field : 'batchNo',
                title : '批次'
            }, {
                field : 'outPeople',
                title : '下架人'
            },{
                field : 'outTime',
                title : '下架时间'
            }

            ] ],
            where : {
            //传值 startDate : startDate,
                taskId : tasksId,
            },
            page : {
                theme: '#008155'
            },
            even : true,
        });
        $('.layui-btn-container button').on('click', function() {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

    }

</script>
</body>
</html>
