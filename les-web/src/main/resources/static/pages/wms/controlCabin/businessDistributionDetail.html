<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Access-Control-Allow-Origin" content="*" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
<title>progressView</title>
<link rel="stylesheet" href="${ctx}/pages/layui/css/layui.css"  type="text/css" />

</head>

<body>
 <!--   <div id="title_div" style="font-size:20px;margin-top: -32px;">
		<a href="javaScript:history.go(-1)"  style="border:0px #000000 solid;   color:#000000;  line-height:90px">配送进度-业务组</a>><span>未完成物料详情</span>

	</div> -->

	<div class="layui-fluid">
		<div class="layui-row layui-form">
			<div class="layui-col-md3">
			 	<label class="layui-form-label">物料号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="materialCode" class="layui-input">
			    </div>
			</div>
			<div class="layui-col-md3">
			 	<label class="layui-form-label">工位:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="stationCode" class="layui-input">
			    </div>
			</div>
		 	<div class="layui-col-md3">
			 	<label class="layui-form-label">凭证号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="voucherCode_search" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md3">
			 	<label class="layui-form-label">集配单号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="assembleOrderCode_search" class="layui-input">
			    </div>
			 </div>

				 </div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
					<div class="layui-btn-container" style="text-align: right;">
					   <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
					   <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button>
					</div>
			</div>
		</div>
	</div>

	<table class="layui-hide" id="businessDistributionDetailTab" lay-filter="businessDistributionDetailTabF"></table>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>

    <script type="text/javascript">
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;

    var form = layui.form;
    var oldData;
    var id =getQueryVariable("type");
    var requiredTimeStart =getQueryVariable("requiredTimeStart");
    var requiredTimeEnd =getQueryVariable("requiredTimeEnd");
    var activeTime =getQueryVariable("activeTime");
    var warehouseCode =getQueryVariable("warehouseCode");
    table.render({
        elem:'#businessDistributionDetailTab',
        id:'businessDistributionDetailTabId',
        url:'${ctx}/businessDistributionPlanBoard/queryBusinessDistributionDetailData?type='+id+"&warehouseCode="+warehouseCode+"&requiredTimeStart="+requiredTimeStart+"&requiredTimeEnd="+requiredTimeEnd+"&activeTime="+activeTime,
        cols:[[
		{type:'numbers',title:'序号',fixed: 'left'},
		{field:'warehouseName',title:'仓库名称'},
		{field:'jobNode', title: '作业状态'},
		{field:'requiredType', title: '计划/非计划'},
		{field:'requiredTime', title: '需求日期'},
		{field:'activeTime', title: '派工日期'},
		{field:'materialCode',title:'物料号'},
		{field:'materialDesc', title: '物料描述'},
		{field:'requiredCount', title: '笔数'},
		{field:'materialUnit',title: '单位'},
		{field:'assembleOrderCode',title: '集配单据号'},
		{field:'voucherCode',title: '凭证号'},
		{field:'orderCode', title: '订单号'},
		{field:'orderMaterialCode', title: '订单物料描述'},
		{field:'subFactory', title: '分厂'},
		{field:'stationCode', title: '工位号'},
		{field:'pipeLineCode', title: '产品线'},
		{field:'carCode', title: '车号'},
		{field:'carrierCode', title: '载具编码'}
        ]],
        page: {theme: '#008155'},
        height: 'full-95',
        even:true,
        done:function(res,page,count){//列表数据回调函数
            initTableDate(res.data);

        }
    });


    var active = {

            search:function(othis){
                var materialCode=$.trim($('#materialCode').val());
                var stationCode=$.trim($('#stationCode').val());
                var voucherCode=$('#voucherCode_search').val();
				var assembleOrderCode=$('#assembleOrderCode_search').val();
                var params={};
                params.materialCode=materialCode;
                params.stationCode=stationCode;
                params.requiredTimeStart=requiredTimeStart;
                params.requiredTimeEnd=requiredTimeEnd;
                params.activeTime=activeTime;
                params.type=id;
                params.warehouseCode = warehouseCode;
                params.voucherCode=voucherCode
                params.assembleOrderCode=assembleOrderCode
                  //执行重载
                  table.reload('businessDistributionDetailTabId', {
                    where:params,
                    page:{"curr":1}
                  });
            },reset:function(othis){
                $('#materialCode').val("");
                $('#stationCode').val("");
                $('#voucherCode_search').val("");
				$('#assembleOrderCode_search').val("");
				form.render("select");
            },export:function(othis){
            	var materialCode=$.trim($('#materialCode').val());
                var stationCode=$.trim($('#stationCode').val());
                var voucherCode=$('#voucherCode_search').val();
				var assembleOrderCode=$('#assembleOrderCode_search').val();
				window.open("/iles/businessDistributionPlanBoard/exportUnfinshDetail?type="+id+"&warehouseCode="+warehouseCode+"&requiredTimeStart="+requiredTimeStart+"&requiredTimeEnd="+requiredTimeEnd+"&activeTime="+activeTime
						+"&materialCode="+materialCode+"&stationCode="+stationCode+"&voucherCode="+voucherCode+"&assembleOrderCode="+assembleOrderCode);
			}

    };
    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });

    function getQueryVariable(variable)
    {
           var query = window.location.search.substring(1);
           var vars = query.split("&");
           for (var i=0;i<vars.length;i++) {
                   var pair = vars[i].split("=");
                   if(pair[0] == variable){
                   	return pair[1];
                   }
           }
           return(false);
    }
    //表格数据初始化
    function initTableDate(data){

        $("[data-field='jobNode']").children().each(function(){
            if($(this).text()=='30'){
                $(this).text('待派工');
            }else if($(this).text()=='31'){
                $(this).text('待下架');
            }else if($(this).text()=='33'){
                $(this).text('待集配 ');
            }else if($(this).text()=='35'){
                $(this).text('待审核');
            }else if($(this).text()=='40'){
                $(this).text('待移库');
            }else if($(this).text()=='42'){
                $(this).text('待编组');
            }else if($(this).text()=='50'){
                $(this).text('待发货');
            }else if($(this).text()=='60'){
                $(this).text('待缓冲卸货');
            }else if($(this).text()=='61'){
                $(this).text('待缓冲复核');
            }else if($(this).text()=='62'){
                $(this).text('待缓冲发货');
            }else if($(this).text()=='71'){
                $(this).text('送达完成');
            }
        });
        $("[data-field='requiredType']").children().each(function(){
            if($(this).text()=='0'){
                $(this).text('计划');
            }
            if($(this).text()=='1'){
                $(this).text('非计划');
            }
        });
    }



</script>
