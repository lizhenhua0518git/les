<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="${ctx}/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="${ctx}/pages/css/layui_extend.css"  media="all">
<link rel="stylesheet" href="${ctx}/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
<title>配送超时明细列表</title>
</head>
<body>
	<div class="layui-fluid">
	<div class="layui-row layui-form">
			 <div class="layui-col-md3">
			 	<label class="layui-form-label">物料号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="materialCode_search" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md3">
			 	<label class="layui-form-label">订单号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="orderCode_search" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md3">
			 	<label class="layui-form-label">凭证号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="voucherCode_search" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md3">
			 	<label class="layui-form-label">集配单号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="assembleOrderCode_search" class="layui-input">
			    </div>
			 </div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
 					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button>
				</div>
			</div>
		</div>
	</div>
	<table class="layui-hide" id="materialTab" lay-filter="materialTabF"></table>
	<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
	   <script src="/iles/pages/js/urlParam.js" charset="UTF-8"></script>
	<script type="text/javascript">
		var $ = layui.$;
		var element = layui.element;
		var layer = layui.layer;
		var table = layui.table;
		var form = layui.form;
		var paramsMap = UrlParam.paramMap();
		var stationCode,jobNode,endDay,beginDay;
		if(paramsMap.stationCode){
			stationCode = paramsMap.stationCode[0];
		}
		if(paramsMap.jobNode){
			jobNode = paramsMap.jobNode[0];
		}
		if(paramsMap.beginDay){
			beginDay = paramsMap.beginDay[0];
		}
		if(paramsMap.endDay){
			endDay = paramsMap.endDay[0];
		}
		table.render({
			elem:'#materialTab',
			id:'materialTabId',
			url:'/iles/teamSchedule/queryOverTimeDetail',
			cols:[[
			{type:'numbers',title:'序号',fixed: 'left'},
			{field:'orgName',title:'仓库名'},
			{field:'jobNode', title: '作业状态'},
			{field:'requiredType', title: '计划/非计划'},
			{field:'requiredTime', title: '需求日期'},
			{field:'activeTime', title: '派工日期'},
			{field:'materialCode',title:'物料号'},
			{field:'materialDesc', title: '物料描述'},
			{field:'enableCount', title: '配送数'},
			{field:'materialUnit',title: '单位'},
			{field:'assembleOrderCode',title: '集配单据号'},
			{field:'voucherCode',title: '凭证号'},
			{field:'orderCode', title: '订单号'},
			{field:'orderMaterialCode', title: '订单物料描述'},
			{field:'subFactory', title: '分厂'},
			{field:'stationCode', title: '工位号'},
			{field:'pipeLineCode', title: '产品线'},
			{field:'carCode', title: '车号'},
			{field:'carrierCode', title: '载具编码'}
			]],
			page: {theme: '#008155'},
	   		height: 'full-95',
	   		even:true,
	   		where:{
	   			stationCode:stationCode,
	   			jobNode:jobNode,
	   			beginDay:beginDay,
	   			endDay:endDay
	   		},
	   		done:function(res,page,count){//列表数据回调函数
	            initTableDate(res.data);
	        }
		});
		var active = {
				search:function(othis){
					var materialCode = $('#materialCode_search').val();
					var orderCode = $('#orderCode_search').val();
					var voucherCode=$('#voucherCode_search').val();
					var assembleOrderCode=$('#assembleOrderCode_search').val();
				      //执行重载
				      table.reload('materialTabId', {
				        where:{
				           stationCode: stationCode
				           ,jobNode:jobNode
				           ,materialCode:materialCode
				           ,orderCode:orderCode
				           ,beginDay:beginDay
				           ,endDay:endDay
				           ,voucherCode:voucherCode
				           ,assembleOrderCode:assembleOrderCode
				        }
				        ,page:{"curr":1}
				      });
				},reset:function(othis){
					$('#materialCode_search').val("");
					$('#orderCode_search').val("");
					$('#voucherCode_search').val("");
					$('#assembleOrderCode_search').val("");
					form.render("select");
				},export:function(othis){
					var materialCode = $('#materialCode_search').val();
					var orderCode = $('#orderCode_search').val();
					var voucherCode=$('#voucherCode_search').val();
					var assembleOrderCode=$('#assembleOrderCode_search').val();
					window.open("/iles/teamSchedule/exportOverTimeDetail?stationCode="+stationCode+"&jobNode="+jobNode+"&materialCode="+materialCode
							+"&orderCode="+orderCode+"&beginDay="+beginDay+"&endDay="+endDay+"&voucherCode="+voucherCode+"&assembleOrderCode="+assembleOrderCode);
				}

		};
		$('.layui-btn-container button').on('click', function(){
		    var othis = $(this), method = othis.data('method');
		    active[method] ? active[method].call(this, othis) : '';
	  	});
		function initTableDate(data){
	        $("[data-field='jobNode']").children().each(function(){
	            if($(this).text()=='30'){
	                $(this).text('待派工');
	            }else if($(this).text()=='31'){
	                $(this).text('待下架');
	            }else if($(this).text()=='33'){
	                $(this).text('待集配 ');
	            }else if($(this).text()=='35'){
	                $(this).text('待审核');
	            }else if($(this).text()=='40'){
	                $(this).text('待移库');
	            }else if($(this).text()=='42'){
	                $(this).text('待编组');
	            }else if($(this).text()=='50'){
	                $(this).text('待发货');
	            }else if($(this).text()=='60'){
	                $(this).text('待缓冲卸货');
	            }else if($(this).text()=='61'){
	                $(this).text('待缓冲复核');
	            }else if($(this).text()=='62'){
	                $(this).text('待缓冲发货');
	            }else if($(this).text()=='71'){
	                $(this).text('送达完成');
	            }else if($(this).text()=='80'){
	                $(this).text('交接完成');
	            }
	        });
	        $("[data-field='requiredType']").children().each(function(){
	            if($(this).text()=='0'){
	                $(this).text('计划');
	            }
	            if($(this).text()=='1'){
	                $(this).text('非计划');
	            }
	        });
	    }
	</script>
</body>
</html>
