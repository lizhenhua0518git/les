<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Access-Control-Allow-Origin" content="*" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
<title>配送进度-业务组</title>
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/controlCabin/businessDistribution.css">
</head>

<body>
<div id="bodyDiv">

</div>

<!-- 
<div class="container mt50 ml50 mr50" >
	<div class="tit">各仓库数据情况</div>
	<ul class="section" id="warehouse" >
		
		 
	</ul>
</div>
 -->
 <script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/assets/js/jquery-1.10.2.js"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
 
<script src="/iles/pages/js/controlCabin/resetFontSize.js"></script>
 
<script src="/iles/pages/js/controlCabin/echarts.js"></script>
<script type="text/html" id="bodyTpl">

<div class="progressTop">
<div class="dateChoose">
	<div class="_inline">
		<label>需求日期</label>
		<input type="text" name="" id="requiredTime" style="width:400px;">
	</div>
	<div class="_inline ml60">
		<label>派工日期</label>
		<input type="text" name="" id="activeTime" style="width:400px;">
	</div>
</div>
<div class="buttonGroup">
	<button onclick="queryBusinessDistributionData()">查询</button>
	<button onclick="rest()">重置</button>
	 
</div>
</div>
<div class="container mt30 ml20 mr20">
<ul class="section section2">
	<li>
		<div>
			<ul class="asTable" id="sendData">
				 
			</ul>
		</div>
	</li>
	<li>
	  

	            	 
		<div>
			<ul class="asTable" id="sendRhythmData">
				 
			</ul>
		</div>
	</li>
	<li>
		<div>
			<ul class="asTable" id="sendUnrhythmData">
				 
			</ul>
		</div>
	</li>
	
	<li>
		<div>
			<ul class="asTable" id="handoverData">
				 
			</ul>
		</div>
	</li>
	<li>
		<div>
			<ul class="asTable" id="handoverRhythmData">
				 
			</ul>
		</div>
	</li>
	<li>
		<div>
			<ul class="asTable" id="handoverUnrhythmData">
				 
			</ul>
		</div>
	</li>
</ul>
<ul class="percentInfo" id="sendProductLineData">
	 
</ul>
<ul class="percentInfo percentInfo2" id="handoverpRroductLineData">
	 
</ul>
</div>

</script>
<script>
var contextPath = config.wmsConfig.contextPath;
function loadding(){
	
    
	layui.use(['element','laydate'],function(){
		
		var laydate = layui.laydate;
		var curDate = new Date();
		curDate.setDate(curDate.getDate()+1);
		var curDateStr = dateFtt("yyyy-MM-dd",curDate);
		var defautDate = curDateStr+" - "+curDateStr;
		//日期控件
		laydate.render({
			elem:"#requiredTime",
			 range: true,
			 value:defautDate
			 
		});
		laydate.render({
			elem:"#activeTime",
			  
		
		});
		queryBusinessDistributionData();
		 
	})
}
 

function dateFtt(fmt,date)   
{ //author: meizz   
  var o = {   
    "M+" : date.getMonth()+1,                 //月份   
    "d+" : date.getDate(),                    //日   
    "h+" : date.getHours(),                   //小时   
    "m+" : date.getMinutes(),                 //分   
    "s+" : date.getSeconds(),                 //秒   
    "q+" : Math.floor((date.getMonth()+3)/3), //季度   
    "S"  : date.getMilliseconds()             //毫秒   
  };   
  if(/(y+)/.test(fmt))   
    fmt=fmt.replace(RegExp.$1, (date.getFullYear()+"").substr(4 - RegExp.$1.length));   
  for(var k in o)   
    if(new RegExp("("+ k +")").test(fmt))   
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
  return fmt;   
}
	function queryBusinessDistributionData(){
		var element = layui.element;
		var requiredTime =$("#requiredTime").val();
		var  requiredTimeStart = requiredTime.split(' - ')[0];
	   	var requiredTimeEnd = requiredTime.split(' - ')[1];
		var activeTime =$("#activeTime").val();
		var option ={
		           url:contextPath+'businessDistributionPlanBoard/listBusinessDistributionData',
		           type:'POST',
		           data:{"activeTime":activeTime,"requiredTimeStart":requiredTimeStart,"requiredTimeEnd":requiredTimeEnd},
		           dataType:'json',
		           success:function(data){
		               if(data.code==0){
		            	   var resultData = data.data;
		            	   var requiredTime =resultData.requiredTime;
		            	   
		            	   
		            	  var sendProductLineDataMap =  resultData.sendProductLineDataMap;
		            	  var handoverpRroductLineDataMap =  resultData.handoverpRroductLineDataMap;
		            	  var productLineList =  resultData.productLineList;
		   
		            	  var orgnizationList = resultData.orgnizationList;
		            	  var sendProductLineDataHtml ="";
		            	  var handoverpRroductLineDataHtml ="";
		            	  var sendDataHtml = '<li>'
								+'<div>送达进度</div>'
								+'<div>完成占比</div>'
								+'<div>总数量</div>'
								+'<div>未完成</div>';
								+'</li>';
						  var 	handoverDataHtml 	= '<li>'
								+'<div>交接进度</div>'
								+'<div>完成占比</div>'
								+'<div>总数量</div>'
								+'<div>未完成</div>';
								+'</li>';
						  var 	sendRhythmDataHtml =	'<li>'
								+'<div>工位送达进度</div>'
								+'<div>完成占比</div>'
								+'<div>总数量</div>'
								+'<div>未完成</div>';
								+'</li>';
						  var 	sendUnrhythmDataHtml =	'<li>'
								+'<div>非工位送达进度</div>'
								+'<div>完成占比</div>'
								+'<div>总数量</div>'
								+'<div>未完成</div>';
								+'</li>';
						  var 	handoverRhythmDataHtml =	'<li>'
								+'<div>工位交接进度</div>'
								+'<div>完成占比</div>'
								+'<div>总数量</div>'
								+'<div>未完成</div>';
								+'</li>';;
						  var 	handoverUnrhythmDataHtml =	'<li>'
								+'<div>非工位交接进度</div>'
								+'<div>完成占比</div>'
								+'<div>总数量</div>'
								+'<div>未完成</div>';
								+'</li>';;;
		            	  for(var i=0;i<productLineList.length;i++){
		            		  var productLine = productLineList[i];
		            		  var productLineCode = productLine.productLineCode;
		            		  var productLineName = productLine.productLineName;
		            		  sendProductLineDataHtml=sendProductLineDataHtml+ '<li>'
		          			+'<p>'+productLineName+'</p>'
		          			+'<span>'+sendProductLineDataMap[productLineCode]+'</span>'
		          			+'</li>';
		          			
		          			  handoverpRroductLineDataHtml=handoverpRroductLineDataHtml+ '<li>'
			          			+'<p>'+productLineName+'</p>'
			          			+'<span>'+handoverpRroductLineDataMap[productLineCode]+'</span>'
			          			+'</li>';
		            		 
		            	  }
		            	  
						  var sendDataMap = resultData.sendDataMap;
		            	  var handoverDataMap = resultData.handoverDataMap;
		            	  var sendRhythmDataMap = resultData.sendRhythmDataMap;
		            	  var sendUnrhythmDataMap = resultData.sendUnrhythmDataMap;
		            	  var handoverRhythmDataMap = resultData.handoverRhythmDataMap;
		            	  var handoverUnrhythmDataMap = resultData.handoverUnrhythmDataMap;
		            	  
		            	  for(var i =0;i<orgnizationList.length;i++){
		            		  var orgnization = orgnizationList[i];
		            		  var warehouseCode =  orgnization.orgCode;
		            		  var warehouseName = orgnization.orgName;
		            		  var sendDataList = sendDataMap[warehouseCode];
		            		  var handoverDataList = handoverDataMap[warehouseCode];
		            		  var sendRhythmDataList = sendRhythmDataMap[warehouseCode];
		            		  var sendUnrhythmDataList = sendUnrhythmDataMap[warehouseCode];
		            		  var handoverRhythmDataList = handoverRhythmDataMap[warehouseCode];
		            		  var handoverUnrhythmDataList = handoverUnrhythmDataMap[warehouseCode];
		            		  
		            		  sendDataHtml=sendDataHtml
		            		+'<li>'
							+'<div>'
							+'<label>'+warehouseName+'</label>'
							+'<div class="customBar"> '
							+'<div class="layui-progress" lay-filter="sendData_'+warehouseCode+'">'
							+'<div class="layui-progress-bar" lay-percent="30%"></div>'
							+'</div>'
							+'</div> '
							+'</div>'
							+'<div>'+sendDataList[2]+'</div>'
							+'<div>'+sendDataList[0]+'</div>'
							 
							+'<div style="cursor:pointer;" onclick="showTab(1,1,'+"'"+warehouseCode+"'"+')">'+ (Number(sendDataList[0])- Number(sendDataList[1]))+'</div>'
							+'</li>';         
							
							handoverDataHtml=handoverDataHtml
			            		+'<li>'
								+'<div>'
								+'<label>'+warehouseName+'</label>'
								+'<div class="customBar"> '
								+'<div class="layui-progress" lay-filter="handoverData_'+warehouseCode+'">'
								+'<div class="layui-progress-bar" lay-percent="30%"></div>'
								+'</div>'
								+'</div> '
								+'</div>'
								+'<div>'+handoverDataList[2]+'</div>'
								+'<div>'+handoverDataList[0]+'</div>'
								+'<div style="cursor:pointer;" onclick="showTab(1,4,'+"'"+warehouseCode+"'"+')">'+(Number(handoverDataList[0])- Number(handoverDataList[1]))+'</div>'
								+'</li>';                             
								
		            		  
								
								sendRhythmDataHtml=sendRhythmDataHtml
			            		+'<li>'
								+'<div>'
								+'<label>'+warehouseName+'</label>'
								+'<div class="customBar"> '
								+'<div class="layui-progress" lay-filter="sendRhythmData_'+warehouseCode+'">'
								+'<div class="layui-progress-bar" lay-percent="30%"></div>'
								+'</div>'
								+'</div> '
								+'</div>'
								+'<div>'+sendRhythmDataList[2]+'</div>'
								+'<div>'+sendRhythmDataList[0]+'</div>'
								+'<div style="cursor:pointer;" onclick="showTab(1,2,'+"'"+warehouseCode+"'"+')">'+(Number(sendRhythmDataList[0])- Number(sendRhythmDataList[1])) +'</div>'
								+'</li>';                             
								
								
								sendUnrhythmDataHtml=sendUnrhythmDataHtml
			            		+'<li>'
								+'<div>'
								+'<label>'+warehouseName+'</label>'
								+'<div class="customBar"> '
								+'<div class="layui-progress" lay-filter="sendUnrhythmData_'+warehouseCode+'">'
								+'<div class="layui-progress-bar" lay-percent="30%"></div>'
								+'</div>'
								+'</div> '
								+'</div>'
								+'<div>'+sendUnrhythmDataList[2]+'</div>'
								+'<div>'+sendUnrhythmDataList[0]+'</div>'
								+'<div onclick="showTab(1,3,'+"'"+warehouseCode+"'"+')">'+(Number(sendUnrhythmDataList[0])- Number(sendUnrhythmDataList[1])) +'</div>'
								+'</li>';                             
								
								
								handoverRhythmDataHtml=handoverRhythmDataHtml
			            		+'<li>'
								+'<div>'
								+'<label>'+warehouseName+'</label>'
								+'<div class="customBar"> '
								+'<div class="layui-progress" lay-filter="handoverRhythmData_'+warehouseCode+'">'
								+'<div class="layui-progress-bar" lay-percent="30%"></div>'
								+'</div>'
								+'</div> '
								+'</div>'
								+'<div>'+handoverRhythmDataList[2]+'</div>'
								+'<div>'+handoverRhythmDataList[0]+'</div>'
								+'<div style="cursor:pointer;" onclick="showTab(1,5,'+"'"+warehouseCode+"'"+')">'+(Number(handoverRhythmDataList[0])- Number(handoverRhythmDataList[1]))  +'</div>'
								+'</li>';       
								handoverUnrhythmDataHtml=handoverUnrhythmDataHtml
			            		+'<li>'
								+'<div>'
								+'<label>'+warehouseName+'</label>'
								+'<div class="customBar"> '
								+'<div class="layui-progress" lay-filter="handoverUnrhythmData_'+warehouseCode+'">'
								+'<div class="layui-progress-bar" lay-percent="30%"></div>'
								+'</div>'
								+'</div> '
								+'</div>'
								+'<div>'+handoverUnrhythmDataList[2]+'</div>'
								+'<div>'+handoverUnrhythmDataList[0]+'</div>'
								+'<div style="cursor:pointer;" onclick="showTab(1,6,'+"'"+warehouseCode+"'"+')">'+(Number(handoverUnrhythmDataList[0])- Number(handoverUnrhythmDataList[1])) +'</div>'
								+'</li>';                     
		            		  
		            	  }
		            	  $("#sendData").html(sendDataHtml);
		            	  $("#handoverData").html(handoverDataHtml);
		            	  $("#sendRhythmData").html(sendRhythmDataHtml);
		            	  $("#sendUnrhythmData").html(sendUnrhythmDataHtml);
		            	  $("#handoverRhythmData").html(handoverRhythmDataHtml);
		            	  $("#handoverUnrhythmData").html(handoverUnrhythmDataHtml);
		            	  
		            	  
		            	  for(var i =0;i<orgnizationList.length;i++){
		            		  var orgnization = orgnizationList[i];
		            		  var warehouseCode =  orgnization.orgCode;
		            		  
		            		  var sendDataList = sendDataMap[warehouseCode];
		            		  var handoverDataList = handoverDataMap[warehouseCode];
		            		  var sendRhythmDataList = sendRhythmDataMap[warehouseCode];
		            		  var sendUnrhythmDataList = sendUnrhythmDataMap[warehouseCode];
		            		  var handoverRhythmDataList = handoverRhythmDataMap[warehouseCode];
		            		  var handoverUnrhythmDataList = handoverUnrhythmDataMap[warehouseCode];
		            		  
		            		  var key ="sendData_"+warehouseCode;
		            		  element.progress(key, sendDataList[2]);
		            		  
		            		  
		            		    key ="handoverData_"+warehouseCode;
		            		   element.progress(key, handoverDataList[2]);
		            		  
		            		  
		            		    key ="sendRhythmData_"+warehouseCode;
		            		  element.progress(key, sendRhythmDataList[2]);
		            		  
		            		   
		            		    key ="sendUnrhythmData_"+warehouseCode;
		            		  element.progress(key, sendUnrhythmDataList[2]);
		            		  
		            		   
		            		    key ="handoverRhythmData_"+warehouseCode;
		            		  element.progress(key, handoverRhythmDataList[2]);
		            		  
		            		  
		            		    key ="handoverUnrhythmData_"+warehouseCode;
		            		  element.progress(key, handoverUnrhythmDataList[2]);
		            	  }
		            	  
		            	  
		            	  $("#sendProductLineData").html(sendProductLineDataHtml);
		            	  $("#handoverpRroductLineData").html(handoverpRroductLineDataHtml);
		            	  //fillBusinessDistributionData(resultData);
		               }
		           },error:function(data){
		               layer.alert(data.msg);
		           }
		}
		 $.ajax(option);
	}
	
	
	
	
	function fillBusinessDistributionData(resultData){
		 
		         
		     var warehouseHtml ='';
           	 var orgnizationList = resultData.orgnizationList;
           	  
           	  var sendRhythmDataMap = resultData.sendRhythmDataMap;
           	  var sendUnrhythmDataMap = resultData.sendUnrhythmDataMap;
           	  var handoverRhythmDataMap = resultData.handoverRhythmDataMap;
           	  var handoverUnrhythmDataMap = resultData.handoverUnrhythmDataMap;
           	for(var i=0;i<orgnizationList.length;i++){
           		 var orgnization = orgnizationList[i];
           		  var warehouseCode =  orgnization.orgCode;
           		  
           		 warehouseHtml =warehouseHtml+'<li >'
       			+'<div>'
       			+'<div class="chart" id="'+warehouseCode+'"   ></div>'
       			+'</div>'
       			+'</li>	';
           	}
           	
           	$("#warehouse").html(warehouseHtml);
            
           	for(var i=0;i<orgnizationList.length;i++){
           		 var orgnization = orgnizationList[i];
           		  var warehouseCode =  orgnization.orgCode;
           		  var warehouseName = orgnization.orgName;
           		//$("#"+warehouseCode).height('250px');
           		//$("#"+warehouseCode).width('600px');
           		  var sendRhythmDataList = sendRhythmDataMap[warehouseCode];
           		  var sendUnrhythmDataList = sendUnrhythmDataMap[warehouseCode];
           		  var handoverRhythmDataList = handoverRhythmDataMap[warehouseCode];
           		  var handoverUnrhythmDataList = handoverUnrhythmDataMap[warehouseCode];
           		  
           		  var finishArray = new Array();
           		  finishArray.push(sendRhythmDataList[1]);
           		  finishArray.push(sendUnrhythmDataList[1]);
           		  finishArray.push(handoverRhythmDataList[1]);
           		  finishArray.push(handoverUnrhythmDataList[1]);
           		  var unfinishArray = new Array();
           		  unfinishArray.push(Number(sendRhythmDataList[0])-Number(sendRhythmDataList[1]));
           		  unfinishArray.push(Number(sendUnrhythmDataList[0])-Number(sendUnrhythmDataList[1]));
           		  unfinishArray.push(Number(handoverRhythmDataList[0])-Number(handoverRhythmDataList[1]));
           		  unfinishArray.push(Number(handoverUnrhythmDataList[0])-Number(handoverUnrhythmDataList[1]));
           		  drawBar(warehouseCode,warehouseName,finishArray,unfinishArray);
           	}
	 
		            
		}
		  
	
	function drawBar(id,name,finishArray,unfinishArray){
		
		var bar = document.getElementById(id);
		var option = {
			title:{
				text: name,
				textStyle:{
					color: "#89bef3",
					fontSize:20,
				},
				left:"center",
				top:"5%"
			},
			color: ['#2cc0f7', '#ee8a62'],
			legend: {
				bottom:"1%",
				itemHeight:25,
				textStyle:{
					color:"#89bef3",
					fontSize:16
				},
				data: ['完成', '未完成']
			},
			grid: {
				top:'20%',
				bottom:'22%'
			},
			xAxis: {
				type: 'category',
				axisLine:{show:false},
				axisTick: {show: false},
				axisLabel: {color:"#89bef3",fontSize:16},
				data: ['工位送达', '非工位送达', '工位交接', '非工位交接']
			},
			yAxis: {
				type: 'value',
				axisLine:{show:false},
				axisLabel: {color:"#89bef3",fontSize:16},
				splitLine:{
					lineStyle:{
						color:"#295288",

					}
				}
			},
			series: [
				{
					name: '完成',
					type: 'bar',
					barWidth:30,
					barGap: "20%",
					itemStyle:{
						barBorderRadius:[5,5,0,0]
					},
					data: finishArray
				},
				{
					name: '未完成',
					type: 'bar',
					barWidth:30,
					itemStyle:{
						barBorderRadius:[5,5,0,0]
					},
					data: unfinishArray
				}
			]
		};
	 
		echarts.init(bar).setOption(option);
		 
	}
	
	function rest(){
		$("#requiredTime").val("");
		$("#activateTime").val("");
	}
	  function show(){
		   var mydate = new Date();
		   var str = "" + mydate.getFullYear() + "-";
		   var month =mydate.getMonth()+1;
		   if(Number(month)<10){
			   str +="0"+month + "-";
		   }else{
			   str += month+ "-";
		   }
		  
		   str += mydate.getDate();
		   return str;
		  }
	  
	  
	  
	  function showTab(type,id,warehouseCode){
		  var requiredTime =$("#requiredTime").val();
			var  requiredTimeStart = requiredTime.split(' - ')[0];
		   	var requiredTimeEnd = requiredTime.split(' - ')[1];
			var activeTime =$("#activeTime").val();
     	 var url="";
     	 var title="";
     	 var dataId="";
     	 if(type==1){
     		 //url = 'pages/mfc/controlCabin/businessDistributionDetail.html?type='+id+"&warehouseCode="+warehouseCode+"&requiredTimeStart="+requiredTimeStart+"&requiredTimeEnd="+requiredTimeEnd+"&activeTime="+activeTime;
     		  url = 'businessDistributionDetail.html?type='+id+"&warehouseCode="+warehouseCode+"&requiredTimeStart="+requiredTimeStart+"&requiredTimeEnd="+requiredTimeEnd+"&activeTime="+activeTime;
     		 title ='配送进度业务组-明细';
     		 dataId ="businessDistributionDetail"; 
     	 } 
     	 
           layer.open({
               type: 2
               ,title:'物料明细信息'
               ,area: ['100%', '100%']
               ,id: 'dDetail' //防止重复弹出
               ,content:url
               ,shade: 0 //不显示遮罩
               ,yes: function(){
                 layer.closeAll();
               }
        	 });
          //}
      } 
</script>
</body>
</html>
