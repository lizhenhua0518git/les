<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="Access-Control-Allow-Origin" content="*" />
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
<title>配送计划-班组</title>
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css">
<link rel="stylesheet" href="/iles/pages/css/controlCabin/flipclock.css">
<link rel="stylesheet" href="/iles/pages/css/controlCabin/progressView.css">
</head>

<body>
<div id="bodyDiv">
 
</div>
 
 
 <script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/assets/js/jquery-1.10.2.js"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
 <script src="/iles/pages/wms/controlCabin/productPlanBoard/js/resetFontSize.js"></script>

<script src="/iles/pages/wms/controlCabin/productPlanBoard/plugins/digital/flipclock.js"></script>
<script src="/iles/pages/wms/controlCabin/productPlanBoard/js/easypiechart.js"></script>
 

<script type="text/html" id="bodyTpl">
<div class="progressTop">
<div class="dateChoose">
	<div class="_inline">
		<label>需求日期</label>
		<input type="text" name="" id="requiredDate" style="width: 7rem">
	</div>
</div>
<div class="buttonGroup">
	<button onclick="loading()">查询</button>
	<button id="cli">重置</button>
	<!-- <button>导出</button> -->
</div>
</div>
<div class="container mt50 ml50 mr50">
<div id="currStorageName" class="tit"></div>
<ul class="_panel section">
	<li style="float: none; margin-right: 0; width: 18rem; height: 2.5rem">
		<div>
			<div class="title" style="width: 3rem">
				<h1>计划出库</h1>
				<div class="clock"></div>
			</div>
			<dl style="width: 300px">
				<dt>工位制</dt>
				<dd id="planCount">0</dd>
			</dl>
			<dl style="width: 200px">
				<dt>非工位制</dt>
				<dd id="noPlanCount">0</dd>
			</dl>
			<div class="circleProgress" style="width:1.5rem;">
				<h1>配送完成进度</h1>
				<div class="easypiechart" data-percent="88.66" id="circleProgress">
					<span class="percent">0%</span>
				</div>
			</div>
		</div>
	</li>
	<li style="float: none;margin-right: 0;width: 18rem"">
		<div>
			<div class="chartBar" id="DoubleBar"></div>
		</div>
	</li>
</ul>
</div>
</script>
 

<script type="text/javascript"> 
var contextPath = config.wmsConfig.contextPath;
function loadding(){
   $(function(){
		
		infoData();
		loading();
		$("#cli").click(function(){
			infoData();
		});
	});
	layui.use(['laydate'],function(){
		var laydate = layui.laydate;
		
		//日期控件
		laydate.render({
			elem:"#requiredDate",
			type: 'datetime',
			range: true
		});
	})
 
		 
 
	
}

function loading(){
	var requiredDate = $("#requiredDate").val();
	var startTime="";
	var endTime="";
	if(requiredDate==""){
		infoData();
	}
	if(requiredDate && requiredDate.length>0){
		startTime = requiredDate.substring(0,20);
		endTime = requiredDate.substring(22,32);
		endTime+=" 23:59:59";
	}
	$.ajax({
        url: contextPath+"TeamWorkPlan/head",
        dataType:'json',
		type:'POST',
        async: false,
	    contentType:'application/json',
        data: JSON.stringify({
        	"requiredStartTime":startTime,
        	"requiredEndTime":endTime
        }),
        success: function (result) {
            var a = "0";
            if(result.code==0){
            	var data = result.data;
                	FlipClock($('.clock'), data.sunCount, {
            			clockFace: 'Counter'
            		});
                	a = data.percentage+"";
                	$('#circleProgress').data('easyPieChart').update(a);
                	$('#circleProgress .percent').text(data.percentage+"%");
                	$('#planCount').text(data.planCount);
                	$('#noPlanCount').text(data.noPlanCount);
                	$('#currStorageName').text(data.currStorageName);
                }else{
                	FlipClock($('.clock'), 0, {
            			clockFace: 'Counter'
            		});
                	$('#circleProgress').data('easyPieChart').update(a);
                	$('#circleProgress .percent').text("0.00%");
                	$('#planCount').text("0");
                	$('#noPlanCount').text("0");
                	$('#currStorageName').text("--");
                }
    	}
    });
	$.ajax({
        url: contextPath+"TeamWorkPlan/boday",
        dataType:'json',
		type:'POST',
        async: false,
	    contentType:'application/json',
	    data: JSON.stringify({
        	"requiredStartTime":startTime,
        	"requiredEndTime":endTime
        }),
        success: function (result) {
            if(result.code==0){
            	var data = result.data;
            	var stationCode = [];
            	var endCount = [];
            	var notEndCount = [];
            	var count = [];
                	for (var i = 0; i < data.length; i++) {
                		stationCode.push(data[i].stationCode);
                		endCount.push(data[i].endCount);
                		notEndCount.push(data[i].notEndCount);
                		count.push(data[i].count);
					}
                	renderDoubleBar('DoubleBar',stationCode,count,endCount,notEndCount);
                }
            }
    });
}

function infoData(){
	var newDate = new Date();
	newDate.setDate(newDate.getDate()+1);
	var dateString = newDate.toLocaleDateString();
	if(newDate.getMonth()+1<10){
		dateString = dateString.replace("/","-0");
	}else{
		dateString = dateString.replace("/","-");
	}
	if(newDate.getDate()<10){
		dateString = dateString.replace("/","-0");
	}else{
		dateString = dateString.replace("/","-");
	}
	startTime=dateString+" 00:00:00";
	endTime=dateString+" 23:59:59";
	$("#requiredDate").val(startTime+" - "+endTime)
}
 
</script>

<script>
	//配送完成进度
	$('#circleProgress').attr("data-percent","0");
	$('#circleProgress .percent').text("0%");
	$('#circleProgress').easyPieChart({
		trackColor: '#457db5',
		scaleColor: false,
		lineWidth: 12,
		lineCap:'square',
		rotate:0,
		size:100,		
		barColor: '#40edfe'
	});
</script>
<script src="/iles/pages/js/controlCabin/echarts.js"></script>
<script>
	function renderDoubleBar(id,stationCode,count,endCount,notEndCount){
		var bar = document.getElementById(id);
		var option = {
			color: ['#2cc0f7', '#ee8a62'],
			legend: {
				top:"6%",
				itemHeight:25,
				itemGap:30,
				textStyle:{
					color:"#89bef3",
					fontSize:16
				},
				data: ['完成', '未完成']
			},
			grid: {
				top:'25%',
				bottom:'15%'
			},
			xAxis: {
				type: 'category',
				axisLine:{show:false},
				axisTick: {show: false},
				axisLabel: {color:"#89bef3",fontSize:16},
				data: stationCode
			},
			yAxis: {
				type: 'value',
				axisLine:{show:false},
				axisLabel: {color:"#89bef3",fontSize:16},
				splitLine:{
					lineStyle:{
						color:"#295288",
					}
				}
			},
			dataZoom:[
				{
					type:'inside',
				}
			],
			tooltip:{
				show:true,
			},
			series: [
				{
					type: 'bar',
					barWidth:30,
					barGap: "-100%",
					stack: 'one',
					itemStyle:{
						barBorderRadius:[5,5,0,0],
						opacity:1,
					},
					label: {
						normal: {
							show: true,
							position: 'top',
							color:'#fff',
							fontSize:16,
						}
					},
					data: count//工位制与非工位制数据对应总和
				},
				{
					name: '完成',
					type: 'bar',
					barWidth:30,
					barGap: "-100%",
					stack: 'two',
					data: endCount
				},
				{
					name: '未完成',
					type: 'bar',
					barWidth:30,
					barGap: "-100%",
					stack: 'two',
					itemStyle:{
						barBorderRadius:[5,5,0,0]
					},
					data: notEndCount
				}
			]
		};
		var n = echarts.init(bar)
		n.setOption(option);
		checkHeight(bar,n);
	}
	function checkHeight(domObj,chartObj){
		if(domObj.clientWidth==0){
			setTimeout(function(){
				checkHeight(domObj,chartObj);
			}, 1000);
		}else{
			chartObj.resize({
				width:domObj.clientWidth,
				height:domObj.clientHeight
			});
		}
	}
	
	
</script>
 
</body>
</html>
