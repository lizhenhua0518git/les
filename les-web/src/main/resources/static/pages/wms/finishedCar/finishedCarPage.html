<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" type="text/css" href="/iles/pages/css/layui_extend.css"/>
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
	<title>成品车列表</title>
    <style>
        .layui-form-label{
            width: 100px;
        }
    </style>
</head>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
    <div class="layui-fluid">
        <div class="layui-row layui-form">
            <div class="layui-col-md2">
                <label class="layui-form-label">存放位置</label>
                <div class="layui-input-inline">
                    <input type="text" id="locationCodeeOrDesc" class="layui-input">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-inline">
                    <select id="status" xm-select="statusSelect" xm-select-show-count="1">
                        <option value="">请选择</option>
                        <option value="0">已入场</option>
                        <option value="5">已出场</option>
                    </select>
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">VIN号</label>
                <div class="layui-input-inline">
                    <input type="text" id="vinCode" class="layui-input">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">订单号</label>
                <div class="layui-input-inline">
                    <input type="text" id="orderCode" class="layui-input">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">客户名称</label>
                <div class="layui-input-inline">
                    <input type="text" id="customerName" class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-row layui-form">
            <div class="layui-col-md2">
                <label class="layui-form-label">入场时间</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" name="" id="createTime" placeholder="请选择入场时间">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">出场时间</label>
                <div class="layui-input-inline layui-form">
                    <input type="text" class="layui-input" name="" id="modifiedTime" placeholder="请选择出场时间">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">车辆型号</label>
                <div class="layui-input-inline">
                    <input type="text" id="carModel" class="layui-input">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">发动机(电机)型号</label>
                <div class="layui-input-inline">
                    <input type="text" id="engineModel" class="layui-input">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">发动机(电机)号</label>
                <div class="layui-input-inline">
                    <input type="text" id="engineCode" class="layui-input">
                </div>
            </div>

            <div class="layui-btn-container nav-" style="text-align: right;">
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="search" id="search" type="button">
                    <i class="layui-icon layui-icon-search"></i>查询
                </button>
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="reset" id="reset" type="button"><i
                        class="layui-icon layui-icon-reset"></i>重置
                </button>
            </div>
        </div>
    </div>
	<div class="layui-fluid-table">
        <div class="layui-row layui-form">
            <div class="layui-btn-container">
                <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="dataOutPC" id="dataOutPC" type="button" title="车俩出场"><i class="layui-icon layui-icon-edit"></i>出场</button>
            </div>
        </div>
		<table id="finishedCarTab" lay-filter="finishedCarTabF"></table>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<!--<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>-->
<!--<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>-->

<script type="text/javascript">
    var wmsContextPath = config.wmsConfig.contextPath;
	var table = layui.table;
	var form= layui.form;
    var laydate = layui.laydate;
    var oldData;
    var active = {
        search: function (othis) {

            let locationCodeeOrDesc = $('#locationCodeeOrDesc').val();//存放位置描述
            let status = $('#status').val();//状态
            let vinCode = $('#vinCode').val();//VIN号
            let orderCode = $('#orderCode').val();//订单号
            let customerName = $('#customerName').val();//客户名称
            let createTime = $('#createTime').val();//入场时间
            let modifiedTime = $('#modifiedTime').val();//出场时间
            let carModel = $('#carModel').val();//车辆型号
            let engineModel = $('#engineModel').val();//发电机型号
            let engineCode = $('#engineCode').val();//发电机号

            //执行重载
            table.reload('finishedCarTabId', {
                where: {
                    storageLocationDesc: locationCodeeOrDesc,
                    status: status,
                    vinCode: vinCode,
                    orderCode: orderCode,
                    customerName: customerName,
                    createTimeStr: createTime,
                    modifiedTimeStr: modifiedTime,
                    carModel: carModel,
                    engineModel: engineModel,
                    engineCode: engineCode
                },
                page: {"curr": 1}
            });
        },
        reset: function (othis) {
            $('#locationCodeeOrDesc').val("");
            $('#status').val("");
            $('#vinCode').val("");
            $('#orderCode').val("");
            $('#customerName').val("");
            $('#createTime').val("");
            $('#modifiedTime').val("");
            $('#carModel').val("");
            $('#engineModel').val("");
            $('#engineCode').val("");
            form.render("select");

        },

        dataOutPC:function (othis){
            let task = table.checkStatus('finishedCarTabId').data;
            console.log(task);
            if(task==null || task.length===0){
                layer.alert('请选择要出场的车辆信息！', {icon: 2});
                return;
            }
            var outInfoList = new Array();
            for (let i = 0; i < task.length; i++) {
                if (task[i].status != 0){
                    layer.alert('请选择未出场的成品车！ 序号为'+(i+1)+'的成品车已出库', {icon: 2});
                    return;
                }
                var one = {
                    id:task[i].id,
                    storageLocationDesc:task[i].storageLocationDesc
                };
                outInfoList.push(one);
            }
            var outData = {
                outInfo:outInfoList
            };

            console.log(">>>>>outData:",outData);
            layer.confirm('是否执行?', {icon: 3, title: '提示'}, function (index) {
                var option = {
                    url: wmsContextPath + 'finishedCarPC/dataOutPC',
                    type: 'POST',
                    contentType: "application/json",
                    dataType: 'json',
                    data: JSON.stringify(outData),
                    success: function (data) {
                        if (data.code == 0) {
                            layer.alert("执行成功");
                            table.reload('finishedCarTabId');
                        }else {
                            console.log(">>>>data",data);
                            layer.alert("执行失败");
                        }
                    }, error: function (data) {
                        layer.alert(data.msg);
                    }
                };
                $.ajax(option);
                layer.close(index);
            });
        }
    };

	function loadding() {
		table.render({
			elem: '#finishedCarTab',
			id: 'finishedCarTabId',
			url: wmsContextPath + 'finishedCarPC/pageResult',
			cols: [[
                {type: 'checkbox',fixed:'left'},
				{type:'numbers',title:'序号',fixed: 'left'},
				{field: 'storageLocationDesc', width: 140, title: '存放位置'},
				{field: 'status', width: 100, title: '车辆状态',
					templet(d){
						if(d.status==0){
							return '已入场';
						}else if(d.status==5){
							return '已出场';
						}else{
							return '-';
						}}
						},
				{field: 'createTime', width: 140, title: '入场时间'},
				{field: 'modifiedTime', width: 140, title: '出场时间'},
				{field: 'createrName', width: 120, title: '入场操作者'},
				{field: 'modifierName', width: 120, title: '出场操作者'},
				{field: 'orderCode', width: 100, title: '生产订单'},
				{field: 'vinCode', width: 100, title: 'VIN'},
				{field: 'productLine', width: 100, title: '产线'},
				{field: 'carModel', width: 150, title: '车俩型号'},
				{field: 'engineModel', width: 130, title: '发动机(电机)型号'},
				{field: 'engineCode', width: 130, title: '发动机(电机)号'},
				{field: 'customerName', width: 130, title: '客户名称'},
				{align:'center',title: '操作',toolbar:'#toolBar',width:185,fixed: 'right'}

			]],
			page: {theme: '#008155'},
			height: 'full-95',
			even: true,
			done: function (res, page, count) {//列表数据回调函数

			}
		});

		//监听工具条
        table.on('tool(finishedCarTabF)', function (obj) {
            var eventName = obj.event;
            var clickObj = obj.data;
            if (eventName == "detail") {	//详情
                oldData = obj.data;
                console.log("clickObj", clickObj);
                layer.open({
                    type: 2
                    , title: '成品车详情'
                    , maxmin: true
                    , area: ['1400px', '700px']
                    , offset: 2
                    , id: 'finishedCarTabF' + 2 //防止重复弹出
                    , content: 'finishedCarDetailLog.html'
                    , shade: [0.8, '#fff'] //显示遮罩
                    , yes: function () {
                        layer.closeAll();
                    }
                });
            }
        });
        $('.layui-btn-container button').on('click', function () {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

        var start,end;
        //月份修正
        function doneTime(date){
            return {
                year: date.year,
                month: date.month - 1,
                date: date.date
            }
        };
        //时间选择器
        start = laydate.render({
            elem: '#createTime'
            , type: 'date'
            , trigger: 'click'
            , done:function (value,date) {
                // 将选中的时间绑定到vo上
                // $scope.vo.startDate = new Date(value);
                //将结束日的初始值设定为开始日
                end.config.min = doneTime(date);
                end.config.value = doneTime(date);
            }
        });

        end = laydate.render({
            elem: '#modifiedTime'
            , type: 'date'
            , trigger: 'click'
            ,done:function (value,date) {
                // 将选中的时间绑定到vo上
                // $scope.vo.endDate = new Date(value);
                //结束日选好后，重置开始日的最大日期
                start.config.max = doneTime(date);
            }
        });

		form.render();
	}
</script>
<script type="text/html" id="toolBar">
	<a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
</script>
</html>
