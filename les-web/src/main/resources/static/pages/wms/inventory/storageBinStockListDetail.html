<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>仓位库存出入明细</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
</head>
<body>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">仓库</label>
				<div class="layui-input-block">
					<select id="warehouseCode" xm-select="warehouseCodeSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">工厂</label>
				<div class="layui-input-block">
					<select id="factory" xm-select="factorySelect" lay-filter="factoryLay" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">库存地点</label>
				<div class="layui-input-block">
					<select id="storageLocation" xm-select="storageLocationSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">物料编号</label>
				<div class="layui-input-block">
					<input type="text" id="materialCode" class="layui-input" placeholder="请输入物料编号">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">物料描述</label>
				<div class="layui-input-block">
					<input type="text" id="materialDesc" class="layui-input" placeholder="请输入物料描述">
				</div>
			</div>
			<div class="layui-col-md2">
				<div class="layui-btn-container">
					{{# if(d.search==null || d.search=="true"){ }}
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
					{{# } }}
				</div>
			</div>
		</div>
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">库存类型</label>
				<div class="layui-input-block">
					<select id="stockType" xm-select="stockTypeSelect" xm-select-show-count="1">
						<option value="">--请选择--</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">变更单号</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="changeCode" placeholder="请输入变更单号">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">变更时间</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" name="" id="changeTime" placeholder="请选择变更时间">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">变更人</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="modifierId" placeholder="请输入变更人">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">库存状态</label>
				<div class="layui-input-block">
					<select id="stockStatus" xm-select="stockStatusSelect" xm-select-show-count="1">
						<option value="">--请选择--</option>
					</select>
				</div>
			</div>
		</div>
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">供应商/客户</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="supplierName" placeholder="请输入供应商/客户">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">订单</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="orderCode" placeholder="请输入订单">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">订单行项目号</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="orderItemNo" placeholder="请输入编号">
				</div>
			</div>
		</div>
	</div>
	<div class="layui-fluid-table">
		<!--<div class="layui-row layui-form">
			<div class="layui-btn-container">
				{{# if(d.export==null || d.export=="true"){ }}
					<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button>
				{{# } }}
			</div>
		</div>-->
		<table id="queryStore" lay-filter="orderTypeTabF"></table>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script type="text/javascript">
	var documentPath = config.basicInfoConfig.contextPath;
	var contextPath = config.wmsConfig.contextPath;
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
	var laydate = layui.laydate;
	var oldData;
	var active = {
		export:function(othis){
			var token = window.localStorage.token;
			var materialCode = $('#materialCode').val();
			var factory = $('#factory').val();
			var warehouse = layui.formSelects.value('select1', 'valueStr');
			var batchNo = $('#batchNo').val();
			var positionCode = $('#positionCode').val();
			var stationCode = $('#stationCode').val();
			var supplierCode = $('#supplierCode').val();
			var supplierName = $('#supplierName').val();
			var projectId = $('#projectId').val();
			var storageType = $('#storageType').val();
			var specialType = $('#specialType').val();
			var businessNode = $('#businessNode').val();
			var voucherCode = $('#voucherCode').val();
			var sourceBillCode = $('#sourceBillCode').val();
			var specialTypeCode = $('#specialTypeCode').val();
			var params = "materialCode="+materialCode+"&factory="+factory+"&warehouse="+warehouse
			+"&batchNo="+batchNo+"&positionCode="+positionCode+"&stationCode="+stationCode
			+"&supplierCode="+supplierCode+"&supplierName="+supplierName+"&projectId="+projectId
			+"&storageType="+storageType+"&specialType="+specialType+"&businessNode="+businessNode
			+"&voucherCode="+voucherCode+"&sourceBillCode="+sourceBillCode+"&token="+token+"&specialTypeCode="+specialTypeCode
			window.open(contextPath+"materialStorageBin/storeBinStockListDetailExport?"+params);
		},
		search:function(othis){
			var materialCode = $('#materialCode').val();
			var materialDesc = $('#materialDesc').val();
			var changeCode = $('#changeCode').val();
			var supplierName = $('#supplierName').val();
			var orderCode = $('#orderCode').val();
			var orderItemNo = $('#orderItemNo').val();
			var modifierId = $('#modifierId').val();
			var warehouseCode = layui.formSelects.value('warehouseCodeSelect', 'valueStr');//仓库编号
			var storageLocation = layui.formSelects.value('storageLocationSelect', 'valueStr');//库存地点
			var factory = $('#factory').val();//工厂
			var changeTime = $('#changeTime').val();
			var stockType = layui.formSelects.value('stockTypeSelect', 'valueStr');//库存地点
			var stockStatus = layui.formSelects.value('stockStatusSelect', 'valueStr');//库存地点
			//执行重载
			table.reload('storeTabId', {
				where:{
					materialCode : materialCode,
					materialDesc:materialDesc,
					changeCode:changeCode,
					supplierName : supplierName,
					orderCode : orderCode,
					orderItemNo : orderItemNo,
					modifierId : modifierId,
					warehouseCode:warehouseCode,
					factory:factory,
					storageLocation:storageLocation,
					startingTime:changeTime,
					stockType:stockType,
					stockStatus:stockStatus,
				},
				page:{"curr" : 1}
			});
		},
		reset:function(othis){
			$('#materialCode').val("");
			$('#materialDesc').val("");
			$('#changeCode').val("");
			$('#supplierName').val("");
			$('#orderCode').val("");
			$('#orderItemNo').val("");
			$('#modifierId').val("");
			layui.formSelects.value('warehouseCodeSelect', []);
			layui.formSelects.value('storageLocationSelect', []);
			layui.formSelects.value('stockTypeSelect', []);
			layui.formSelects.value('stockStatusSelect', []);
			$('#factory').val("");
			$('#changeTime').val("");
			form.render("select");
		}
	};
	function loadding(){
		table.render({
			elem:'#queryStore',
			id:'storeTabId',
			url:contextPath+'materialStorageBin/listStoreBinStockDetail',
			cols: [[
				{type:'checkbox',fixed:'left'},
				{title: '序号',templet: '#indexTpl',width: 60},
				{field:'factory',title: '工厂',minWidth: 110,fixed:'left'},
				{field:'storageLocation',title: '工厂库存地点', minWidth: 140,fixed:'left'},
				{field:'warehouseName',title: '仓库名称',minWidth: 140,fixed:'left'},
				{field:'materialCode',title: '物料号',minWidth: 90,fixed:'left'},
				{field:'materialDesc',title: '物料描述',fixed:'left',minWidth: 90},
				{field:'batchNo', title: '批次号', minWidth: 100},
				{field:'supplierName', title: '供应商/客户', minWidth: 100},
				{field:'orderCode', title: '订单号', minWidth: 100},
				{field:'stockStatusName', title: '库存状态', minWidth: 100},
				{field:'changeType', title: '变更类型', minWidth: 100},
				{field:'changeNum', title: '变更数量', minWidth: 100},
				{field:'changeCode', title: '变更单号', minWidth: 100},
				{field:'modifierName', title: '变更人', minWidth: 100},
				{field:'changeTime', title: '变更时间', minWidth: 100}
				]],
			page: {theme: '#008155'},
			height: '500px',
			even:true,
			done:function(res,page,count){//列表数据回调函数

			}
		});
		$('.layui-btn-container button').on('click', function(){
			var othis = $(this), method = othis.data('method');
			active[method] ? active[method].call(this, othis) : '';
		});
		laydate.render({
			elem: '#changeTime'
			,type: 'date'
			,range: true
		});
		initWarehouseMultiSelect("warehouseCode","warehouseCodeSelect","0",null);
		initStockType();
		initStockStatus();
	}

	function initStockType() {
		var option = {
			url:documentPath + 'dict/initStockType',
			type:"GET",
			success:function(result){
				if(result.code==0){
					var data=result.data;
					if (data.length>0){
						var optoinArray = new Array();
						for(var i=0;i<data.length;i++){
							itemOption = {"name":""+data[i].itemName, "value":""+data[i].itemValue};
							optoinArray.push(itemOption);
						}
						layui.formSelects.data(stockTypeSelect,'local',{
							arr:optoinArray
						});
						layui.formSelects.value(stockTypeSelect, [],true);
						layui.form.render("select");
					}
				}
			}
		}
		$.ajax(option);
	}

	function initStockStatus() {
		var option = {
			url:documentPath + 'dict/initStockStatus',
			type:"GET",
			success:function(result){
				if(result.code==0){
					var data=result.data;
					if (data.length>0){
						var optoinArray = new Array();
						for(var i=0;i<data.length;i++){
							itemOption = {"name":""+data[i].itemName, "value":""+data[i].itemValue};
							optoinArray.push(itemOption);
						}
						layui.formSelects.data(stockStatusSelect,'local',{
							arr:optoinArray
						});
						layui.formSelects.value(stockStatusSelect, [],true);
						layui.form.render("select");
					}
				}
			}
		}
		$.ajax(option);
	}
</script>
</body>
</html>
