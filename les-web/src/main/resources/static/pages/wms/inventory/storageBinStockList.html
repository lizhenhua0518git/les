<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>仓位库存列表</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" type="text/css" href="/iles/pages/css/layui_extend.css"/>
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
</head>
<body>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">仓库名称</label>
				<div class="layui-input-block">
					<select id="warehouseCode" xm-select="warehouseCodeSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">库位编号</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="positionCode" placeholder="请输入库位编号">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">货物名称</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="materialDesc" placeholder="请输入货物名称">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">库位载具编号</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" id="positionCarCode" placeholder="请输入库位载具编号">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">客户名称</label>
				<div class="layui-input-block">
					<select id="clientName" xm-select="clientNameSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
            <div class="layui-col-md2" style="float: right">
                <div class="layui-btn-container">
                    {{# if(d.search==null || d.search=="true"){ }}
                    <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
                    <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset"  id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
                    {{# } }}
                </div>
            </div>
		</div>
	</div>
	<div class="layui-fluid-table">
		<div class="layui-row layui-form">
			<div class="layui-btn-container">
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="changeStatus" type="button"><i class="layui-icon layui-icon-edit"></i>更改状态</button>
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="changeStyle" type="button"><i class="layui-icon layui-icon-edit"></i>仓位转移</button>
			</div>
		</div>
		<table id="queryStore" lay-filter="orderTypeTabF"></table>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/clientManage.js" charset="UTF-8"></script>
<script type="text/javascript">
	var contextPath = config.stockConfig.contextPath;
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
	var oldData;
	var stockDataArray;
	var active = {
		search:function(othis){
			var materialDesc = $('#materialDesc').val();//物料号
			var warehouseCode = layui.formSelects.value('warehouseCodeSelect', 'valueStr');//仓库编号
			var positionCode = $('#positionCode').val();//库位编号
			var positionCarCode = $('#positionCarCode').val();//库位编号
			var clientName = layui.formSelects.value('clientNameSelect', 'valueStr');//仓库编号
			table.reload('storeTabId', {
				where:{
					materialDesc : materialDesc,
					warehouseCode : warehouseCode,
					positionCode : positionCode,
					positionCarCode : positionCarCode,
					clientName : clientName,
				},
				page:{"curr" : 1}
			});
		},reset:function(othis){
			layui.formSelects.value('warehouseCodeSelect',[]);
			layui.formSelects.value('clientNameSelect',[]);
			$('#materialDesc').val("");
			$('#positionCarCode').val("");
			$('#positionCode').val("");
			form.render("select");
		},
		//库存状态变更
		changeStatus : function(othis) {
			var checkStatus = table.checkStatus('storeTabId');
			oldData=checkStatus.data;
			var length = oldData.length;
			if(length==0){
				layer.alert('请选择要移动的数据',{icon: 2});
				return false;
			}
			if(length>1){
				layer.alert('只能选择一行数据操作!',{icon: 2});
				return false;
			}
			var type = othis.data('type');
			layer.open({
				type : 2,
				title : '更改状态',
				maxmin : false,
				area : [ '40%', '60%' ],
				offset : type,
				id : 'storageBinType' + type,//防止重复弹出
				content : 'storageBinType.html',
				shade : 0, //不显示遮罩
				yes : function() {
					layer.closeAll();
				}
			});
		},
		//库存类型变更
		changeStyle : function (othis) {
			let checkStatus = table.checkStatus('storeTabId');
            oldData=checkStatus.data[0];
			let type = othis.data('type');
			layer.open({
				type : 2,
				title : '仓位转移',
				maxmin : false,
				area : [ '40%', '60%' ],
				offset : type,
				id : 'storageBinType' + type,
				content : 'materialStorageBinType.html',
				shade : 0 ,
				yes : function() {
					layer.closeAll();
				}
			});

		}
	}
	function loadding(){
		table.render({
			elem:'#queryStore',
			id:'storeTabId',
			url:contextPath+'storageBin/listMaterialStorageBin',
			cols: [[
				{
					type : 'checkbox',width: 100,fixed:'left'
				},
				{type:'numbers',title:'序号',width: 100,fixed:'left'},
				{field:'warehouseName',title: '仓库名称', minWidth: 100,fixed:'left'},
				{field:'warehouseCode',title: '仓库编号', sort: true,minWidth: 140,fixed:'left'},
				{field:'clientName',title: '客户名称',minWidth: 100,fixed:'left'},
				{field:'positionCode',title: '库位编号',minWidth: 90,fixed:'left'},
				{field:'positionCarCode',title: '库位载具编号',minWidth: 90,fixed:'left'},
				{field:'materialDesc', title: '货物名称', minWidth: 100, sort: true,fixed:'left'},
				{field:'materialUnit', title: '货物单位', minWidth: 100},
				{field:'stockCount', title: '非限制数量', minWidth: 100},
				{field:'preUseCount', title: '预占数量', minWidth: 80},
				{field:'frozenCount', title: '冻结数量', minWidth: 80},
				{field:'batchNo', title: '批次号', minWidth: 100},
				{field:'stockStatus', title: '库存状态', minWidth: 100,templet(d){
						if(d.stockStatus=='0'){
							return '合格';
						}else if(d.stockStatus=='1') {
							return '不合格';
						}
				}},
				{field:'createTime', title: '创建时间', minWidth: 100},
				]],
			page: {theme: '#008155'},
			height: 'full-95',
			even:true,
			done:function(res,page,count){//列表数据回调函数

			}
		});

		$('.layui-btn-container button').on('click', function(){
			var othis = $(this), method = othis.data('method');
			active[method] ? active[method].call(this, othis) : '';
		});

		initWarehouseMultiSelect("warehouseCode","warehouseCodeSelect","1",null);
		initClientManageList("clientNameSelect",[]);
	}

	function initAreaTypeName() {
		$.ajax({
			url: contextPath+"materialStorageBin/initAreaTypeName",
			dataType: 'json',
			contentType: "application/json",
			type: 'get',
			success: function (data) {

				$("#areaType").empty();//清空下拉框的值
				$.each(data.data, function (index, item) {
					$('#areaType').append(new Option(item, item));// 下拉菜单里添加元素
				});
				layui.form.render("select");//重新渲染 固定写法
			}
		});
	}

	//库存状态配置方法
	function stockStatusMatch(data) {
	    //库存状态:0非限制 1冻结 2待质检
        var  status = data.stockStatus;
        //冻结原因 1,质检不合格 2,生产不合格
        var  s_R = data.unenableReason;
		let temStr;
        //'标题：<span title="冻结原因:'+s_R+'">'+ temStr +'</span>'
		switch (status) {
			case 0:
                temStr = "非限制";
				break;
			case 1:
                var R;
                var temp = "冻结";
                if (s_R == 1){
                    R = "质检不合格"
                }else if (s_R == 2) {
                    R = "生产不合格"
                }else {
					R = "未知"
				}
                temStr = '<div title="冻结原因:'+R+'">'+ temp +'</div>';
                break;
			case 2:
                temStr = "待质检";
				break;
			default:
				break;
		}
		return temStr;
	}
</script>
</body>
</html>
