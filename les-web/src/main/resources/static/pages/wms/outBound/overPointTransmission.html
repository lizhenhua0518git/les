<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Content-Type" content="charset=UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/layui.css" type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/css/layui_extend.css" type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css"/>
    <title>过点信息</title>
</head>
<body id="bodyDiv">
<script type="text/html" id="bodyTpl">
    <div class="layui-fluid">
        <div class="order">
            <div class="orderTitle">今日生产订单顺序</div>
            <ul class="orderList" id="orderList">
                <li>请选择车间和产线，然后点击搜索按钮</li>
            </ul>
        </div>
        <div class="layui-row layui-form">
            <div class="layui-col-md2">
                <label class="layui-form-label">车间</label>
                <div class="layui-input-inline">
                    <select id="workshopCode_search" xm-select="workshopCode_search" xm-select-show-count="1">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">产线</label>
                <div class="layui-input-inline">
                    <select id="lineCode_search" xm-select="lineCode_search" xm-select-show-count="1">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">工位</label>
                <div class="layui-input-inline">
                    <select id="stationCode_search" xm-select="stationCode_search" xm-select-show-count="1">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">生产日期</label>
                <div class="layui-input-inline">
                    <input type="text" class="layui-input" id="requiredTime_search" placeholder="请选择生产日期">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">订单号</label>
                <div class="layui-input-inline">
                    <input type="text" id="orderCode_search" class="layui-input" placeholder="请输入订单号">
                </div>
            </div>
            <div class="layui-btn-container nav-" style="text-align: right;">
                {{# if(d.search==null || d.search=="true"){ }}
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="search" id="search" type="button">
                    <i class="layui-icon layui-icon-search"></i>查询
                </button>
                <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="reset" id="reset" type="button"><i
                        class="layui-icon  layui-icon-reset"></i>重置
                </button>
                {{# } }}
            </div>
        </div>
    </div>
    <div class="layui-fluid-table">
        <table class="layui-hide" id="overPointTransmissionTab" lay-filter="overPointTransmissionTabF"></table>
    </div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script type="text/javascript">
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
    var form = layui.form;
    var laydate = layui.laydate;
    var oldData;
    var contextPath = config.wmsConfig.contextPath;
    var omsContextPath = config.omsConfig.contextPath;
    var active = {
        search: function (othis) {
            var workshopCode = layui.formSelects.value('workshopCode_search', 'valueStr');
            var lineCode = layui.formSelects.value('lineCode_search', 'valueStr');
            var stationCode = layui.formSelects.value('stationCodeSelect', 'valueStr');
            var requiredTime = $('#requiredTime_search').val();
            var orderCode = $('#orderCode_search').val();
            var params = {};
            params.workshopCode = workshopCode;
            params.stationCode = stationCode;
            params.lineCode = lineCode;
            params.requiredTimeStr = requiredTime;
            params.orderCode = orderCode;
            //执行重载
            table.reload('overPointTransmissionTabId', {
                where: params,
            });
            initOrderList();
        },
        reset: function (othis) {
            layui.formSelects.value('workshopCode_search', []);
            layui.formSelects.value('lineCode_search', []);
            layui.formSelects.value('stationCodeSelect', []);
            $('#requiredTime_search').val("");
            $('#orderCode_search').val("");
            form.render("select");
        }
    };

    function loadding() {
        //时间选择器
        laydate.render({
            elem: '#requiredTime_search',
            type: 'date',
            range: false
        });
        table.render({
            elem: '#overPointTransmissionTab',
            id: 'overPointTransmissionTabId',
            url: contextPath + 'overPointTransmission/listOverPointTransmission',
            cols: [[{
                type: 'checkbox'
            }, {
                type: 'numbers',
                title: '序号'
            }, {
                field: 'orderCode',
                title: '生产订单号'
            }, {
                field: 'requiredTime',
                title: '生产日期',
                templet(d){
                    if(d.requiredTime){
                        return d.requiredTime.substring(0,10);
                    }else{
                        return '-';
                    }
                }
            }, {
                field: 'workShopName',
                title: '车间'
            }, {
                field: 'lineName',
                title: '产线'
            }, {
                field: 'stationName',
                title: '工位'
            }, {
                field: 'createTime',
                title: '过点时间'
            }, {
                field: 'pointFlag',
                title: '过点标识',templet(d){
                    if(d.pointFlag=='0'){
                        return '正常过点';
                    }else if(d.pointFlag=='1'){
                        return '离队过点';
                    }else if(d.pointFlag=='1'){
                        return '归队过点';
                    }else{
                        return '-';
                    }
                }
            }]],
            page: {
                theme: '#008155'
            },
            even: true,
            where: {'requiredTimeStr': $('#requiredTime_search').val()},
            done: function (res, page, count) {//列表数据回调函数
            }
        });
        $('.layui-btn-container button').on('click', function () {
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

        inintPlantMultiSelect("workshopCode_search", [], 2);
        // inintPlantMultiSelect("lineCode_search", [], 3);
        // inintPlantMultiSelect("stationCodeSelect", [], 4);//工位
    }

    function initStationCode() {//工位
        $.ajax({
            url: config.basicInfoConfig.contextPath + "stationManager/getAllStationCode",
            type: "GET",
            success: function (result) {
                $('#stationCode_search').html("");
                $('#stationCode_search').append('<option value="">请选择</option>');
                var order = result.data;
                if (order && order.length > 0) {
                    var optionItem;
                    var optoinArray = new Array();
                    for (var i = 0; i < order.length; i++) {
                        optionItem = {"name": "" + order[i].stationCode, "value": "" + order[i].stationCode};
                        optoinArray.push(optionItem);
                    }
                    layui.formSelects.data('stationCodeSelect', 'local', {
                        arr: optoinArray
                    });
                }
            }
        });
    }
    function initOrderList(){
        var workshopCode = layui.formSelects.value('workshopCode_search', 'valueStr');
        var lineCode = layui.formSelects.value('lineCode_search', 'valueStr');
        var params = {};
        params.workshopCode = workshopCode;
        params.lineCode = lineCode;
        var option = {
            url : omsContextPath + 'processOrder/listSortProcessOrder',
            data : params,
            type : 'GET',
            success : function(data) {
                // data =JSON.parse(data);
                if(data.code==0){
                    // layer.msg(data.data);
                    data=data.data;
                    var html=[];
                    for (var i=0;i<data.length;i++){
                        html.push('<li style="background-color: #ececec">订单'+data[i].orderCode+'</li>');
                    }
                    $('#orderList').html(html.join(''));
                }else{
                    console.log(data);
                    layer.alert(data.data);
                }
            },
            error : function(data) {
                layer.alert("请求接口异常")
            }
        }
        $.ajax(option);
    }
</script>
</body>
</html>
