<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<link rel="stylesheet" href="/iles/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<link rel="stylesheet" href="/iles/pages/layui/css/tableFilter.css"  type="text/css" />
<title>下架作业历史查询</title>
</head>
<body>
<div id="bodyDiv">

</div>

<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script type="text/html" id="bodyTpl">
<div class="layui-fluid">
	<div class="layui-row layui-form">
			 <div class="layui-col-md3">
                 <label class="layui-form-label">仓库:</label>
                 <div class="layui-input-block">
					<select id="warehouseCode" xm-select="select1" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
                </div>
     		</div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">集配单号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="assembleOrderCode_search" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">工序物料号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="processMaterialCode_search" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">工序物料描述:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="processMaterialDesc_search" class="layui-input">
			    </div>
			 </div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md3">
				<label class="layui-form-label">工序订单号</label>
				 <div class="layui-input-block">
			      <input type="text" id="processOrderCode_search" class="layui-input">
			    </div>
			</div>
			<div class="layui-col-md2">
			 	<label class="layui-form-label">派工日期:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="activeTime_search" class="layui-input" placeholder="yyyy-MM-dd">
			    </div>
			 </div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">需求日期:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="requiredTime_search" class="layui-input" placeholder="yyyy-MM-dd">
			    </div>
			 </div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">物料编码:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="materialCode_search" class="layui-input">
			    </div>
			 </div>

		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
				<div class="layui-btn-container">
					{{# if(d.search==null || d.search=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
					{{# } }}
				</div>
		</div>
</div>
<table class="layui-hide" id="lowerFrameTab" lay-filter="lowerFrameTabF"></table>
</script>
<script type="text/html" id="toolbar">
	<a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
</script>
<script type="text/javascript">
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
	var dictItems = null;//存储数据字典
	var contextPath = config.wmsConfig.contextPath;
	var lowerFrameData;
	var assembleId="";
	var deliveryCode="";
	var orderCode="";
	var active = {
			search:function(othis){
				var assembleOrderCode_search = $("#assembleOrderCode_search").val();
				var processMaterialCode_search = $("#processMaterialCode_search").val();
				var processMaterialDesc_search = $("#processMaterialDesc_search").val();
				var processOrderCode_search = $("#processOrderCode_search").val();
				var activeTime_search = $("#activeTime_search").val();
				var requiredTime_search = $("#requiredTime_search").val();
				var materialCode_search = $("#materialCode_search").val();
				var storageLocation = layui.formSelects.value('select1', 'storagelocationStr');
				var activeStartTime="",activeEndTime="",requireStartTime="",requireEndTime="";
				if(activeTime_search.length>0){
					activeStartTime = activeTime_search.substring(0,20);
					activeEndTime = activeTime_search.substring(22);
				}
				if(requiredTime_search.length>0){
					requireStartTime = requiredTime_search.substring(0,10);
					requireEndTime = requiredTime_search.substring(13);
				}
				table.reload("lowerFrameTabId",{
					where:{
						storageLocation:'1100',
						assembleOrderCode:assembleOrderCode_search,
						processMaterialCode:processMaterialCode_search,
						processMaterialDesc:processMaterialDesc_search,
						processOrderCode:processOrderCode_search,
						activeStartTime:activeStartTime,
						activeEndTime:activeEndTime,
						requireStartTime:requireStartTime,
						requireEndTime:requireEndTime,
						materialCode:materialCode_search,
						storageLocation:storageLocation
					}
					,page:{"curr":1}
				})
			},reset:function(othis){
				$("#assembleOrderCode_search").val("");
				$("#processMaterialCode_search").val("");
				$("#processMaterialDesc_search").val("");
				$("#processOrderCode_search").val("");
				$("#activeTime_search").val("");
				$("#requiredTime_search").val("");
				$("#materialCode_search").val("");
				layui.formSelects.value('select1', []);
			},export:function(othis){
				othis.attr("class","layui-btn layui-btn-normal layui-btn-sm layui-btn-disabled");
				var assembleOrderCode_search = $("#assembleOrderCode_search").val();
				var processMaterialCode_search = $("#processMaterialCode_search").val();
				var processMaterialDesc_search = $("#processMaterialDesc_search").val();
				var processOrderCode_search = $("#processOrderCode_search").val();
				var activeTime_search = $("#activeTime_search").val();
				var requiredTime_search = $("#requiredTime_search").val();
				var storageLocation = layui.formSelects.value('select1', 'storagelocationStr');
				var activeStartTime="",activeEndTime="",requireStartTime="",requireEndTime="";
				if(activeTime_search.length>0){
					activeStartTime = activeTime_search.substring(0,10);
					activeEndTime = activeTime_search.substring(13);
				}
				if(requiredTime_search.length>0){
					requireStartTime = requiredTime_search.substring(0,10);
					requireEndTime = requiredTime_search.substring(13);
				}
				var dataParam = {
					storageLocation:'1100',
					assembleOrderCode:assembleOrderCode_search,
					processMaterialCode:processMaterialCode_search,
					processMaterialDesc:processMaterialDesc_search,
					processOrderCode:processOrderCode_search,
					activeStartTime:activeStartTime,
					activeEndTime:activeEndTime,
					requireStartTime:requireStartTime,
					requireEndTime:requireEndTime,
					storageLocation:storageLocation
				};
				var option = {
						url:contextPath+'/outBoundPlanManger/queryLowerFrameList',
						data:dataParam,
						dataType:'json',
						type:'GET',
						success:function(res){
							if(res.code==0){
								table.exportFile(lowerFrameData.config.id, res.data,'xls');
								othis.attr("class","layui-btn layui-btn-normal layui-btn-sm");
							}else{
								layer.alert("导出失败！"+res.msg);
							}
						},error:function(){
							layer.alert("导出失败！后台请求失败");
						}
				};
				$.ajax(option);

			}
	};
	function loadding(){
		layui.use('laydate', function(){
			var laydate = layui.laydate;
			//时间选择器
			  laydate.render({
			    elem: '#requiredTime_search'
			    ,type: 'date'
			    ,range: true
			  });
			  laydate.render({
				    elem: '#activeTime_search'
				    ,type: 'datetime'
				    ,range: true
			  });
		});
		lowerFrameData = table.render({
			elem:'#lowerFrameTab',
			id:'lowerFrameTabId',
			url:contextPath+'outBoundPlanManger/queryLowerFrame',
			cols:[[
			 	//{checkbox:true},
			 	{width: 100, align:'center', toolbar: '#toolbar',title:'操作',fixed:'left'},
			 	{type:'numbers',title:'序号',width: 60,fixed:'left'},
			 	{field:'warehouseCode', title: '仓库编码' , width:100,fixed:'left'},
				{field:'warehouseName', title: '仓库名称' , width:100,fixed:'left'},
			 	{field:'assembleOrderCode',width:120,title:'集配单据号',fixed:'left'},
			 	{field:'activeTime',width:120,title:'派工日期',fixed:'left'},
			 	{field:'enableRowsCount',width:120,title:'实际派工笔数',fixed:'left'},
			 	{field:'requiredRowsCount',width:120,title:'需配送笔数',fixed:'left'},
			 	{field:'productLine',width:120,title:'产品线',fixed:'left'},
			 	{field:'requiredType',width:120,title:'订单种类',fixed:'left'},
			 	{field:'carType',width:120,title:'车型车种'},
			 	{field:'carCode',width:120,title:'车号代码'},
			 	{field:'wbsCode',width:120,title:'WBS元素代码'},
			 	{field:'processOrderCode',width:120,title:'工序订单号'},
			 	{field:'processMaterialCode',width:120,title:'工序订单物料号'},
			 	{field:'processMaterialDesc',width:120,title:'工序订单物料描述'},
			 	{field:'subFactory',width:120,title:'分厂代码'},
			 	{field:'pipeLineCode',width:120,title:'产线代码'},
			 	{field:'stationCode',width:120,title:'工位代码'},
			 	{field:'requiredDate',width:120,title:'需求日期'},
			 	{field:'requiredTime',width:120,title:'需求时间'},
			 	{field:'stationOrderCode',width:120,title:'工位订单号'},
			 	{field:'stationMaterialCode',width:140,title:'工位订单物料号'},
			 	{field:'stationMaterialDesc',width:140,title:'工位订单物料描述'},
			 	{field:'orderCode',width:120,title:'订单号'},
			 	{field:'orderMaterialCode',width:120,title:'订单物料号'},
			 	{field:'orderMaterialDesc',width:120,title:'订单物料描述'}

			 ]],
			 page:{theme: '#008155'},
			 even:true,
			 title:'下架作业',
			 done:function(res){
				 /* $("[data-field='REQUIRED_TYPE']").children().each(function(){
						if($(this).text().trim()=="0"){
							$(this).text("节拍化");
						}else if ($(this).text().trim()=="1"){
							$(this).text("非节拍化");
						}
				 }); */
			 }
		});
		table.on('tool(lowerFrameTabF)', function(obj){
			var data = obj.data;
			deliveryCode = data.deliveryCode;
			orderCode = data.orderCode;
			assembleId = data.id;
			layer.open({
		        type: 2
		        ,title:'下架作业详细列表'
		        ,maxmin:false
		        ,area: ['100%', '100%']
		        ,id: 'lowerFrameDetail' //防止重复弹出
		        ,content: 'lowerFrameDetail.html'
		        ,shade: 0 //不显示遮罩
		        ,yes: function(){
		          layer.closeAll();
		        }
	     	 });
		});
		/* table.on('rowDouble(lowerFrameTabF)',function(obj){
			var data = obj.data;
			deliveryCode = data.DELIVERY_CODE;
			orderCode = data.ORDER_CODE;
			assembleId = data.ID;
			layer.open({
		        type: 2
		        ,title:'下架作业详细列表'
		        ,maxmin:false
		        ,area: ['100%', '100%']
		        ,id: 'lowerFrameDetail' //防止重复弹出
		        ,content: 'lowerFrameDetail.html'
		        ,shade: 0 //不显示遮罩
		        ,yes: function(){
		          layer.closeAll();
		        }
	     	 });
		}); */
		$('.layui-btn-container button').on('click', function(){
		    var othis = $(this), method = othis.data('method');
		    active[method] ? active[method].call(this, othis) : '';
	  	});

		initWarehouseMultiSelect("warehouseCode","select1","0",null);
	}







</script>
</body>
</html>
