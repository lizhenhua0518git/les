<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>不合格品出库</title>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/layui/lay/modules/tableFilter.js" charset="UTF-8"></script>
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/tableFilter.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<link rel="stylesheet" href="/iles/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
</head>
<body>
<div id="bodyDiv">

</div>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script type="text/html" id="bodyTpl" >
<div class="layui-fluid">
	<div class="layui-row layui-form">
			 <div class="layui-col-md3">
                 <label class="layui-form-label">仓库:</label>
                 <div class="layui-input-block">
					<select id="warehouseCode" xm-select="select1" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
                </div>
     		</div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">出库单号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="outOrderCode_search" class="layui-input">
			    </div>
			 </div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
				<div class="layui-btn-container" >
					{{# if(d.search==null || d.search=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
					{{# } }}
					{{# if(d.goDown==null || d.goDown=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm" id="goDown" data-method="goDown" type="button"><i class="layui-icon">&#xe61a;</i>下达</button>
					{{# } }}
				</div>
	</div>
	<table class="layui-hide" id="unqualifiedRecordTab" lay-filter="unqualifiedRecordTabF"></table>
</script>
<script type="text/html" id="barDemo">
		<a class="layui-btn layui-btn-xs" lay-event="edit">详情</a>
</script>
<script type="text/html" id="statusTpl">
    	{{# if(d.STATUS==0){ }}
			已创建
		{{# }else if(d.STATUS==1){ }}
			已下达
		{{# }else if(d.STATUS==2){ }}
			已完成
		{{# } }}
	</script>
	<script type="text/html" id="unqualifiedTpl">
   		{{# if(d.UNQUALIFIED_TYPE==1){ }}
			采购不合格
		{{# }else if(d.UNQUALIFIED_TYPE==2){ }}
			生产不合格
		{{# }else if(d.UNQUALIFIED_TYPE==3){ }}
			报废
		{{# } }}
	</script>
<script type="text/javascript">
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
	var contextPath = config.wmsConfig.contextPath;
	var oldData;
	var dictItems = null;//数据字典
	var active = {
			goDown:function(othis){
				layer.open({
			        type: 2
			        ,title:'任务下达'
			        ,maxmin:true
			        ,area: ['100%', '100%']
			        ,id: 'unqualifiedDetail' //防止重复弹出
			        ,content: 'unqualifiedGoDown.html'
			        ,shade: 0 //不显示遮罩
			        ,yes: function(){
			          oldData = null;
			          layer.closeAll();
			        }
		     	 });
			},search:function(othis){
				var outOrderCode = $('#outOrderCode_search');
				var orgCode = layui.formSelects.value('select1', 'valueStr');
				debugger;
			     //执行重载
			     table.reload('unqualifiedRecordTabId', {
			        where:{
			        	outOrderCode: outOrderCode.val(),
			        	orgCode:orgCode,
			        	status:1
			        }
			        ,page:{"curr":1}
			      });
			},reset:function(othis){
				$('#outOrderCode_search').val("");
				layui.formSelects.value('select1', []);
				form.render("select");
			}

	};
	function loadding(){
		table.render({
			elem:'#unqualifiedRecordTab',
			id:'unqualifiedRecordTabId',
			url:contextPath+'unqualifiedRemoved/queryUnqualifiedRecord',
			cols:[[
			{type:'checkbox'},
			{type:'numbers',title:'序号',width: 60},
			{field:'warehouseCode', title: '仓库编码' , width:100},
			{field:'warehouseName', title: '仓库名称' , width:100},
			{field:'outOrderCode',title:'出库单号'},
			{field:'unqualifiedType', title: '不合格类型',templet: '#unqualifiedTpl'},
			{field:'createDate', title: '创建日期'},
			{field:'createUid',title: '创建人'},
			{field:'status', title: '状态',templet: '#statusTpl'},
			{fixed: 'right', align:'center', toolbar: '#barDemo'}
			]],
			page: {theme: '#008155'},
	   		height: 'full-95',
	   		even:true
		});
		table.on('tool(unqualifiedRecordTabF)', function(obj){
			oldData = obj.data;
			layer.open({
		        type: 2
		        ,title:'不合格品详细'
		        ,maxmin:true
		        ,area: ['100%', '100%']
		        ,id: 'unqualifiedDetail' //防止重复弹出
		        ,content: '/iles/pages/wms/outBound/unqualifiedDetail.html'
		        ,shade: 0 //不显示遮罩
		        ,yes: function(){
		          layer.closeAll();
		        },cancel: function(index, layero){
			          oldData = null;
		        }
	     	 });
		});
		$('.layui-btn-container button').on('click', function(){
		    var othis = $(this), method = othis.data('method');
		    active[method] ? active[method].call(this, othis) : '';
	  	});
		initWarehouseMultiSelect("warehouseCode","select1","0",null);
	}





</script>
</body>
</html>
