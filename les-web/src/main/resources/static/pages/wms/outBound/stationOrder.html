<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css" type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css" type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<title>出库任务派发</title>
</head>
<body id="bodyDiv">
	<script type="text/html" id="bodyTpl">
    <div class="layui-fluid" >
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
                <label class="layui-form-label">任务编号</label>
                <div class="layui-input-inline">
                    <input type="text" id="orderCode" class="layui-input" placeholder="请输入出库任务号">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">货物名称</label>
                <div class="layui-input-inline">
                    <input type="text" id="materialDesc" class="layui-input" placeholder="请输入货物名称">
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">仓库编码</label>
                <div class="layui-input-inline">
                    <select  id="warehouseCode" lay-filter="storageLocationFilter" xm-select="warehouseCodeSelect" xm-select-show-count="1">
                        <option value="">请选择</option>
                    </select>
                </div>
            </div>
            <div class="layui-col-md2">
                <label class="layui-form-label">库位编码</label>
                <div class="layui-input-inline">
                    <input type="text" id="positionCode" class="layui-input" placeholder="请输入库位编码">
                </div>
            </div>
            <div class="layui-btn-container nav-" style="text-align: right;">
                {{# if(d.search==null || d.search=="true"){ }}
                <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
                <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon  layui-icon-reset"></i>重置</button>
                {{# } }}
            </div>
		</div>
<!--		<div class="layui-row layui-form">-->
<!--&lt;!&ndash;            <div class="layui-col-md2">&ndash;&gt;-->
<!--&lt;!&ndash;                <label class="layui-form-label">业务类型</label>&ndash;&gt;-->
<!--&lt;!&ndash;                <div class="layui-input-inline">&ndash;&gt;-->
<!--&lt;!&ndash;                    <select  id="busiType_search"  xm-select="busiTypeCodeSelect" xm-select-show-count="1">&ndash;&gt;-->
<!--&lt;!&ndash;                        <option value="">请选择</option>&ndash;&gt;-->
<!--&lt;!&ndash;                    </select>&ndash;&gt;-->
<!--&lt;!&ndash;                </div>&ndash;&gt;-->
<!--&lt;!&ndash;            </div>&ndash;&gt;-->

<!--		</div>-->
    </div>
    <div class="layui-fluid-table">
<!--        <div class="layui-row layui-form">-->
<!--            <div class="layui-btn-container">-->
<!--                <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="distributing" type="button"><i class="layui-icon layui-icon-edit"></i>任务派发</button>-->
<!--                <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="submit" type="button"><i class="layui-icon layui-icon-edit"></i>交接</button>-->
<!--            </div>-->
<!--        </div>-->
        <table class="layui-hide" id="stationOrderTab" lay-filter="stationOrderTabF"></table>
    </div>
</script>
	<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
	<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
    <script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
    <script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
    <script src="/iles/pages/js/common/clientManage.js" charset="UTF-8"></script>
	<script type="text/javascript">
		var element = layui.element;
		var layer = layui.layer;
		var table = layui.table;
		var form = layui.form;
		var laydate = layui.laydate;
		var oldData;
		var contextPath = config.omsConfig.contextPath;
		var active = {
			distributing : function(othis) {
                var checkStatus = table.checkStatus('stationOrderTabId');
                oldData = checkStatus.data;
                var idarrys = new Array();
                if(oldData.length <=0) {
                    layer.alert('请选择需要派发的订单！', {
                        icon: 2
                    });
                    return;
                }
                for(var i=0;i<oldData.length;i++){
                    idarrys.push(oldData[i].id);
                }
                var type = othis.data('type');
                layer.confirm('已选中'+oldData.length+'条数据，确认派发?', {icon: 3, title:'提示'}, function(index){
                    var option ={
                        url:contextPath+'stationOrder/taskStationOrder',
                        type:'POST',
                        contentType: "application/json",
                        dataType:'json',
                        data:JSON.stringify(idarrys),
                        success:function(data){
                            if(data.code==0){
                                layer.alert("任务下发成功,可以拣料了");
                            }else{
                                layer.alert("任务已下发失败");
                            }
                            table.reload('stationOrderTabId');
                        },error:function(data){
                            layer.alert(data.msg);
                        }
                    }
                    $.ajax(option);
                    layer.close(index);
                });
			},
			search : function(othis) {
				var orderCode = $('#orderCode').val();
                var materialDesc = $('#materialDesc').val();
                var warehouseCode = layui.formSelects.value('warehouseCodeSelect', 'valueStr');
                var positionCode = $('#positionCode').val();
				var params = {};
				params.orderCode = orderCode;
                params.materialDesc = materialDesc;
                params.warehouseCode = warehouseCode;
                params.positionCode = positionCode;
				//执行重载
				table.reload('stationOrderTabId', {
					where : params,
				});
			},
			reset : function(othis) {
				$('#materialDesc').val("");
				$('#orderCode').val("");
                layui.formSelects.value('warehouseCodeSelect', []);
				$('#positionCode').val("");
				form.render("select");
			},
            workshopCode_search:function(){
			    console.log("")
        }
		}
		function loadding() {
			table.render({
				elem : '#stationOrderTab',
				id : 'stationOrderTabId',
                url : contextPath + 'stationOrder/listStationOrder',
				cols : [ [
                    {type : 'numbers', title : '序号'},
                    {field : 'warehouseName', width:'120', title : '仓库名称',align:'center'},
                    {field : 'warehouseCode', width:'120', title : '仓库编码',align:'center'},
                    {field : 'clientName', width:'120', title : '客户名称',align:'center'},
                    {field : 'orderCode', width:'120', title : '任务编号',align:'center'},
                    {field : 'materialDesc', width:'120', title : '货物名称'},
                    {field : 'materialUnit', width:'120', title : '货物单位'},
                    {field : 'shipmentCount', width:'120', title : '下架数量'},
                    {field : 'positionCode', width:'120', title : '库位编码'},
                    {field : 'batchNo', width:'120', title : '批次号'},
                    {field : 'carrierCode', width:'120', title : '载具编号'},
                    {field : 'areaCode', width:'120', title : '区域编号'},
                    {field : 'stockStatus', width:'120', title : '库存类型', templet(d){
                        if(d.stockStatus == 0){
                            return '合格';
                        }else if(d.stockStatus == 1){
                            return '不合格';
                        }
                    }},
                    {field : 'shipmentStatus', width:'120', title : '下架状态', templet(d){
                        if(d.shipmentStatus == 0){
                            return '未下架';
                        }else if (d.shipmentStatus == 1) {
                            return '已下架';
                        }
                    }},
                    {field : 'createrTime', width:'120', title : '创建时间'}
                     ] ],
				page : {
					theme : '#008155'
				},
				even : true,
				done : function(res, page, count) {//列表数据回调函数
					form.render(null, "storageLocationSearchForm");
				}
			});
			$('.layui-btn-container button').on('click', function() {
				var othis = $(this), method = othis.data('method');
				active[method] ? active[method].call(this, othis) : '';
			});
			//时间选择器
			laydate.render({
				elem : '#requiredTime_search',
				type : 'date',
				range : true
			});

            initWarehouseMultiSelect("warehouseCode","warehouseCodeSelect","1",'');
            initClientManageList("clientManageSelect",[]);
		}
		//监听启用操作
		form.on('switch(statusValue)', function(obj) {
			var status = '0';
			if (obj.elem.checked) {
				status == '1';
			}
			updateStatus(this.value, status);
		});
	</script>
</body>
</html>
