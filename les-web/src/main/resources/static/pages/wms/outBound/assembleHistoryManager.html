<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta charset="UTF-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta http-equiv="Content-Type" content="charset=UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
<link rel="stylesheet" href="/iles/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<link rel="stylesheet" href="/iles/pages/layui/css/tableFilter.css"  type="text/css" />
<title>集配作业历史查询</title>
</head>
<body>
<div id="bodyDiv">

</div>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script src="/iles/pages/js/common/warehouseSelect.js"></script>
<script type="text/html" id="bodyTpl">
<div class="layui-fluid" style="margin-top:10px;">
	<div class="layui-row layui-form">
			<div class="layui-col-md3">
                 <label class="layui-form-label">仓库:</label>
                 <div class="layui-input-block">
					<select id="warehouseCode" xm-select="select1" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
                </div>
     		</div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">集配单号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="assembleCode" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">工序物料号:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="pmaterialCode" class="layui-input">
			    </div>
			 </div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">物料编码:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="materialCode" class="layui-input">
			    </div>
			 </div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md3">
			 	<label class="layui-form-label">派工日期:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="activeTime" class="layui-input" placeholder="yyyy-MM-dd">
			    </div>
			 </div>
			<div class="layui-col-md2">
				<label class="layui-form-label">工序订单号</label>
				 <div class="layui-input-block">
			      <input type="text" id="processOrderCode" class="layui-input">
			    </div>
			</div>
			 <div class="layui-col-md2">
			 	<label class="layui-form-label">需求日期:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="dateTime" class="layui-input" placeholder="yyyy-MM-dd">
			    </div>
			    &nbsp;
			 </div>
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0;padding-top: 7px;">
			<div class="layui-btn-container">
					{{# if(d.search==null || d.search=="true"){ }}
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
						<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
					{{# } }}
					<button class="layui-btn layui-btn-normal layui-btn-sm" onclick="openList()" type="button"><i class="mine-icon icon-print"></i>清单打印</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm" onclick="openLabel()" type="button"><i class="mine-icon icon-print"></i>货架标签打印</button>
					<button class="layui-btn layui-btn-normal layui-btn-sm" onclick="openStockLabel()" type="button"><i class="mine-icon icon-print"></i>地堆标签打印</button>
				</div>
		</div>
</div>
<table class="layui-hide" id="jpWorkTab" lay-filter="jpWorkTabF"></table>
</script>
<script type="text/html" id="toolbar">
	<a class="layui-btn layui-btn-xs" lay-event="detail">详情</a>
</script>
<script type="text/javascript">

var element = layui.element;
var layer = layui.layer;
var table = layui.table;
var laydate = layui.laydate;
var form = layui.form;
var contextPath = config.wmsConfig.contextPath;
var curDate = new Date();
curDate.setDate(curDate.getDate()+1);
var curDateStr = dateFtt("yyyy-MM-dd",curDate);
var lowerFrameData;

var assembleId="";
var deliveryCode="";
var orderCode="";


var active = {
	search:function(othis){
		var storageLocation = layui.formSelects.value('select1', 'storagelocationStr');
	      //执行重载
	      table.reload('jpWorkTabId', {
	        where:{
	        	activeStartTime:$('#activeTime').val().substring(0,20),
	        	activeEndTime:$('#activeTime').val().substring(22),
	        	requireStartTime:$('#dateTime').val().substring(0,10),
	        	requireEndTime:$('#dateTime').val().substring(13),
	        	assembleOrderCode: $('#assembleCode').val(),
	        	processMaterialCode:$('#pmaterialCode').val(),
	        	processMaterialDesc:$('#materialDesc').val(),
	        	processOrderCode:$('#processOrderCode').val(),
	        	materialCode:$('#materialCode').val(),
	        	storageLocation:storageLocation
	        }
	        ,page:{"curr":1}
	      });
	},reset:function(othis){
		$('#activeTime').val("");
		$('#dateTime').val("");
		$('#assembleCode').val("");
		$('#pmaterialCode').val("");
    	$('#materialDesc').val("");
    	$('#processOrderCode').val("");
    	$('#materialCode').val("");
    	layui.formSelects.value('select1', []);
	}
};
function loadding(){
	//日期范围
	layui.use('laydate', function(){
		var laydate = layui.laydate;
		//时间选择器
		  laydate.render({
		    elem: '#activeTime'
		    ,type: 'datetime'
		    ,range: true
		  });
		  laydate.render({
			    elem: '#dateTime'
			    ,type: 'date'
			    ,range: true
		  });
	});

	lowerFrameData = table.render({
		elem:'#jpWorkTab',
		id:'jpWorkTabId',
		url:contextPath+'outBoundPlanManger/listAssembleHistory',
		cols:[[
		 	{checkbox:true,fixed: 'left'},
		 	{width: 100, align:'center', toolbar: '#toolbar',title:'操作',fixed: 'left'},
		 	{type:'numbers',title:'序号',width: 60,fixed: 'left'},
		 	{field:'warehouseCode', title: '仓库编码' , width:100,fixed: 'left'},
			{field:'warehouseName', title: '仓库名称' , width:100,fixed: 'left'},
		 	{field:'subFactory',width:120,title:'分厂代码', fixed: 'left'},
		 	{field:'pipeLineCode',width:120,title:'产线代码', fixed: 'left'},
		 	{field:'stationCode',width:120,title:'工位代码', fixed: 'left'},
		 	{field:'assembleOrderCode',width:120,title:'集配单据号', fixed: 'left'},
		 	{field:'activeTime',width:120,title:'派工日期', fixed: 'left'},
		 	/* {field:'ENABLE_ROWS_COUNT',width:120,title:'实际派工行', fixed: 'left'}, */
		 	{field:'requiredRowsCount',width:120,title:'需配送行数'},
		 	{field:'productLine',width:120,title:'产品线'},
		 	{field:'orderBeat',width:120,title:'订单种类'},
		 	{field:'carType',width:120,title:'车型车种'},
		 	{field:'carCode',width:120,title:'车号代码'},
		 	{field:'wbsCode',width:120,title:'WBS元素代码'},
		 	{field:'processOrderCode',width:120,title:'工序订单号'},
		 	{field:'processMaterialCode',width:120,title:'工序订单物料号'},
		 	{field:'processMaterialDesc',width:120,title:'工序订单物料描述'},
		 	{field:'requiredDate',width:120,title:'需求日期'},
		 	{field:'requiredTime',width:120,title:'需求时间'},
		 	{field:'stationOrderCode',width:120,title:'工位订单号'},
		 	{field:'stationMaterialCode',width:140,title:'工位订单物料号'},
		 	{field:'stationMaterialDesc',width:140,title:'工位订单物料描述'},
		 	{field:'orderCode',width:120,title:'订单号'},
		 	{field:'orderMaterialCode',width:120,title:'订单物料号'},
		 	{field:'orderMaterialDesc',width:120,title:'订单物料描述', fixed: 'right'}
		 ]],
		 page:{theme: '#008155'},
		 where:{
			 requireStartTime:curDateStr,
			 requireEndTime:curDateStr
		 },
		 even:true,
		 title:'集配作业'
	});
	table.on('tool(jpWorkTabF)', function(obj){
		var data = obj.data;
		deliveryCode = data.deliveryCode;
		orderCode = data.orderCode;
		assembleId = data.id;
		layer.open({
	        type: 2
	        ,title:'集配作业详细列表'
	        ,maxmin:false
	        ,area: ['100%', '100%']
	        ,id: 'JPXQWorkDetail' //防止重复弹出
	        ,content: 'assembleHistoryDetail.html'
	        ,shade: 0 //不显示遮罩
	        ,yes: function(){
	          layer.closeAll();
	        }
	 	 });
	});
	/* table.on('rowDouble(jpWorkTabF)',function(obj){
		var data = obj.data;
		deliveryCode = data.DELIVERY_CODE;
		orderCode = data.ORDER_CODE;
		assembleId = data.ID;
		layer.open({
	        type: 2
	        ,title:'集配作业详细列表'
	        ,maxmin:false
	        ,area: ['100%', '100%']
	        ,id: 'JPXQWorkDetail' //防止重复弹出
	        ,content: 'assembleHistoryDetail.html'
	        ,shade: 0 //不显示遮罩
	        ,yes: function(){
	          layer.closeAll();
	        }
	 	 });
	}); */
	$('.layui-btn-container button').on('click', function(){
	    var othis = $(this), method = othis.data('method');
	    active[method] ? active[method].call(this, othis) : '';
	});
	initWarehouseMultiSelect("warehouseCode","select1","0",null);
}

function dateFtt(fmt,date)
{ //author: meizz
  var o = {
    "M+" : date.getMonth()+1,                 //月份
    "d+" : date.getDate(),                    //日
    "h+" : date.getHours(),                   //小时
    "m+" : date.getMinutes(),                 //分
    "s+" : date.getSeconds(),                 //秒
    "q+" : Math.floor((date.getMonth()+3)/3), //季度
    "S"  : date.getMilliseconds()             //毫秒
  };
  if(/(y+)/.test(fmt))
    fmt=fmt.replace(RegExp.$1, (date.getFullYear()+"").substr(4 - RegExp.$1.length));
  for(var k in o)
    if(new RegExp("("+ k +")").test(fmt))
  fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
  return fmt;
}
function openList(){
	layer.open({
	    type: 2
	    ,title:'集配清单打印'
	    ,maxmin:false
	    ,area: ['100%', '100%']
	    ,id: 'listPrint1' //防止重复弹出
	    ,content: 'assembleListPrint.html'
	    ,shade: 0 //不显示遮罩
	    ,yes: function(){
	      layer.closeAll();
	    }
	});
}

function openLabel(){
	layer.open({
	    type: 2
	    ,title:'货架标签打印'
	    ,maxmin:false
	    ,area: ['100%', '100%']
	    ,id: 'labelPrint1' //防止重复弹出
	    ,content: 'materialLablePrint.html'
	    ,shade: 0 //不显示遮罩
	    ,yes: function(){
	      layer.closeAll();
	    }
	});
}
function openStockLabel(){
	layer.open({
	    type: 2
	    ,title:'地堆标签打印'
	    ,maxmin:false
	    ,area: ['100%', '100%']
	    ,id: 'stockLabel' //防止重复弹出
	    ,content: 'stockMaterialLablePrint.html'
	    ,shade: 0 //不显示遮罩
	    ,yes: function(){
	      layer.closeAll();
	    }
	});
}


</script>

</body>
</html>
