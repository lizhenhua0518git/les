<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>调拨任务详情列表</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
</head>
<body>
<div id="bodyDiv">

</div>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>
<script type="text/html" id="bodyTpl">
<div class="layui-fluid">
	<div class="layui-row layui-form">
	   <div class="layui-col-md3">
	 	 <label class="layui-form-label">集配订单:</label>
	 	  <div class="layui-input-block">
	      	<input type="text" id="assembleOrderCode" class="layui-input">
	     </div>
	   </div>
	   <div class="layui-col-md3">
	 	 <label class="layui-form-label">物料号:</label>
	 	  <div class="layui-input-block">
	      	<input type="text" id="materialCode" class="layui-input">
	     </div>
	   </div>
		<div class="layui-col-md2">
			<div class="layui-btn-container" style="text-align: right;">
				{{# if(d.search==null || d.search=="true"){ }}
		           <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
		           <button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button>
	            {{# } }}
			</div>
		</div>
	</div>
</div>
<table class="" id="allocationTab" lay-filter="allocationTabF"></table>
</script>
<script type="text/javascript">
var table = layui.table;
var voucherCode = parent.voucherCode;//集配单主键
var contextPath = config.wmsConfig.contextPath;
function loadding(){
	table.render({
		elem:'#allocationTab',
		id:'allocationTabId',
		url:contextPath+'allocationOrder/queryMaterialList',
		cols:[[
			 {checkbox:true,fixed: 'left'}
			,{field:'voucherCode',title:'凭证号',width:120,fixed: 'left'}
			,{field:'voucherLineNum',title:'凭证行',width:80,fixed: 'left'}
			,{field:'assembleOrderCode',title:'集配单号',width:200,fixed: 'left'}
			,{field:'materialCode',title:'物料号',width:160,fixed: 'left'}
			,{field:'materialDesc',title:'物料描述',width:200}
			,{field:'requiredCount',title:'数量',width:80}
			,{field:'materialUnit',title:'单位',width:80}
			,{field:'factory',title:'发货工厂',width:90}
			,{field:'lgort',title:'发货地点',width:90}
			,{field:'bwart',title:'移动类型',width:90}
			,{field:'batchNum',title:'批次',width:80}
			,{field:'storageBinId',title:'下架仓位',width:160}
			,{field:'carCode',title:'配送载具',width:120}
			,{field:'dTime',title:'送达时间',width:120}
			,{field:'hTime',title:'交接时间',width:120}
			,{field:'jobNode',title:'出库状态',width:90}
			,{field:'umwrk',title:'收货工厂',width:90}
			,{field:'umlgo',title:'收货地点',width:90}
			,{field:'type',title:'任务类型',width:90}
			,{field:'passTime',title:'过账时间',width:90}
			,{field:'enableCount',title:'交货数量',width:90}
			,{field:'accountCount',title:'过账数量',width:90}
			,{field:'cNum',title:'差异数',width:90}
			,{field:'VOUCHER_NO',title:'过账凭证号',width:120}
			,{field:'VOUCHER_ITEM_NO',title:'过账凭证行',width:90}
			,{field:'INSPECT_BATCH_NO',title:'批次号',width:90}
			,{field:'JOB_NODE',title:'调拨状态',width:90}
		]],
		page: {theme: '#008155'},
		height: 'full-95',
		even:true,
		where:{
			 "voucherCode":voucherCode
		 }
		,done:function(res,page,count){//列表数据回调函数
			changeItemName(res.data);
		}
	});

	var active = {
			search:function(othis){
			      //执行重载
			      table.reload('allocationTabId', {
			        where:{
			        	voucherCode: voucherCode,
			        	assembleOrderCode: $('#assembleOrderCode').val(),
			        	materialCode: $('#materialCode').val()
			        },page:{"curr":1}
			      });
			},reset:function(othis){
				$('#assembleOrderCode').val("");
				$('#materialCode').val("");

			}
	};
	$('.layui-btn-container button').on('click', function(){
	    var othis = $(this), method = othis.data('method');
	    active[method] ? active[method].call(this, othis) : '';
	});
}
function changeItemName(data){
	//状态数据处理
	$("[data-field='JOB_NODE']").children().each(function(){
		if($(this).text().trim()=="07"){
			$(this).text("到货");
		}else if($(this).text().trim()=="08" || $(this).text().trim()=="09"){
			$(this).text("点收");
		}else if($(this).text().trim()=="10" || $(this).text().trim()=="12" ){
			$(this).text("审核");
		}
	});
}
</script>
</body>
</html>
