<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>收货物料监控</title>
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<title>收货物料监控</title>
<link
	href="/iles/pages/css/materialScheduleStatistics/css/bootstrap.css"
	rel="stylesheet" />
<link
	href="/iles/pages/css/materialScheduleStatistics/css/font-awesome.css"
	rel="stylesheet" />
<link href="/iles/pages/css/materialScheduleStatistics/css/main.css"
	rel="stylesheet" />
<link href="/iles/pages/css/materialScheduleStatistics/css/style.css"
	rel="stylesheet" />
<link href="/iles/pages/css/materialScheduleStatistics/css/card.css"
	rel="stylesheet" />
<link href="/iles/pages/css/materialScheduleStatistics/css/reset.css"
	rel="stylesheet" />
<link rel="stylesheet" href="${ctx}/pages/layui/css/layui.css"
	type="text/css" />
<link rel="stylesheet" href="${ctx}/pages/css/layui_extend.css"
	media="all">
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
<!-- JS Scripts-->
<!-- jQuery Js -->
<script
	src="/iles/pages/css/materialScheduleStatistics/js/jquery-1.10.2.js"></script>
<!-- Bootstrap Js -->
<script
	src="/iles/pages/css/materialScheduleStatistics/js/bootstrap.min.js"></script>
<!-- Metis Menu Js -->
<script
	src="/iles/pages/css/materialScheduleStatistics/js/jquery.metisMenu.js"></script>
<!-- Morris Chart Js -->
 

</head>
<style>
div#mws-sidebar-stitch, div#mws-sidebar-bg {
	position: absolute;
	top: 0;
	bottom: 0;
}

div#mws-sidebar-bg {
	left: 0;
	z-index: 0;
	width: 175px;
	background:
		url(/iles/pages/css/materialScheduleStatistics/img/mws-sidebar-bg.png);
}
</style>

</head>
<body>

			 
				

	<!-- <h1 style="text-align: center; margin: 30px 0">收货物料监控</h1> -->
	<!--========ROW==========-->
	<div class="row" style="margin-left: 100px">

		<div class="col-md-4 col-sm-12 col-xs-12">
			<div class="board">
				<div class="panel-1 panel-primary-1 green"  onclick="showTab(3);">
					<img src="/iles/pages/css/materialScheduleStatistics/img/xie.png"
						/ style="margin: 10px 0 0 60px">
					<div class="text_11">
						
						<span id="uploadKind" >物料笔数：--笔</span></br>
						<span id="uploadQty" style="display:none">物料数量：--</span>
					</div>
				</div>
			</div>
		</div>
		
		<div class="col-md-4 col-sm-12 col-xs-12">
			<div class="board">
				<div class="panel-1 panel-primary-1 blue"  onclick="showTab(1);" >
					<img src="/iles/pages/css/materialScheduleStatistics/img/dian.png"
						/ style="margin: 10px 0 0 60px">
					<div class="text_11">
						<span id="receiveKind" >物料笔数：--笔</span></br>
						<span id="receiveQty" style="display:none">物料数量：--</span>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4 col-sm-12 col-xs-12">
			<div class="board">
				<div class="panel-1 panel-primary-1 purple"  onclick="showTab(2);">
					<img src="/iles/pages/css/materialScheduleStatistics/img/jian.png"
						/ style="margin: 10px 0 0 60px">

					<div class="text_11">
						<span id="inspectKind" >物料笔数：--笔</span></br>
						<span id="inspectQty" style="display:none">物料数量：--</span>
					</div>
				
				</div>
			</div>
		</div>

	</div>
	<!--========END ROW==========-->


	<!--========ROW==========-->
	<div class="row">
  
			 
 <br>

<div class="layui-fluid">
		<div class="layui-row layui-form">
		 
		 	<div class="layui-col-md2">
			 	<label class="layui-form-label">工厂:</label>
			 	 <div class="layui-input-block">
			      <input type="text" id="subfactory" name="subfactory" class="layui-input">
			    </div>
			</div>
			
			<div class="layui-col-md2">
                <label class="layui-form-label">工位:</label>
                 <div class="layui-input-block">
                   <input type="text" id="station" name="station" class="layui-input">
                </div>
            </div>
            
		 	<div class="layui-col-md2">
                <label class="layui-form-label">物料号:</label>
                 <div class="layui-input-block">
                   <input type="text" id="materialCode" name="materialCode" class="layui-input">
                </div>
            </div>
		 
		 	<div class="layui-col-md2">
                <label class="layui-form-label" style="width:100px;">项目号:</label>
                 <div class="layui-input-block">
                   <input type="text" id="project" name="project" class="layui-input">
                </div>
            </div>
		 <div class="layui-col-md3">
                <label class="layui-form-label">库存地点:</label>
                 
               <div class="layui-input-block layui-form">
				<select  id="storageLocation" xm-select="select3" xm-select-show-count="1" xm-select-search="">
					<option value="">请选择</option>
				</select>
			</div>	
            </div>
            
             <div class="layui-col-md3">
                <label class="layui-form-label">仓库:</label>
                  
                <div class="layui-input-block layui-form">
				<select  id="warehouseName" xm-select="select4" xm-select-show-count="1" xm-select-search="">
					<option value="">请选择</option>
				</select>
                
            </div>
 			
	
		 
		
		 
			 
		</div>
		<div class="layui-row layui-form" style="margin-bottom: 0">
			<div class="layui-col-md6">&nbsp;</div>
			<div class="layui-col-md6">
				<div class="layui-btn-container" style="text-align: right;">

			     <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
			     <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="reset" type="button"><i class="layui-icon-reset"></i>重置</button> 
				 <button class="layui-btn layui-btn-normal layui-btn-sm" data-method="export" type="button"><i class="layui-icon layui-icon-export"></i>导出</button> 
				</div>
			</div>
		</div>
	</div>
	 
 	</div>
	
	



<table class="layui-hide" id="materialScheduleStatisticsTab"	lay-filter="materialScheduleStatisticsTabF"></table>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script type="text/html" id="indexTpl">
     {{d.LAY_TABLE_INDEX+1}}
   </script>
   
 <script type="text/html" id="uploadTpl">
  {{#  if(d.uploadQty >0 ){ }}
    <span class="  badge     " style="font-size:1.5em;background-color:#62badd; color:#FFFFFF;">{{ d.uploadQty }}</span>
  {{#  } else { }}
    {{  }}
  {{#  } }}
</script>

 <script type="text/html" id="receiveTpl">
  {{#  if(d.receiveQty >0){ }}
    <span class="badge      "  style="font-size:1.5em;background-color:#64e0ad; color:#FFFFFF;">{{ d.receiveQty }}</span>
  {{#  } else { }}
    {{  }}
  {{#  } }}
</script>


 <script type="text/html" id="inspectTpl">
  {{#  if(d.inspectQty >0){ }}
    <span class="  badge  "  style="font-size:1.5em;background-color:#52d1c1; color:#FFFFFF;" >{{ d.inspectQty }}</span>
  {{#  } else { }}
    {{   }}
  {{#  } }}
</script>





<script type="text/javascript">
layui.config({
    base: '/iles/pages/layui/lay/modules/' //此处路径请自行处理, 可以使用绝对路径
}).extend({
    formSelects: 'formSelects-v4'
});
var  qtyUrl ="/iles/warningLackMateria/qtyStatistics";

	 $.post(qtyUrl,function(data){	
	 	$('#uploadQty').html('物料数量:  '+data.data.uploadQty[0].uploadQty);
		$('#uploadKind').html('物料笔数:  '+data.data.uploadKind[0].uploadKind+'笔');
		$('#receiveQty').html('物料数量:  '+data.data.receiveQty[0].receiveQty);
		$('#receiveKind').html('物料笔数:  '+data.data.receiveKind[0].receiveKind+'笔');	
		$('#inspectQty').html('物料数量:  '+data.data.inspectQty[0].inspectQty);	
		$('#inspectKind').html('物料笔数:  '+data.data.inspectKind[0].inspectKind+'笔');
		},'json');
	    var requestTime ='';	 
layui.use(['form','table','layer','laydate','formSelects'],function(){ 	 
    var $ = layui.$;
    var element = layui.element;
    var layer = layui.layer;
    var table = layui.table;
   
    
    var form = layui.form;

    var oldData;
    initData();
    getStorageLocation();
    getWarehouse();
    var materialCodeList= getQueryVariable("materialCodeList");
    table.render({
        elem:'#materialScheduleStatisticsTab',
        id:'materialScheduleStatisticsTabId',
        url:'/iles/warningLackMateria/scheduleStatisticsUpload',
        where:{'materialCodeList':materialCodeList},
        cellMinWidth: 100,
        cols:[[
        {title: '序号',templet: '#indexTpl',width: 80},        
        {field:'stationCode',title:'工位' ,width: 100},
        {field:'materialCode',title:'物料号' ,width:200},
        {field:'materialDesc',title:'物料描述',width:250 },
        {field:'factory',title:'工厂' },
        {field:'project',title:'项目号' },
        {field:'uploadQty',templet: '#uploadTpl',title:'卸货数量' },
        {field:'materilUnit',title:'单位' },
        {field:'arrivalCode',title:'到货通知单号' },
        {field:'arrivalItemNo',title:'行项目号' },
        {field:'storageLocation' ,title:'库存地点'},
        {field:'wareHouseName',title:'库存名称'}

  
       
         ]],
        height: 'full-95',
        done:function(res,page,count){//列表数据回调函数
           
          
        }
    });
  
    
    var params={};
    params.qtyType="UPLOAD";
    
    //执行重载
    table.reload('materialScheduleStatisticsTabId', {
      where:params,
      page:{"curr":1}
    });

    var active = {
            
    		export:function(othis){
   			 var materialCode=$('#materialCode').val();
    			 var subfactory=$('#subfactory').val();
   			 var station=$('#station').val();
   			var warehouseName = "";
    		var warehouseNameArray = layui.formSelects.value('select4', 'val');
    		for(var i=0;i<warehouseNameArray.length;i++){
    			warehouseName +=warehouseNameArray[i]+","
    		}
    		if(warehouseName != ""){
    			warehouseName = warehouseName.substring(0,warehouseName.length-1);
    		}
    		
    		//库存地点
    		var storageLocation = "";
    		var storageLocationArray = layui.formSelects.value('select3', 'val');
    		for(var i=0;i<storageLocationArray.length;i++){
    			storageLocation += storageLocationArray[i]+","
    		}
    		if(storageLocation != ""){
    			storageLocation = storageLocation.substring(0,storageLocation.length-1);
    		}
				
				var params = "warehouseName="+warehouseName+"&storageLocation="+storageLocation+"&qtyType=UPLOAD&materialCode="+materialCode+"&subfactory="+subfactory+"&station="+station;
				window.open("${ctx}/warningLackMateria/exportExcel?"+params);
            
           },
            search:function(othis){
           
            	 var  qtyUrl ="/iles/warningLackMateria/qtyStatistics";
              	 $.post(qtyUrl,function(data){         			
         			$('#uploadQty').html('物料数量:  '+data.data.uploadQty[0].uploadQty);
         			$('#uploadKind').html('物料笔数:  '+data.data.uploadKind[0].uploadKind+'笔');
         			$('#receiveQty').html('物料数量:  '+data.data.receiveQty[0].receiveQty);
         			$('#receiveKind').html('物料笔数:  '+data.data.receiveKind[0].receiveKind+'笔');
         			$('#inspectQty').html('物料数量:  '+data.data.inspectQty[0].inspectQty);
         			$('#inspectKind').html('物料笔数:  '+data.data.inspectKind[0].inspectKind+'笔');       			
     		 
         		 },'json');
            			
              	 
               	  var materialCode=$('#materialCode').val();
                  var project=$('#project').val();
                  var subfactory=$('#subfactory').val();
                   var station=$('#station').val();
                 //仓库
             		var warehouseName = "";
             		var warehouseNameArray = layui.formSelects.value('select4', 'val');
             		for(var i=0;i<warehouseNameArray.length;i++){
             			warehouseName +=warehouseNameArray[i]+","
             		}
             		if(warehouseName != ""){
             			warehouseName = warehouseName.substring(0,warehouseName.length-1);
             		}
             		
             		//库存地点
             		var storageLocation = "";
             		var storageLocationArray = layui.formSelects.value('select3', 'val');
             		for(var i=0;i<storageLocationArray.length;i++){
             			storageLocation += storageLocationArray[i]+","
             		}
             		if(storageLocation != ""){
             			storageLocation = storageLocation.substring(0,storageLocation.length-1);
             		}
                  params.qtyType="UPLOAD";
                  params.materialCode=materialCode;
                  params.project=project;
                  params.subfactory=subfactory;
                  params.station=station;
                  params.storageLocation = storageLocation;
                  params.warehouseName = warehouseName;
                  
                     
                  //执行重载
                  table.reload('materialScheduleStatisticsTabId', {
                    where:params,
                    page:{"curr":1}
                  });
            },reset:function(othis){
                $('#materialCode').val("");
                $('#project').val("");
                $('#subfactory').val("");
                 $('#station').val("");
                 layui.formSelects.value('select3', []); 
          		layui.formSelects.value('select4', []); 
          		 form.render("select");
             
            }
            
    };
    $('.layui-btn-container button').on('click', function(){
        var othis = $(this), method = othis.data('method');
        active[method] ? active[method].call(this, othis) : '';
    });
    
    //初始化表单数据
	function initData(){
	    var oldData = parent.oldData;
	   
	    if(oldData && oldData.length>0){
	        var formData =  eval('('+JSON.stringify(oldData[0])+')');
	        requestTime =formData.requestTime;
	       
	    }
	}
    
    //获取父级页面传来的参数
    function getQueryVariable(variable)
	 {
	        var query = window.location.search.substring(1);
	        var vars = query.split("&");
	        for (var i=0;i<vars.length;i++) {
	                var pair = vars[i].split("=");
	                if(pair[0] == variable){
	                	return pair[1];
	                }
	        }
	        return(false);
	 }
    function getWarehouse(){//仓库
    	$.ajax({
    		url:"${ctx}/distributionTask/getUnStataionWarehouse",
    		type:"post",
    		success:function(result){
    			$('#warehouseName').html("");
    			$('#warehouseName').append('<option value="">请选择</option>');
          	  	var order = result.data;
    			if(order && order.length>0){
    			var optionItem;
    			var optoinArray = new Array();
    				for(var i=0;i<order.length;i++){
    				optionItem = {"name":""+order[i], "value":""+order[i]};
    				optoinArray.push(optionItem);
    				}
    				layui.formSelects.data('select4','local',{
    					arr:optoinArray
    				}); 
    			}
    		}
    	});
    }
  
    function getStorageLocation(){//库存地点
    	$.ajax({
    		url:"${ctx}/distributionTask/getUnStataionStorageLocation",
    		type:"post",
    		success:function(result){
    			$('#storageLocation').html("");
    			$('#storageLocation').append('<option value="">请选择</option>');
          	  	var order = result.data;
    			if(order && order.length>0){
    			var optionItem;
    			var optoinArray = new Array();
    				for(var i=0;i<order.length;i++){
    				optionItem = {"name":""+order[i], "value":""+order[i]};
    				optoinArray.push(optionItem);
    				}
    				layui.formSelects.data('select3','local',{
    					arr:optoinArray
    				}); 
    			}
    		}
    	});
    }
});
    
    function showTab(type){
	   	 var title="";
	   	 var dataId="";
	   	 var url="";
	   	 
	      var url_1 ="pages/mfc/warningLackMaterial/materialScheduleReceive.html?subfactory=%&station=%&requestTime="+requestTime;

	      var url_2 ="pages/mfc/warningLackMaterial/materialScheduleInspect.html?subfactory=%&station=%&requestTime="+requestTime;

	      var url_3 ="pages/mfc/warningLackMaterial/materialScheduleUpload.html?subfactory=%&station=%&requestTime="+requestTime;

	      
	   	if(type==1){
			 
			 title ='收货物料监控-点收';
			 dataId ="materialScheduleStatisticsTab_"+type; 
			 url=url_1
		 }else if(type==2){
			 title ='收货物料监控-质检';
			 dataId ="materialScheduleStatisticsTab_"+type; 
			 url=url_2
		 }else{
			 title ='收货物料监控-卸货';
			 dataId ="materialScheduleStatisticsTab_"+type;  
			 url=url_3
		 }
	   	
	   	 var isData = false;
	     var liObj =$("body", parent.document).find(".layui-tab-title li[lay-id]");
	     if(dataId && dataId.length>0){
	      $.each(liObj, function () {
	             if ($(this).attr("lay-id") == dataId) {
	                 isData = true;
	             }
	         })
	         if (isData == false) {
	         window.parent.active.tabAdd(url,dataId,title);
	         }
	      window.parent.active.tabChange(dataId);
	     }
	    }
	 
</script>










	<!--========END ROW==========-->




</body>
</html>
