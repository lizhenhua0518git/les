<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>到货通知单详情</title>
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" type="text/css" href="/iles/pages/css/layui_extend.css"/>
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
</head>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		<input type="text" id="transferBinId" hidden="true" />
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">货物名称</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" name="" id="materialDesc" placeholder="请输入货物名称">
				</div>
			</div>
			<div class="layui-btn-container nav-" style="text-align: right;">
				{{# if(d.search==null || d.search=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset"  id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
				{{# } }}
			</div>
		</div>
	</div>
	<div class="layui-fluid">
		<div class="layui-row layui-form">
			<div class="layui-btn-container">
				{{# if(d.add==null || d.add=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="add" data-type="auto" type="button"><i class="layui-icon  layui-icon-add-circle"></i>增加</button>
				{{# } }}
<!--				{{# if(d.edit==null || d.edit=="true"){ }}-->
<!--				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="edit" type="button"><i class="layui-icon layui-icon-edit"></i>修改</button>-->
<!--				{{# } }}-->
				{{# if(d.del==null || d.del=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="del" type="button"><i class="layui-icon layui-icon-delete"></i>删除</button>
				{{# } }}
			</div>
		</div>
	</div>
	<div class="layui-fluid-table">
		<table id="manageDetailId" lay-filter="manageDetailIdTabF"></table>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/urlParam.js" charset="UTF-8"></script>
<script type="text/html" id="indexTpl">
	{{d.LAY_TABLE_INDEX+1}}
</script>
<script type="text/javascript">
var layer = layui.layer;
var table = layui.table;
var form = layui.form;
var wmsContextPath = config.wmsConfig.contextPath;
var laydate = layui.laydate;
var arrivalNoticeId = '';
var paramsMap = UrlParam.paramMap();
if (paramsMap && paramsMap.arrivalNoticeId && paramsMap.arrivalNoticeId.length > 0) {
	arrivalNoticeId = paramsMap.arrivalNoticeId[0];
}
var active = {
	add:function(othis){
		$("#transferBinId").val(arrivalNoticeId);
		var type = othis.data('type');
		layer.open({
			type: 2
			,title:'新增送货单'
			,maxmin:true
			,area: ['800px', '450px']
			,offset: type
			,id: 'arriveManageAdd'+type //防止重复弹出
			,content: 'arriveManageAdd.html'
			,shade: 0 //不显示遮罩
			,yes: function(){
				layer.closeAll();
			}
		});
	},
	// edit:function(othis){
	// 	var checkStatus = table.checkStatus('arriveManageDetailId');
	// 	oldData = checkStatus.data;
	// 	if(oldData.length<=0){
	// 		layer.alert('请选择要编辑的行！',{icon: 2});
	// 		return ;
	// 	}else if(oldData.length >1){
	// 		layer.alert('编辑不能超过多行！',{icon: 2});
	// 		return ;
	// 	}
	// 	var idarrys = new Array();
	// 	for(var i=0;i<oldData.length;i++){
	// 		idarrys.push(oldData[i].arrivalNoticeId);
	// 	}
	// 	layer.confirm('确定删除该条资源信息?', {icon: 3, title:'提示'}, function(index){
	// 		//do something
	// 		var option ={
	// 			url:wmsContextPath+'arrivalPC/issueArriveNotice',
	// 			type:'POST',
	// 			contentType: "application/json",
	// 			dataType:'json',
	// 			data:JSON.stringify(idarrys),
	// 			success:function(data){
	// 				if(data.code==0){
	// 					layer.alert("删除成功");
	// 				}
	// 			},error:function(data){
	// 				layer.alert(data.msg);
	// 			}
	// 		}
	// 		$.ajax(option);
	// 		layer.close(index);
	// 	});
	// },
	del:function(othis){
		var checkStatus = table.checkStatus('arriveManageDetailId');
		oldData = checkStatus.data;
		if(oldData.length<=0){
			layer.alert('请选择要删除的行！',{icon: 2});
			return ;
		}
		var idarrys = new Array();
		for(var i=0;i<oldData.length;i++){
			idarrys.push(oldData[i].arrivalDetailId);
		}
		layer.confirm('确定删除该条资源信息?', {icon: 3, title:'提示'}, function(index){
			//do something
			var option ={
				url:wmsContextPath+'arrivalPC/deleteArriveDetail',
				type:'POST',
				contentType: "application/json",
				dataType:'json',
				data:JSON.stringify(idarrys),
				success:function(data){
					if(data.code==0){
						layer.alert("删除成功");
						table.reload('arriveManageDetailId');
					}
				},error:function(data){
					layer.alert(data.msg);
				}
			}
			$.ajax(option);
			layer.close(index);
		});
	},
    search:function(othis){
		var  materialDesc = $('#materialDesc').val();//物料号
        table.reload('arriveManageDetailId', {
            where:{
                materialDesc:materialDesc
            }
        });
    },
	reset:function(othis){
		$('#materialDesc').val("");//物料号
		form.render("select");
    }
};

function loadding() {
    table.render({
        elem:'#manageDetailId',
        id:'arriveManageDetailId',
        url:wmsContextPath+'arrivalPC/arrivalNoticeDetailList',
        cols:[[
			{type: 'checkbox'},
            {type:'numbers',title:'序号',width: 150},
            {field: 'arrivalCode', title: '收货任务号', width: 300,align:'center'},
			{field: 'clientName', title: '客户名称', width: 300,align:'center'},
            {field: 'materialDesc', title: '物料名称', width: 300,align:'center'},
            {field: 'arrivalCount', title: '到货数量', width: 200,align:'center'},
            {field: 'materialUnit', title: '单位', width: 200,align:'center'},
			{field: 'createTime', title: '创建时间', width: 200,align:'center'}
        ]],
        page: {theme: '#008155'},
        where: {
			arrivalNoticeId:arrivalNoticeId
        },
        title:'到货通知单详情',
        height: 'full-95',
        even:true,
        done:function(res,curr,count){

        }
    });

	table.on('tool(manageDetailIdTabF)', function(obj){
		var eventName = obj.event;
		var clickObj =obj.data;
		if(eventName=="update"){
			console.log("clickObj",clickObj);
			let object = {
				id: clickObj.id,
				produceBatchNo: clickObj.produceBatchNo,
				produceTime: clickObj.produceTime
			}
			var option = {
				url:wmsContextPath+'arrivalPC/updateArrivalNoticeDetail',
				type: 'POST',
				contentType: "application/json",
				dataType: 'json',
				data: JSON.stringify(object),
				success: function (data) {
					if (data.code == 0) {
						layer.alert("修改成功");
					}else {
						layer.alert("修改失败");
					}
				}, error: function (data) {
					layer.alert(data.msg);
				}
			}
			$.ajax(option);
		}
	});

	$('.layui-btn-container button').on('click', function(){
		var othis = $(this), method = othis.data('method');
		active[method] ? active[method].call(this, othis) : '';
	});
    //日期控件
    laydate.render({
        elem:"#createTime",
        type: 'date',
        trigger: 'click',
        range: true
    });
    form.render();
}
</script>
</html>
