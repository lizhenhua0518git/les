<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>入库接口主表</title>
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" type="text/css" href="/iles/pages/css/layui_extend.css"/>
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
</head>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">物料编码</label>
				<div class="layui-input-block layui-form">
					<input type="text" class="layui-input" name="" id="materialCode" placeholder="请输入物料编码">
				</div>
			</div>
			<div class="layui-btn-container nav-" style="text-align: right;">
				{{# if(d.search==null || d.search=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset"  id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
				{{# } }}
			</div>
		</div>
	</div>
<div class="layui-fluid-table">
	<table id="apiReceiveTaskJd" lay-filter="apiReceiveTaskTabF"></table>
</div>
</script>
<script src="/iles/pages/layui/layui.all.js"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script type="text/html" id="indexTpl">
	{{d.LAY_TABLE_INDEX+1}}
</script>
<script type="text/javascript">
var layer = layui.layer;
var table = layui.table;
var form = layui.form;
var taskId = parent.$("#taskId").val();
var wmsContextPath = config.wmsConfig.contextPath;
var laydate = layui.laydate;
var active = {
    search:function(othis){
		var  materialCode = $('#materialCode').val();//物料号
        table.reload('apiReceiveTaskJd', {
            where:{
				materialCode:materialCode
            }
        });
    },reset:function(othis){
		$('#materialCode').val("");//物料号
    }
};


function loadding() {
    table.render({
        elem:'#apiReceiveTaskJd',
        id:'apiReceiveTaskJd',
        url:wmsContextPath+'accountResult/listApiReceiveTask',
        cols:[[
            {type:'numbers',title:'序号',width: 100},
            {field: 'bldat', title: '凭证中的凭证日期', width: 100,edit:'text'},
            {field: 'budat', title: '凭证中的过账日期', width: 100,edit:'text'},
			{field: 'matnr', title: '物料号', width: 100},
			{field: 'zdonr', title: '来源单据号', width: 100},
			{field: 'zeile', title: '行项目号', width: 100},
			{field: 'sapZdonr', title: '采购订单号', width: 100},
            {field: 'ebelp', title: '采购订单行项目', width: 100},
            {field: 'lfbnr', title: '参考凭证', width: 100,edit:'text'},
            {field: 'lfpos', title: '参考凭证项目', width: 100,edit:'text'},
            {field: 'menge', title: '数量', width: 100},
            {field: 'meins', title: '单位', width: 100},
            {field: 'werks', title: '工厂', width: 100},
            {field: 'lgort', title: '库存地点', width: 100,edit:'text'},
            {field: 'sobkz', title: '特殊库存', width: 100},
            {field: 'kdauf', title: '销售订单', width: 100,edit:'text'},
			{field: 'kdpos', title: '销售订单行', width: 100,edit:'text'},
			{field: 'createTime', title: '创建时间', width: 100},
			{align:'center',title: '操作',toolbar:'#toolBar',width:150,fixed: 'right'}
        ]],
        page: {theme: '#008155'},
        where: {
			receiveTaskId:taskId
        },
        title:'当日出库作业进度',
        height: 'full-95',
        even:true,
        done:function(res,curr,count){

        }
    });

	table.on('tool(apiReceiveTaskTabF)', function(obj){
		var eventName = obj.event;
		var clickObj =obj.data;
		if(eventName=="update"){
			console.log("clickObj",clickObj);
			let object = {
				bldat: clickObj.bldat,
				budat: clickObj.budat,
				lfbnr: clickObj.lfbnr,
				lfpos: clickObj.lfpos,
				lgort: clickObj.lgort,
				kdauf: clickObj.kdauf,
				kdpos: clickObj.kdpos,
				taskDetailId: clickObj.taskDetailId,
				taskId:clickObj.taskId
			}
			var option = {
				url: wmsContextPath+'accountResult/updateApiReceiveTask',
				type: 'POST',
				contentType: "application/json",
				dataType: 'json',
				data: JSON.stringify(object),
				success: function (data) {
					if (data.code == 0) {
						layer.alert("修改成功");
					}
				}, error: function (data) {
					layer.alert(data.msg);
				}
			}
			$.ajax(option);
		}
	});

	$('.layui-btn-container button').on('click', function(){
		var othis = $(this), method = othis.data('method');
		active[method] ? active[method].call(this, othis) : '';
	});
}
</script>
<script type="text/html" id="toolBar">
	<a class="layui-btn layui-btn-xs" lay-event="update">修改</a>
</script>
</html>
