<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
<link rel="stylesheet" type="text/css" href="/iles/pages/css/layui_extend.css"/>
<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
	<title>到货通知单管理</title>
</head>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-fluid">
		<input type="text" id="transferBinId" hidden="true" />
		<div class="layui-row layui-form">
			<div class="layui-col-md2">
				<label class="layui-form-label">仓库名称</label>
				<div class="layui-input-inline">
					<select id="warehouseCode" xm-select="warehouseCodeSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">收货任务号</label>
				<div class="layui-input-inline">
					<input type="text" id="arrivalCode" class="layui-input">
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">客户名称</label>
				<div class="layui-input-inline">
					<select id="clientName" xm-select="clientManageSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">单据类型</label>
				<div class="layui-input-inline">
					<select id="billName" xm-select="billNameSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">收货状态</label>
				<div class="layui-input-inline">
					<select id="receivedStatus" xm-select="receivedStatusSelect" xm-select-show-count="1">
						<option value="">请选择</option>
						<option value="0">待收货</option>
						<option value="1">收货中</option>
						<option value="2">收货完成</option>
					</select>
				</div>
			</div>
			<div class="layui-col-md2">
				<label class="layui-form-label">上架状态</label>
				<div class="layui-input-inline">
					<select id="upperStatus" xm-select="upperStatusSelect" xm-select-show-count="1">
						<option value="">请选择</option>
						<option value="0">待上架</option>
						<option value="1">上架中</option>
						<option value="2">上架完成</option>
					</select>
				</div>
			</div>
<!--			<div class="layui-col-md2">-->
<!--				<label class="layui-form-label">创建时间</label>-->
<!--				<div class="layui-input-inline layui-form">-->
<!--					<input type="text" class="layui-input" name="" id="createTime" placeholder="请选择创建时间">-->
<!--				</div>-->
<!--			</div>-->
			<div class="layui-btn-container nav-" style="text-align: right;">
				{{# if(d.search==null || d.search=="true"){ }}
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
				<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset"  id="reset" type="button"><i class="layui-icon layui-icon-reset"></i>重置</button>
				{{# } }}
			</div>
		</div>
	</div>
	<div class="layui-fluid-table">
		<table id="arrivalNoticeTab" lay-filter="arrivalNoticeTabF"></table>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/warehouseSelect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/clientManage.js" charset="UTF-8"></script>
<script type="text/html" id="indexTpl">
	{{d.LAY_TABLE_INDEX+1}}
</script>
<script type="text/javascript">
    var wmsContextPath = config.wmsConfig.contextPath;
	var table = layui.table;
	var form= layui.form;
    var laydate = layui.laydate;
    var active = {
        search: function (othis) {
			var warehouseCode = layui.formSelects.value('warehouseCodeSelect', 'valueStr');//仓库编号
			var  arrivalCode = $('#arrivalCode').val();//送货单号
			var clientName = layui.formSelects.value('clientManageSelect', 'valueStr');//客户名称
			var billName = layui.formSelects.value('billNameSelect', 'valueStr');//单据类型
			var  receivedStatus = $('#receivedStatus').val();//收货状态
			var  upperStatus = $('#upperStatus').val();//上架状态
			var  createTime = $('#createTime').val();//创建时间
            //执行重载
            table.reload('arrivalNoticeTabId', {
                where: {
					warehouseCode: warehouseCode,
					arrivalCode:arrivalCode,
					clientName:clientName,
					billName:billName,
					receivedStatus:receivedStatus,
					upperStatus:upperStatus,
					createStr:createTime
                },
                page: {"curr": 1}
            });
        },
        reset: function (othis) {
        	$('#arrivalCode').val("");//送货单号
			$('#receivedStatus').val("");//收货状态
			$('#upperStatus').val("");//上架状态
			$('#createTime').val("");//创建时间
			layui.formSelects.value('warehouseCodeSelect', []);//仓库编号
			layui.formSelects.value('clientManageSelect', []);//客户名称
			layui.formSelects.value('billNameSelect', []);//单据类型
			form.render("select");
        },
		check:function(othis){
			var checkStatus = table.checkStatus('arrivalNoticeTabId');
			oldData = checkStatus.data;
			if(oldData.length<=0){
				layer.alert('请选择要查看的行！',{icon: 2});
				return ;
			}else if(oldData.length >1){
				layer.alert('查看不能超过多行！',{icon: 2});
				return ;
			}
			var transferBinId =oldData[0].arrivalNoticeId;
			//方便子页面取值
			$("#transferBinId").val(transferBinId);
			var type = othis.data('type');
			layer.open({
				type: 2
				,title:'送货单详情'
				,maxmin:true
				,area: ['1650px', '700px']
				,offset: type
				,id: 'appUserInfo'+type //防止重复弹出
				,content: 'thisDayDeliverWork.html'
				,shade: 0 //不显示遮罩
				,yes: function(){
					layer.closeAll();
				}
			});
		}
    };
	function loadding() {
		table.render({
			elem: '#arrivalNoticeTab',
			id: 'arrivalNoticeTabId',
			url: wmsContextPath + 'arrivalPC/arrivalList',
			cols: [[
				{type:'numbers',title:'序号',fixed: 'left'},
				{field: 'arrivalCode', width: 200, title: '收货任务号',fixed: 'left',align:'center'},
				{field: 'warehouseCode', width: 150, title: '仓库编码',align:'center'},
				{field: 'warehouseName', width: 150, title: '仓库名称',align:'center'},
				{field: 'billName', width: 150, title: '单据类型名称',align:'center'},
				{field: 'clientName', width: 200, title: '客户名称',align:'center'},
				{field: 'receivedName', width: 130, title: '收货状态',align:'center'},
				{field: 'upperName', width: 130, title: '上架状态',align:'center'},
				{field: 'responsible', width: 150, title: '经办人',align:'center'},
				{field: 'carCode', width: 150, title: '车牌号',align:'center'},
				{field: 'arrivalTime', width: 150, title: '到货时间',align:'center'},
				{field: 'createTime', width: 150, title: '创建时间',align:'center'},
				{align:'center',title: '操作',toolbar:'#toolBar',width:100,fixed: 'right'}
			]],
			page: {theme: '#008155'},
			height: 'full-95',
			even: true,
			done: function (res, page, count) {//列表数据回调函数

			}
		});

		//监听工具条
		table.on('tool(arrivalNoticeTabF)', function(obj){
			var eventName = obj.event;
			var clickObj =obj.data;
			if(eventName=="detail"){	//详情
				var transferBinId =clickObj.arrivalNoticeId;
				//方便子页面取值
				$("#transferBinId").val(transferBinId);
				layer.open({
					type: 2
					,title:'送货单详情'
					,maxmin:true
					,area: ['1650px', '700px']
					,offset: 2
					,id: 'appUserInfo'+2 //防止重复弹出
					,content: 'thisDayDeliverWork.html'
					,shade: [0.8, '#fff'] //显示遮罩
					,yes: function(){
						layer.closeAll();
					}
				});
			}
		});
		$('.layui-btn-container button').on('click', function () {
			var othis = $(this), method = othis.data('method');
			active[method] ? active[method].call(this, othis) : '';
		});
		//时间选择器
		laydate.render({
			elem: '#createTime'
			,type: 'date'
		   ,trigger: 'click'
			,range: true
		});
		initWarehouseMultiSelect("warehouseCode","warehouseCodeSelect","1",'');
		initDictItemList("billNameSelect",[],'receive_document_type');
		initClientManageList("clientManageSelect",[]);
		form.render();
	}
</script>
<script type="text/html" id="toolBar">
	<a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
</script>
</html>
