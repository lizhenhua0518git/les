<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link rel="stylesheet" href="/iles/pages/layui/css/layui.css" type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/css/layui_extend.css" type="text/css"/>
    <link rel="stylesheet" href="/iles/pages/css/style.min.css">
    <title>质检入库冲销</title>
</head>
<body>
<div class="layui-container" style="padding-top: 20px;">
    <form class="layui-form" action="">

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">冲销理由</label>
                <div class="layui-input-block">
                    <textarea placeholder="请输入冲销理由" class="layui-textarea" name="writeOffReason" lay-verify="writeOffReason"></textarea>
                </div>
            </div>
        </div>
         <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">冲销数量</label>
                <div class="layui-input-block">
                      <input type="text" id="writeOffNum" class="layui-input" placeholder="输入冲销数量">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <input id="detailId" name="detailId" value="" type="hidden">
                <button class="layui-btn" lay-submit="" lay-filter="writeOffSubit">提交</button>
                <button class="layui-btn layui-btn-normal layui-btn-sm"   id="cancelButton">取消</button>
            </div>
        </div>
    </form>
</div>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/jstree.min.js"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js"></script>

<script type="text/javascript">
    var contextPath = config.basicInfoConfig.contextPath;
    var element = layui.element;
    var layer = layui.layer;
    var oldData = parent.oldData;
    document.getElementById("detailId").value=oldData[0].detailId;
    
    var qualifiedNum =oldData[0].qualifiedNum;
    var contextPath = config.wmsConfig.contextPath;
    var form = layui.form;
    form.verify({
        writeOffReason: function (value) {
            if (value.length < 1) {
                return '冲销理由不能为空';
            }
            if (value.length > 256) {
                return '冲销理由不能超过256个字符';
            }
        },
    
    writeOffNum: function (value) {
        if (value.length < 1) {
            return '冲销数量不能为空';
        }
        if (!isNumber(value)) {
            return '冲销数量为正数且最多保留2位有效小数点';
        }
        
        if (value>qualifiedNum) {
            return '冲销数量不能大于质检合格数量';
        }
        
        
    }
    });
    
    function isNumber(value) {         //正数且保留2位有效小数点
	    var patrn =  /^\+?(\d*\.\d{2})$/;
	      if (patrn.exec(value) == null || value == "") {
	          return false
	      } else {
	         return true
	     }
	  }

    //监听提交
    form.on('submit(writeOffSubit)', function (data) {

        var option = {
            url: contextPath + 'receiveDetialRecord/saveAndDeleteReceiveDetialRecord',
            data: JSON.stringify(data.field),
            type: 'POST',
            contentType: 'application/json',
            success: function (data) {
                if (data.code == 0) {
                    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);  // 关闭layer
                    parent.table.reload('inspectRecordTabId');
                    layer.msg(data.msg);
                }
            }, error: function (data) {
                layer.alert(data.msg);
            }
        }
        $.ajax(option);
        return false;
    });
    $("#cancelButton").click(function(){
        cancel();
    });

    //取消按钮
    function cancel() {
        var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
        parent.layer.close(index);  // 关闭layer
        parent.table.reload();
    }
</script>
</body>
</html>