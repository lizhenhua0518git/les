<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="charset=UTF-8">
	<meta name="viewport"
		  content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="stylesheet" href="/iles/pages/layui/css/layui.css"  type="text/css" />
	<link rel="stylesheet" href="/iles/pages/css/layui_extend.css"  media="all">
	<link rel="stylesheet" href="/iles/pages/layui/css/modules/layer/default/layer.css"  type="text/css" />
	<link rel="stylesheet" href="/iles/pages/layui/css/formSelects-v4.css" />
	<style type="text/css">
		.layui-form-label2{float: left;display: block;padding: 5px 10px;width: 90px;font-weight: 400;line-height: 20px;text-align: right;}
		.layui-layer-content-new{background: linear-gradient(#001a47,#022558);}
	</style>
	<title>排号卸货任务</title>
</head>
<div id="bodyDiv">

</div>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script src="/iles/pages/js/common/dictSelelct.js" charset="UTF-8"></script>

<script type="text/html" id="bodyTpl">
	<input type="hidden" id="totalNum"/>
	<input type="hidden" id="receiveId"/>
	<input type="hidden" id="arrivalId"/>
	<input type="hidden" id="img">
	<div class="layui-fluid">
		<div class="layui-row layui-form">

			<div class="layui-col-md2">
                <label class="layui-form-label">送货单号</label>
                <div class="layui-input-inline">
                    <input type="text" id="arrivalCode" class="layui-input" placeholder="请输入送货单号">
                </div>
            </div>
			<div class="layui-col-md2">
				<label class="layui-form-label">单据类型</label>
				<div class="layui-input-inline">
					<select id="billName" xm-select="billNameSelect" xm-select-show-count="1">
						<option value="">请选择</option>
					</select>
				</div>
			</div>

			<div class="layui-col-md2">
			 	<label class="layui-form-label">排号状态</label>
			 	 <div class="layui-input-inline">
			        <select  id="status_search" xm-select="statusSelect" xm-select-show-count="1">
			        	<option value="">请选择</option>
						<option value="0">已经排号</option>
						<option value="1">已经叫号</option>
						<option value="2">已经过号</option>
						<option value="3">已经取消</option>
						<option value="4">卸货完成</option>

			      	</select>
			    </div>
			</div>
			<div class="layui-col-md2">
                <label class="layui-form-label">卸货月台</label>
                <div class="layui-input-inline">
                    <input type="text" id="uplodPlat_search" class="layui-input" placeholder="请输入卸货月台">
                </div>
            </div>

			 <div class="layui-btn-container nav-" style="text-align: right;">
					{{# if(d.search==null || d.search=="true"){ }}
             	 		<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="search" id="search" type="button"><i class="layui-icon layui-icon-search"></i>查询</button>
              			<button class="layui-btn layui-btn-normal layui-btn-sm"  data-method="reset" id="reset" type="button"><i class="layui-icon  layui-icon-reset"></i>重置</button>
              		{{# } }}
			</div>
		</div>
	</div>
	<table id="scheduleTab" lay-filter="scheduleTabF"></table>

</script>


<script type="text/javascript">
	var contextPath = config.basicInfoConfig.contextPath;
	var wmsContextPath = config.wmsoptConfig.contextPath;
	var layer = layui.layer;
	var table = layui.table;
	var form= layui.form;
	var laydate = layui.laydate;
	var $ = layui.$;
	var oldData;//用于查看详情时传递参数
	var active = {
		search:function(othis){
			var arrivalCode = $('#arrivalCode').val();

			var billType = layui.formSelects.value('billNameSelect', 'valueStr');

			var createTime = $('#createTime_search').val();
			var status = layui.formSelects.value('statusSelect', 'valueStr');
			var uplodPlatCode = $('#uplodPlat_search').val();

			//执行重载
			table.reload('scheduleTabId', {
				where:{
					arrivalCode:arrivalCode,
					billType:billType,
					createTimeStr:createTime,
					statusStr: status,
					uplodPlatCode:uplodPlatCode

				},
				page : {
					"curr" : 1
				}
			});
		},
		reset:function(othis){

			$('#arrivalCode').val("");

			layui.formSelects.value('billNameSelect', []);

			$('#createTime_search').val('');
			layui.formSelects.value('statusSelect', []);
			$('#uplodPlat_search').val("");

			form.render("select");
		}

	};
	var oldData;



	function loadding() {
		table.render({
			elem:'#scheduleTab',
			id:'scheduleTabId',
			url:wmsContextPath+'lineUpPc/listLineUpInfo',
			cols: [[

				{type:'numbers',title:'序号',width: 60},
				{field:'arrivalCode',title: '送货单号'},
				{field:'billName',title: '单据类型'},
				{field:'shipperName',title: '送货方'},
				{field:'createTime',title: '送货日期',templet(d){
					if(d.createTime){
						return d.createTime.substring(0,10);
					}else{
						return '-';
					}
				}},
				{field:'queueCode', title: '排队号'},
				{field:'carCode', title: '车牌号'},
				{field:'uploadPlatCode', title: '卸货月台'},
				{field:'inFactoryTime', title: '入厂时间'},
				{field:'outFactoryTime', title: '出厂时间'},
				{field:'totalTime', title: '总计时间'},
				{field:'status', title: '状态',width:90,templet(d){
					if(d.status=='0'){
							return '已排号';
					}else if(d.status=='1'){
						return '已经叫号';
					}else if(d.status=='2'){
						return '已经过号';
					}else if(d.status=='3'){
						return '取消排号 ';
					}else if(d.status=='4') {
						return '卸货完成 ';
					}else{
						return '-';
					}

				 }},
				{fixed:'right',align:'center',title: '操作',toolbar:'#toolBar',width:300},

			]],
			page: {theme: '#008155'},
			height: 'full-110',
			even:true,
			done:function(res,page,count){//列表数据回调函数
			// 	$("#totalNum").val(res.count);	//数据总条数
			// 	//状态/紧急状态 select
			// 	var dictType = new Array();
			// 	dictType.push("queue_Unload_State");
			//
			// 	var option={
			// 		url:contextPath + 'dictItems/listDictItemByTypes',
			// 		type:'POST',
			// 		dataType:'json',
			// 		contentType: "application/json",
			// 		data:JSON.stringify(dictType),
			// 		success:function(res){
			// 			if(res.code==0){
			// 				dictItems = res.data
			// 				changeItemName(res.data);
			// 				defaultSelect(dictItems);
			// 			}
			// 		}
			// 	};
			// 	$.ajax(option);
			}
		});
		//监听工具条
		table.on('tool(scheduleTabF)', function(obj){
			var eventName = obj.event;			//事件名称
			var clickObj = $(obj.tr[0]);		//当前对象tr
			if(eventName=="detail"){	//详情
				$("#receiveId").val(obj.data.id);			//方便子页面取到排号卸货的Id
				$("#arrivalId").val(obj.data.arrivalId);	//方便子页面取到货通知单的Id
				oldData=obj.data;
				layer.open({
					type: 2,
					title:'排号卸货任务详情',
					maxmin:true,
					area: ['100%', '100%'],
					id: 'queueUnloadScheduleDetail', //防止重复弹出
					content: '/iles/pages/wms/inbound/queueUnloadScheduleDetail.html',
					shade: 0, //不显示遮罩
					yes: function(){
						layer.closeAll();
					}
				});
			}
		});
		$('.layui-btn-container button').on('click', function(){
			var othis = $(this), method = othis.data('method');
			active[method] ? active[method].call(this, othis) : '';
		});
		//时间选择器
		laydate.render({
			elem: '#createTime_search',
			type: 'date',
			range: true
		});

		initBillTypeMultiSelect2("billNameSelect",[],'0,2');

		form.render();
	}


</script>

<script type="text/html" id="toolBar">
	<a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
</script>
<div id="helpDocDiv" style="display:none">
	<div class="layui-col-md12">
		<div class="layui-card" style="background: linear-gradient(#001a47,#022558);">
			<div class="layui-card-header" style="color: #c0dcfe;border-bottom: 1px solid #2a69c7;font-size: 22px;padding-top: 22px;"></div>
			<div class="layui-card-body"  style="border-bottom: 1px solid #2a69c7;color: #c0dcfe;">
				<p>查询节点在已经排号成功到未开始点收区间的所有到货通知单,可通过筛选条件进行筛选</p>
			</div>
		</div>
	</div>
</div>
</html>
