<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta http-equiv="Content-Type" content="charset=UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="stylesheet" href="/iles/pages/css/style.min.css">
	<style type="text/css">
		.addDivMargin{margin-left: 100px}
		.addDivMargin2{margin-left: 140px}
		.addLableWidth{width:110px}
	</style>
	<title>点收作业管理更新</title>
</head>
<div id="bodyDiv">

</div>
<script type="text/html" id="bodyTpl">
	<div class="layui-container" style="padding-top: 30px;">
		<form class="layui-form" action="">
			<input type="hidden" name="id" id="receiveId"/>
			<input type="hidden" name="arrivalId" id="arrivalId"/>
			<div class="layui-form-item">
				<div class="layui-inline addDivMargin">
					<label class="layui-form-label addLableWidth">到货通知单号：</label>
					<div class="layui-input-block addDivMargin2">
						<input type="text" id="arrivalCode" style="border:none" readonly="readonly" class="layui-input">
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-inline addDivMargin">
					<label class="layui-form-label addLableWidth">供应商：</label>
					<div class="layui-input-block addDivMargin2">
						<input type="text" id="supplierName" style="border:none" readonly="readonly" class="layui-input">
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-inline addDivMargin">
					<label class="layui-form-label addLableWidth">点收团队：</label>
					<div class="layui-input-block layui-form addDivMargin2">
						<select id="teamId" name="teamId" lay-verify="required"></select>
					</div>
				</div>
			</div>
			<div class="layui-form-item">
				<div class="layui-inline addDivMargin">
					<label class="layui-form-label addLableWidth">点收审核人：</label>
					<div class="layui-input-block addDivMargin2">
						<select id="checkUid" name="checkUid" lay-verify="required">
							<option value=""></option>
						</select>
					</div>
				</div>
			</div>
			<div class="layui-form-item"  style="margin-left: 110px;margin-top: 60px">
				<div class="layui-input-block">
					<button class="layui-btn" lay-submit="" lay-filter="updateReceiveWork" type="button">立即提交</button>
					<button type="button" id="buttonReset" class="layui-btn layui-btn-primary">重置</button>
				</div>
			</div>
		</form>
	</div>
</script>
<script src="/iles/pages/layui/layui.all.js" charset="UTF-8"></script>
<script src="/iles/pages/js/serverPathConfig.js" charset="UTF-8"></script>
<script src="/iles/pages/js/loginInspect.js" charset="UTF-8"></script>
<script type="text/javascript">
	var $ = layui.$;
	var element = layui.element;
	var layer = layui.layer;
	var table = layui.table;
	var form = layui.form;
    var wmsContextPath = config.wmsoptConfig.contextPath;
	var oldData;
    function loadding() {
        //获取所属仓库，用于判断是否加载点收审核人为必填项
        $.ajax({
            type: 'POST',
            async: false,
            url: wmsContextPath+"receiveWork/getStorageLocation",
            dataType: "json",
            contentType : 'application/json',
            success: function(result){
                var temp = result.data;
                if(temp == "00500400" || temp == "00500300" || temp == "00500500" || temp == "00500600" || temp == "00500900" || temp == "00501000" || temp == "00501100" || temp == "00501200" || temp == "00501400" || temp == "00501300"){//预组装和总组装不需要点收审核人为必填项
                    $("#checkUid").attr("lay-verify",'')
                }
            }
        });
        //加载点收审核人
        $.ajax({
            type: 'POST',
            async: false,
            url: wmsContextPath+"receiveWork/getReceivePeople",
            dataType: "json",
            contentType : 'application/json',
            success: function(result){
                $("#checkUid").append(result.data);
            }
        });
        $("#receiveId").val(parent.$("#receiveId").val());//id
        $("#arrivalId").val(parent.$("#arrivalId").val());//arrivalId
        $("#teamId").append(parent.$("#teamId").html());//加载点收团队select
        $("#storageLocation").append(parent.$("#storageLocation").html());//所属仓库
        //回显 到货通知单号/供应商
		var str = parent.$("#someArrivalValue").val();
        $("#arrivalCode").val(str.substring(0,str.indexOf("*")));
        $("#supplierName").val(str.substring(str.indexOf("*")+1,str.length));
    }
    form.render('select');	//重新渲染select
    //重置
    $("#buttonReset").click(function(){
        $("#teamId").val('');
        form.render();
        $("#checkUid").val('');
        form.render();
    });

    //监听提交
    form.on('submit(updateReceiveWork)', function(data){
        var option = {
            url:wmsContextPath+'receiveWork/updateReceiveWorkSchedule',
            data:JSON.stringify(data.field),
            type:'POST',
            contentType:'application/json',
            success:function(data){
                if(data.code==0){
                    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                    parent.layer.close(index);  // 关闭layer
                    parent.parentId = "";
                    parent.table.reload('scheduleTabId');
                }else{
                    layer.alert(data.msg);
                }
            },error:function(data){
                layer.alert(data.msg)
            }
        }
        $.ajax(option);
        return false;
    });
</script>
</html>